<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="generator" content="quarto-1.8.25">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<meta name="author" content="Hadley Wickham, Mine Çetinkaya-Rundel, and Garrett Grolemund">
<title>26&nbsp; 반복 – R for Data Science (2e)</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>

<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./base-R.html" rel="next">
<link href="./functions.html" rel="prev">
<link href="./cover.jpg" rel="icon" type="image/jpeg">
<script src="site_libs/quarto-html/quarto.js" type="module"></script>
<script src="site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="site_libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-7b89279ff1a6dce999919e0e67d4d9ec.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-8df9fc159a2c64db71ab329accd4d345.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light"><script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script><script defer="" data-domain="r4ds.hadley.nz" src="https://plausible.io/js/plausible.js"></script>
</head>
<body class="nav-sidebar floating quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top"><nav class="quarto-secondary-nav"><div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./program.html">프로그램 (Program)</a></li><li class="breadcrumb-item"><a href="./iteration.html"><span class="chapter-number">26</span>&nbsp; <span class="chapter-title">반복</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav></header><!-- content --><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto"><div class="pt-lg-2 mt-2 text-left sidebar-header sidebar-header-stacked">
      <a href="./index.html" class="sidebar-logo-link">
      </a>
    <div class="sidebar-title mb-0 py-0">
      <a href="./">R for Data Science (2e)</a> 
        <div class="sidebar-tools-main">
    <a href="https://github.com/hadley/r4ds/" title="Source Code" class="quarto-navigation-tool px-1" aria-label="Source Code"><i class="bi bi-github"></i></a>
  <a href="" class="quarto-reader-toggle quarto-navigation-tool px-1" onclick="window.quartoToggleReader(); return false;" title="Toggle reader mode">
  <div class="quarto-reader-toggle-btn">
  <i class="bi"></i>
  </div>
</a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">환영합니다</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./preface-2e.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">제2판 서문</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">소개</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./whole-game.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">전체 게임</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./data-visualize.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">데이터 시각화</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./workflow-basics.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">워크플로우: 기초</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./data-transform.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">데이터 변형</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./workflow-style.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">워크플로우: 코드 스타일</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./data-tidy.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">데이터 정리</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./workflow-scripts.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">워크플로우: 스크립트와 프로젝트</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./data-import.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">데이터 가져오기</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./workflow-help.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">워크플로우: 도움 받기</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./visualize.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">시각화 (Visualize)</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./layers.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">레이어(Layers)</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./EDA.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">탐색적 데이터 분석(Exploratory data analysis)</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./communication.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">소통(Communication)</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./transform.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">변형 (Transform)</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./logicals.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">논리형 벡터</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./numbers.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">숫자</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./strings.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">문자열</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./regexps.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">정규 표현식 (Regular expressions)</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./factors.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">팩터(Factors)</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./datetimes.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">17</span>&nbsp; <span class="chapter-title">날짜와 시간</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./missing-values.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">18</span>&nbsp; <span class="chapter-title">결측값(Missing values)</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./joins.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">19</span>&nbsp; <span class="chapter-title">조인(Joins)</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./import.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">가져오기 (Import)</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./spreadsheets.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">20</span>&nbsp; <span class="chapter-title">스프레드시트</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./databases.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">21</span>&nbsp; <span class="chapter-title">데이터베이스</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./arrow.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">22</span>&nbsp; <span class="chapter-title">Arrow</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./rectangling.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">23</span>&nbsp; <span class="chapter-title">계층적 데이터</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./webscraping.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">24</span>&nbsp; <span class="chapter-title">웹 스크래핑</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./program.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">프로그램 (Program)</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./functions.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">25</span>&nbsp; <span class="chapter-title">함수 (Functions)</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./iteration.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">26</span>&nbsp; <span class="chapter-title">반복</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./base-R.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">27</span>&nbsp; <span class="chapter-title">기본 R 필드 가이드</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./communicate.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">소통 (Communicate)</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-6" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./quarto.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">28</span>&nbsp; <span class="chapter-title">Quarto</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./quarto-formats.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">29</span>&nbsp; <span class="chapter-title">Quarto 형식</span></span></a>
  </div>
</li>
      </ul>
</li>
    </ul>
</div>
</nav><div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active"><h2 id="toc-title">Table of contents</h2>
   
  <ul>
<li>
<a href="#%EC%86%8C%EA%B0%9C" id="toc-소개" class="nav-link active" data-scroll-target="#%EC%86%8C%EA%B0%9C"><span class="header-section-number">26.1</span> 소개</a>
  <ul class="collapse">
<li><a href="#%EC%84%A0%EC%88%98-%EC%A7%80%EC%8B%9D" id="toc-선수-지식" class="nav-link" data-scroll-target="#%EC%84%A0%EC%88%98-%EC%A7%80%EC%8B%9D"><span class="header-section-number">26.1.1</span> 선수 지식</a></li>
  </ul>
</li>
  <li>
<a href="#sec-across" id="toc-sec-across" class="nav-link" data-scroll-target="#sec-across"><span class="header-section-number">26.2</span> 여러 열 수정하기</a>
  <ul class="collapse">
<li><a href="#cols%EB%A1%9C-%EC%97%B4-%EC%84%A0%ED%83%9D%ED%95%98%EA%B8%B0" id="toc-cols로-열-선택하기" class="nav-link" data-scroll-target="#cols%EB%A1%9C-%EC%97%B4-%EC%84%A0%ED%83%9D%ED%95%98%EA%B8%B0"><span class="header-section-number">26.2.1</span> <code>.cols</code>로 열 선택하기</a></li>
  <li><a href="#%EB%8B%A8%EC%9D%BC-%ED%95%A8%EC%88%98-%ED%98%B8%EC%B6%9C%ED%95%98%EA%B8%B0" id="toc-단일-함수-호출하기" class="nav-link" data-scroll-target="#%EB%8B%A8%EC%9D%BC-%ED%95%A8%EC%88%98-%ED%98%B8%EC%B6%9C%ED%95%98%EA%B8%B0"><span class="header-section-number">26.2.2</span> 단일 함수 호출하기</a></li>
  <li><a href="#%EC%97%AC%EB%9F%AC-%ED%95%A8%EC%88%98-%ED%98%B8%EC%B6%9C%ED%95%98%EA%B8%B0" id="toc-여러-함수-호출하기" class="nav-link" data-scroll-target="#%EC%97%AC%EB%9F%AC-%ED%95%A8%EC%88%98-%ED%98%B8%EC%B6%9C%ED%95%98%EA%B8%B0"><span class="header-section-number">26.2.3</span> 여러 함수 호출하기</a></li>
  <li><a href="#%EC%97%B4-%EC%9D%B4%EB%A6%84" id="toc-열-이름" class="nav-link" data-scroll-target="#%EC%97%B4-%EC%9D%B4%EB%A6%84"><span class="header-section-number">26.2.4</span> 열 이름</a></li>
  <li><a href="#%ED%95%84%ED%84%B0%EB%A7%81" id="toc-필터링" class="nav-link" data-scroll-target="#%ED%95%84%ED%84%B0%EB%A7%81"><span class="header-section-number">26.2.5</span> 필터링</a></li>
  <li><a href="#%ED%95%A8%EC%88%98-%EB%82%B4%EC%9D%98-across" id="toc-함수-내의-across" class="nav-link" data-scroll-target="#%ED%95%A8%EC%88%98-%EB%82%B4%EC%9D%98-across"><span class="header-section-number">26.2.6</span> 함수 내의 <code>across()</code></a></li>
  <li><a href="#pivot_longer%EC%99%80-%EB%B9%84%EA%B5%90" id="toc-pivot_longer와-비교" class="nav-link" data-scroll-target="#pivot_longer%EC%99%80-%EB%B9%84%EA%B5%90"><span class="header-section-number">26.2.7</span> <code>pivot_longer()</code>와 비교</a></li>
  <li><a href="#%EC%97%B0%EC%8A%B5%EB%AC%B8%EC%A0%9C" id="toc-연습문제" class="nav-link" data-scroll-target="#%EC%97%B0%EC%8A%B5%EB%AC%B8%EC%A0%9C"><span class="header-section-number">26.2.8</span> 연습문제</a></li>
  </ul>
</li>
  <li>
<a href="#%EC%97%AC%EB%9F%AC-%ED%8C%8C%EC%9D%BC-%EC%9D%BD%EA%B8%B0" id="toc-여러-파일-읽기" class="nav-link" data-scroll-target="#%EC%97%AC%EB%9F%AC-%ED%8C%8C%EC%9D%BC-%EC%9D%BD%EA%B8%B0"><span class="header-section-number">26.3</span> 여러 파일 읽기</a>
  <ul class="collapse">
<li><a href="#%EB%94%94%EB%A0%89%ED%84%B0%EB%A6%AC%EC%9D%98-%ED%8C%8C%EC%9D%BC-%EB%82%98%EC%97%B4%ED%95%98%EA%B8%B0" id="toc-디렉터리의-파일-나열하기" class="nav-link" data-scroll-target="#%EB%94%94%EB%A0%89%ED%84%B0%EB%A6%AC%EC%9D%98-%ED%8C%8C%EC%9D%BC-%EB%82%98%EC%97%B4%ED%95%98%EA%B8%B0"><span class="header-section-number">26.3.1</span> 디렉터리의 파일 나열하기</a></li>
  <li><a href="#%EB%A6%AC%EC%8A%A4%ED%8A%B8" id="toc-리스트" class="nav-link" data-scroll-target="#%EB%A6%AC%EC%8A%A4%ED%8A%B8"><span class="header-section-number">26.3.2</span> 리스트</a></li>
  <li><a href="#purrrmap%EA%B3%BC-list_rbind" id="toc-purrrmap과-list_rbind" class="nav-link" data-scroll-target="#purrrmap%EA%B3%BC-list_rbind"><span class="header-section-number">26.3.3</span> <code>purrr::map()</code>과 <code>list_rbind()</code></a></li>
  <li><a href="#sec-data-in-the-path" id="toc-sec-data-in-the-path" class="nav-link" data-scroll-target="#sec-data-in-the-path"><span class="header-section-number">26.3.4</span> 경로에 있는 데이터</a></li>
  <li><a href="#%EC%9E%91%EC%97%85-%EC%A0%80%EC%9E%A5" id="toc-작업-저장" class="nav-link" data-scroll-target="#%EC%9E%91%EC%97%85-%EC%A0%80%EC%9E%A5"><span class="header-section-number">26.3.5</span> 작업 저장</a></li>
  <li><a href="#%EC%97%AC%EB%9F%AC-%EB%B2%88%EC%9D%98-%EB%8B%A8%EC%88%9C%ED%95%9C-%EB%B0%98%EB%B3%B5" id="toc-여러-번의-단순한-반복" class="nav-link" data-scroll-target="#%EC%97%AC%EB%9F%AC-%EB%B2%88%EC%9D%98-%EB%8B%A8%EC%88%9C%ED%95%9C-%EB%B0%98%EB%B3%B5"><span class="header-section-number">26.3.6</span> 여러 번의 단순한 반복</a></li>
  <li><a href="#%EC%9D%B4%EC%A7%88%EC%A0%81%EC%9D%B8-%EB%8D%B0%EC%9D%B4%ED%84%B0" id="toc-이질적인-데이터" class="nav-link" data-scroll-target="#%EC%9D%B4%EC%A7%88%EC%A0%81%EC%9D%B8-%EB%8D%B0%EC%9D%B4%ED%84%B0"><span class="header-section-number">26.3.7</span> 이질적인 데이터</a></li>
  <li><a href="#%EC%8B%A4%ED%8C%A8-%EC%B2%98%EB%A6%AC" id="toc-실패-처리" class="nav-link" data-scroll-target="#%EC%8B%A4%ED%8C%A8-%EC%B2%98%EB%A6%AC"><span class="header-section-number">26.3.8</span> 실패 처리</a></li>
  </ul>
</li>
  <li>
<a href="#%EC%97%AC%EB%9F%AC-%EC%B6%9C%EB%A0%A5-%EC%A0%80%EC%9E%A5%ED%95%98%EA%B8%B0" id="toc-여러-출력-저장하기" class="nav-link" data-scroll-target="#%EC%97%AC%EB%9F%AC-%EC%B6%9C%EB%A0%A5-%EC%A0%80%EC%9E%A5%ED%95%98%EA%B8%B0"><span class="header-section-number">26.4</span> 여러 출력 저장하기</a>
  <ul class="collapse">
<li><a href="#sec-save-database" id="toc-sec-save-database" class="nav-link" data-scroll-target="#sec-save-database"><span class="header-section-number">26.4.1</span> 데이터베이스에 쓰기</a></li>
  <li><a href="#csv-%ED%8C%8C%EC%9D%BC-%EC%93%B0%EA%B8%B0" id="toc-csv-파일-쓰기" class="nav-link" data-scroll-target="#csv-%ED%8C%8C%EC%9D%BC-%EC%93%B0%EA%B8%B0"><span class="header-section-number">26.4.2</span> csv 파일 쓰기</a></li>
  <li><a href="#%ED%94%8C%EB%A1%AF-%EC%A0%80%EC%9E%A5%ED%95%98%EA%B8%B0" id="toc-플롯-저장하기" class="nav-link" data-scroll-target="#%ED%94%8C%EB%A1%AF-%EC%A0%80%EC%9E%A5%ED%95%98%EA%B8%B0"><span class="header-section-number">26.4.3</span> 플롯 저장하기</a></li>
  </ul>
</li>
  <li><a href="#%EC%9A%94%EC%95%BD" id="toc-요약" class="nav-link" data-scroll-target="#%EC%9A%94%EC%95%BD"><span class="header-section-number">26.5</span> 요약</a></li>
  </ul><div class="toc-actions"><ul><li><a href="https://github.com/hadley/r4ds/edit/main/iteration.qmd" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/hadley/r4ds/issues/new" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content"><header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./program.html">프로그램 (Program)</a></li><li class="breadcrumb-item"><a href="./iteration.html"><span class="chapter-number">26</span>&nbsp; <span class="chapter-title">반복</span></a></li></ol></nav><div class="quarto-title">
<h1 class="title"><span id="sec-iteration" class="quarto-section-identifier"><span class="chapter-number">26</span>&nbsp; <span class="chapter-title">반복</span></span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header><section id="소개" class="level2" data-number="26.1"><h2 data-number="26.1" class="anchored" data-anchor-id="소개">
<span class="header-section-number">26.1</span> 소개</h2>
<p>이 장에서는 서로 다른 객체에 대해 동일한 작업을 반복적으로 수행하는 <strong>반복(iteration)</strong>을 위한 도구들을 배울 것입니다. R에서의 반복은 다른 프로그래밍 언어와는 다소 다르게 보이는 경향이 있는데, 이는 많은 부분이 암시적으로 처리되어 무료로 제공되기 때문입니다. 예를 들어, R에서 수치형 벡터 <code>x</code>를 두 배로 만들고 싶다면 그냥 <code>2 * x</code>라고 쓰면 됩니다. 대부분의 다른 언어에서는 for 루프 같은 것을 사용하여 <code>x</code>의 각 요소를 명시적으로 두 배로 만들어야 합니다.</p>
<p>이 책은 이미 여러 “것”들에 대해 동일한 작업을 수행하는 작지만 강력한 도구들을 몇 가지 소개했습니다:</p>
<ul>
<li>
<code><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html">facet_wrap()</a></code> 및 <code><a href="https://ggplot2.tidyverse.org/reference/facet_grid.html">facet_grid()</a></code>는 각 하위 집합에 대해 플롯을 그립니다.</li>
<li>
<code><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by()</a></code>와 <code><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarize()</a></code>를 함께 사용하면 각 하위 집합에 대한 요약 통계를 계산합니다.</li>
<li>
<code><a href="https://tidyr.tidyverse.org/reference/unnest_wider.html">unnest_wider()</a></code> 및 <code><a href="https://tidyr.tidyverse.org/reference/unnest_longer.html">unnest_longer()</a></code>는 리스트 열의 각 요소에 대해 새로운 행과 열을 생성합니다.</li>
</ul>
<p>이제 다른 함수를 입력으로 받는 함수를 중심으로 구축되었기 때문에 종종 <strong>함수형 프로그래밍(functional programming)</strong> 도구라고 불리는 좀 더 일반적인 도구들을 배울 때입니다. 함수형 프로그래밍을 배우는 것은 자칫 추상적으로 흐를 수 있지만, 이 장에서는 세 가지 일반적인 작업인 여러 열 수정하기, 여러 파일 읽기, 여러 객체 저장하기에 집중하여 구체적으로 다루겠습니다.</p>
<section id="선수-지식" class="level3" data-number="26.1.1"><h3 data-number="26.1.1" class="anchored" data-anchor-id="선수-지식">
<span class="header-section-number">26.1.1</span> 선수 지식</h3>
<p>이 장에서는 tidyverse의 핵심 멤버인 dplyr과 purrr에서 제공하는 도구들에 집중하겠습니다. dplyr은 이미 보셨겠지만, <a href="http://purrr.tidyverse.org/">purrr</a>는 처음입니다. 이 장에서는 몇 가지 purrr 함수만 사용할 예정이지만, 프로그래밍 기술을 향상시키고 싶다면 탐색해 보기에 아주 좋은 패키지입니다.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb1"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org">tidyverse</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning: package 'ggplot2' was built under R version 4.5.2</span></span>
<span><span class="co">#&gt; Warning: package 'readr' was built under R version 4.5.2</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section></section><section id="sec-across" class="level2" data-number="26.2"><h2 data-number="26.2" class="anchored" data-anchor-id="sec-across">
<span class="header-section-number">26.2</span> 여러 열 수정하기</h2>
<p>다음과 같은 간단한 티블이 있고, 모든 열의 관측값 개수를 세고 중앙값을 계산하고 싶다고 가정해 봅시다.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb2"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">1014</span><span class="op">)</span></span>
<span><span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html">tibble</a></span><span class="op">(</span></span>
<span>  a <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="fl">10</span><span class="op">)</span>,</span>
<span>  b <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="fl">10</span><span class="op">)</span>,</span>
<span>  c <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="fl">10</span><span class="op">)</span>,</span>
<span>  d <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="fl">10</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>복사해서 붙여넣기를 사용하여 할 수 있습니다:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb3"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">df</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarize</a></span><span class="op">(</span></span>
<span>  n <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html">n</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  a <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/median.html">median</a></span><span class="op">(</span><span class="va">a</span><span class="op">)</span>,</span>
<span>  b <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/median.html">median</a></span><span class="op">(</span><span class="va">b</span><span class="op">)</span>,</span>
<span>  c <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/median.html">median</a></span><span class="op">(</span><span class="va">c</span><span class="op">)</span>,</span>
<span>  d <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/median.html">median</a></span><span class="op">(</span><span class="va">d</span><span class="op">)</span>,</span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 1 × 5</span></span>
<span><span class="co">#&gt;       n      a      b       c     d</span></span>
<span><span class="co">#&gt;   &lt;int&gt;  &lt;dbl&gt;  &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt;</span></span>
<span><span class="co">#&gt; 1    10 -0.246 -0.287 -0.0567 0.144</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>하지만 이것은 코드 블록을 두 번 이상 복사해서 붙여넣지 말라는 우리의 경험 법칙을 어기는 것이며, 열이 수십 개 또는 수백 개라면 매우 지루해질 것임을 상상할 수 있습니다. 대신 <code><a href="https://dplyr.tidyverse.org/reference/across.html">across()</a></code>를 사용할 수 있습니다:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb4"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">df</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarize</a></span><span class="op">(</span></span>
<span>  n <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html">n</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/across.html">across</a></span><span class="op">(</span><span class="va">a</span><span class="op">:</span><span class="va">d</span>, <span class="va">median</span><span class="op">)</span>,</span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 1 × 5</span></span>
<span><span class="co">#&gt;       n      a      b       c     d</span></span>
<span><span class="co">#&gt;   &lt;int&gt;  &lt;dbl&gt;  &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt;</span></span>
<span><span class="co">#&gt; 1    10 -0.246 -0.287 -0.0567 0.144</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p><code><a href="https://dplyr.tidyverse.org/reference/across.html">across()</a></code>에는 특히 중요한 세 가지 인수가 있으며, 다음 섹션들에서 자세히 다루겠습니다. <code><a href="https://dplyr.tidyverse.org/reference/across.html">across()</a></code>를 사용할 때마다 처음 두 개를 사용하게 될 것입니다. 첫 번째 인수 <code>.cols</code>는 반복할 열을 지정하고, 두 번째 인수 <code>.fns</code>는 각 열에 대해 수행할 작업을 지정합니다. 출력 열의 이름을 추가로 제어해야 할 때는 <code>.names</code> 인수를 사용할 수 있으며, 이는 <code><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate()</a></code>와 함께 <code><a href="https://dplyr.tidyverse.org/reference/across.html">across()</a></code>를 사용할 때 특히 중요합니다. 또한 <code><a href="https://dplyr.tidyverse.org/reference/filter.html">filter()</a></code>와 함께 작동하는 두 가지 중요한 변형인 <code><a href="https://dplyr.tidyverse.org/reference/across.html">if_any()</a></code>와 <code><a href="https://dplyr.tidyverse.org/reference/across.html">if_all()</a></code>에 대해서도 논의할 것입니다.</p>
<section id="cols로-열-선택하기" class="level3" data-number="26.2.1"><h3 data-number="26.2.1" class="anchored" data-anchor-id="cols로-열-선택하기">
<span class="header-section-number">26.2.1</span> <code>.cols</code>로 열 선택하기</h3>
<p><code><a href="https://dplyr.tidyverse.org/reference/across.html">across()</a></code>의 첫 번째 인수 <code>.cols</code>는 변환할 열을 선택합니다. 이것은 <code><a href="https://dplyr.tidyverse.org/reference/select.html">select()</a></code>와 동일한 사양을 사용하므로(<a href="data-transform.html#sec-select" class="quarto-xref"><span>Section 3.3.2</span></a>), <code><a href="https://tidyselect.r-lib.org/reference/starts_with.html">starts_with()</a></code> 및 <code><a href="https://tidyselect.r-lib.org/reference/starts_with.html">ends_with()</a></code>와 같은 함수를 사용하여 이름에 따라 열을 선택할 수 있습니다.</p>
<p><code><a href="https://dplyr.tidyverse.org/reference/across.html">across()</a></code>에 특히 유용한 두 가지 추가 선택 기술이 있습니다: <code><a href="https://tidyselect.r-lib.org/reference/everything.html">everything()</a></code>과 <code><a href="https://tidyselect.r-lib.org/reference/where.html">where()</a></code>입니다. <code><a href="https://tidyselect.r-lib.org/reference/everything.html">everything()</a></code>은 간단합니다. (그룹화되지 않은) 모든 열을 선택합니다:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb5"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">1014</span><span class="op">)</span></span>
<span><span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html">tibble</a></span><span class="op">(</span></span>
<span>  grp <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html">sample</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">10</span>, replace <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>  a <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="fl">10</span><span class="op">)</span>,</span>
<span>  b <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="fl">10</span><span class="op">)</span>,</span>
<span>  c <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="fl">10</span><span class="op">)</span>,</span>
<span>  d <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="fl">10</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">df</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">grp</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarize</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/across.html">across</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/everything.html">everything</a></span><span class="op">(</span><span class="op">)</span>, <span class="va">median</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 2 × 5</span></span>
<span><span class="co">#&gt;     grp      a      b       c       d</span></span>
<span><span class="co">#&gt;   &lt;int&gt;  &lt;dbl&gt;  &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;</span></span>
<span><span class="co">#&gt; 1     1 -0.244 -0.522 -0.0974 -0.251 </span></span>
<span><span class="co">#&gt; 2     2 -0.247  0.468  0.112   0.0700</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>그룹화 열(여기서는 <code>grp</code>)은 <code><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarize()</a></code>에 의해 자동으로 보존되므로 <code><a href="https://dplyr.tidyverse.org/reference/across.html">across()</a></code>에 포함되지 않습니다.</p>
<p><code><a href="https://tidyselect.r-lib.org/reference/where.html">where()</a></code>를 사용하면 유형에 따라 열을 선택할 수 있습니다:</p>
<ul>
<li>
<code>where(is.numeric)</code>은 모든 수치형 열을 선택합니다.</li>
<li>
<code>where(is.character)</code>는 모든 문자열 열을 선택합니다.</li>
<li>
<code>where(is.Date)</code>는 모든 날짜 열을 선택합니다.</li>
<li>
<code>where(is.POSIXct)</code>는 모든 날짜-시간 열을 선택합니다.</li>
<li>
<code>where(is.logical)</code>은 모든 논리형 열을 선택합니다.</li>
</ul>
<p>다른 선택자들과 마찬가지로 부울 대수와 결합할 수 있습니다. 예를 들어 <code>!where(is.numeric)</code>은 수치형이 아닌 모든 열을 선택하고, <code>starts_with("a") &amp; where(is.logical)</code>은 이름이 “a”로 시작하는 모든 논리형 열을 선택합니다.</p>
</section><section id="단일-함수-호출하기" class="level3" data-number="26.2.2"><h3 data-number="26.2.2" class="anchored" data-anchor-id="단일-함수-호출하기">
<span class="header-section-number">26.2.2</span> 단일 함수 호출하기</h3>
<p><code><a href="https://dplyr.tidyverse.org/reference/across.html">across()</a></code>의 두 번째 인수는 각 열이 어떻게 변환될지를 정의합니다. 위의 간단한 경우처럼 단일 기존 함수가 될 수도 있습니다. 이것은 R의 꽤 특별한 기능입니다. 우리는 한 함수(<code>median</code>, <code>mean</code>, <code>str_flatten</code>, …)를 다른 함수(<code>across</code>)에 전달하고 있습니다. 이것이 R을 함수형 프로그래밍 언어로 만드는 기능 중 하나입니다.</p>
<p>여기서 중요한 점은 이 함수를 <code><a href="https://dplyr.tidyverse.org/reference/across.html">across()</a></code>에 전달하여 <code><a href="https://dplyr.tidyverse.org/reference/across.html">across()</a></code>가 호출할 수 있게 하는 것이지, 우리가 직접 호출하는 것이 아니라는 점입니다. 즉, 함수 이름 뒤에 <code>()</code>가 오면 안 됩니다. 이를 잊어버리면 오류가 발생합니다:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb6"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">df</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">grp</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarize</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/across.html">across</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/everything.html">everything</a></span><span class="op">(</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/stats/median.html">median</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; Error in `summarize()`:</span></span>
<span><span class="co">#&gt; ℹ In argument: `across(everything(), median())`.</span></span>
<span><span class="co">#&gt; Caused by error in `median.default()`:</span></span>
<span><span class="co">#&gt; ! argument "x" is missing, with no default</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>이 오류는 입력 없이 함수를 호출하려고 했기 때문에 발생합니다. 예:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb7"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/median.html">median</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; Error in median.default(): argument "x" is missing, with no default</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section><section id="여러-함수-호출하기" class="level3" data-number="26.2.3"><h3 data-number="26.2.3" class="anchored" data-anchor-id="여러-함수-호출하기">
<span class="header-section-number">26.2.3</span> 여러 함수 호출하기</h3>
<p>더 복잡한 경우에는 추가 인수를 제공하거나 여러 변환을 수행하고 싶을 수 있습니다. 간단한 예로 이 문제의 동기를 부여해 보겠습니다. 데이터에 결측값이 있으면 어떻게 될까요? <code><a href="https://rdrr.io/r/stats/median.html">median()</a></code>은 결측값을 전파하여 최적이 아닌 출력을 제공합니다:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb8"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">1014</span><span class="op">)</span></span>
<span><span class="va">rnorm_na</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">n</span>, <span class="va">n_na</span>, <span class="va">mean</span> <span class="op">=</span> <span class="fl">0</span>, <span class="va">sd</span> <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/sample.html">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="va">n</span> <span class="op">-</span> <span class="va">n_na</span>, mean <span class="op">=</span> <span class="va">mean</span>, sd <span class="op">=</span> <span class="va">sd</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="cn">NA</span>, <span class="va">n_na</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">df_miss</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html">tibble</a></span><span class="op">(</span></span>
<span>  a <span class="op">=</span> <span class="fu">rnorm_na</span><span class="op">(</span><span class="fl">5</span>, <span class="fl">1</span><span class="op">)</span>,</span>
<span>  b <span class="op">=</span> <span class="fu">rnorm_na</span><span class="op">(</span><span class="fl">5</span>, <span class="fl">1</span><span class="op">)</span>,</span>
<span>  c <span class="op">=</span> <span class="fu">rnorm_na</span><span class="op">(</span><span class="fl">5</span>, <span class="fl">2</span><span class="op">)</span>,</span>
<span>  d <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="fl">5</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="va">df_miss</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarize</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/across.html">across</a></span><span class="op">(</span><span class="va">a</span><span class="op">:</span><span class="va">d</span>, <span class="va">median</span><span class="op">)</span>,</span>
<span>    n <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html">n</a></span><span class="op">(</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 1 × 5</span></span>
<span><span class="co">#&gt;       a     b     c     d     n</span></span>
<span><span class="co">#&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;int&gt;</span></span>
<span><span class="co">#&gt; 1    NA    NA    NA 0.413     5</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>이 결측값들을 제거하기 위해 <code>na.rm = TRUE</code>를 <code><a href="https://rdrr.io/r/stats/median.html">median()</a></code>에 전달할 수 있다면 좋을 것입니다. 그렇게 하려면 <code><a href="https://rdrr.io/r/stats/median.html">median()</a></code>을 직접 호출하는 대신, 원하는 인수로 <code><a href="https://rdrr.io/r/stats/median.html">median()</a></code>을 호출하는 새 함수를 만들어야 합니다:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb9"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">df_miss</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarize</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/across.html">across</a></span><span class="op">(</span><span class="va">a</span><span class="op">:</span><span class="va">d</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/stats/median.html">median</a></span><span class="op">(</span><span class="va">x</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    n <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html">n</a></span><span class="op">(</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 1 × 5</span></span>
<span><span class="co">#&gt;        a      b      c     d     n</span></span>
<span><span class="co">#&gt;    &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;int&gt;</span></span>
<span><span class="co">#&gt; 1 -0.703 -0.265 -0.522 0.413     5</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>이것은 약간 장황하므로, R에는 편리한 단축키가 있습니다. 이런 일회용 또는 <strong>익명(anonymous)</strong><a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a> 함수의 경우 <code>function</code>을 <code>\</code><a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a>로 바꿀 수 있습니다:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb10"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">df_miss</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarize</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/across.html">across</a></span><span class="op">(</span><span class="va">a</span><span class="op">:</span><span class="va">d</span>, \<span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/stats/median.html">median</a></span><span class="op">(</span><span class="va">x</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    n <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html">n</a></span><span class="op">(</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>어느 경우든 <code><a href="https://dplyr.tidyverse.org/reference/across.html">across()</a></code>는 실질적으로 다음 코드로 확장됩니다:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb11"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">df_miss</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarize</a></span><span class="op">(</span></span>
<span>    a <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/median.html">median</a></span><span class="op">(</span><span class="va">a</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>    b <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/median.html">median</a></span><span class="op">(</span><span class="va">b</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>    c <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/median.html">median</a></span><span class="op">(</span><span class="va">c</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>    d <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/median.html">median</a></span><span class="op">(</span><span class="va">d</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>    n <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html">n</a></span><span class="op">(</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p><code><a href="https://rdrr.io/r/stats/median.html">median()</a></code>에서 결측값을 제거할 때, 얼마나 많은 값이 제거되었는지도 알 수 있으면 좋을 것입니다. <code><a href="https://dplyr.tidyverse.org/reference/across.html">across()</a></code>에 두 개의 함수를 제공하여 이를 알아낼 수 있습니다. 하나는 중앙값을 계산하고 다른 하나는 결측값의 개수를 세는 것입니다. <code>.fns</code>에 명명된 리스트를 사용하여 여러 함수를 제공합니다:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb12"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">df_miss</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarize</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/across.html">across</a></span><span class="op">(</span><span class="va">a</span><span class="op">:</span><span class="va">d</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span></span>
<span>      median <span class="op">=</span> \<span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/stats/median.html">median</a></span><span class="op">(</span><span class="va">x</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>      n_miss <span class="op">=</span> \<span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="op">)</span><span class="op">)</span>,</span>
<span>    n <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html">n</a></span><span class="op">(</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 1 × 9</span></span>
<span><span class="co">#&gt;   a_median a_n_miss b_median b_n_miss c_median c_n_miss d_median d_n_miss</span></span>
<span><span class="co">#&gt;      &lt;dbl&gt;    &lt;int&gt;    &lt;dbl&gt;    &lt;int&gt;    &lt;dbl&gt;    &lt;int&gt;    &lt;dbl&gt;    &lt;int&gt;</span></span>
<span><span class="co">#&gt; 1   -0.703        1   -0.265        1   -0.522        2    0.413        0</span></span>
<span><span class="co">#&gt; # ℹ 1 more variable: n &lt;int&gt;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>자세히 보시면, 열 이름이 <code>{.col}_{.fn}</code>과 같은 glue 사양(<a href="strings.html#sec-glue" class="quarto-xref"><span>Section 14.3.2</span></a>)을 사용하여 지정되었다는 것을 직감할 수 있을 것입니다. 여기서 <code>.col</code>은 원래 열의 이름이고 <code>.fn</code>은 함수의 이름입니다. 이것은 우연이 아닙니다! 다음 섹션에서 배우게 되겠지만, <code>.names</code> 인수를 사용하여 자신만의 glue 사양을 제공할 수 있습니다.</p>
</section><section id="열-이름" class="level3" data-number="26.2.4"><h3 data-number="26.2.4" class="anchored" data-anchor-id="열-이름">
<span class="header-section-number">26.2.4</span> 열 이름</h3>
<p><code><a href="https://dplyr.tidyverse.org/reference/across.html">across()</a></code>의 결과는 <code>.names</code> 인수에 제공된 사양에 따라 이름이 지정됩니다. 함수 이름이 먼저 오게 하고 싶다면 직접 지정할 수 있습니다<a href="#fn3" class="footnote-ref" id="fnref3" role="doc-noteref"><sup>3</sup></a>:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb13"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">df_miss</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarize</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/across.html">across</a></span><span class="op">(</span></span>
<span>      <span class="va">a</span><span class="op">:</span><span class="va">d</span>,</span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span></span>
<span>        median <span class="op">=</span> \<span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/stats/median.html">median</a></span><span class="op">(</span><span class="va">x</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>        n_miss <span class="op">=</span> \<span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span></span>
<span>      <span class="op">)</span>,</span>
<span>      .names <span class="op">=</span> <span class="st">"{.fn}_{.col}"</span></span>
<span>    <span class="op">)</span>,</span>
<span>    n <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html">n</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  <span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 1 × 9</span></span>
<span><span class="co">#&gt;   median_a n_miss_a median_b n_miss_b median_c n_miss_c median_d n_miss_d</span></span>
<span><span class="co">#&gt;      &lt;dbl&gt;    &lt;int&gt;    &lt;dbl&gt;    &lt;int&gt;    &lt;dbl&gt;    &lt;int&gt;    &lt;dbl&gt;    &lt;int&gt;</span></span>
<span><span class="co">#&gt; 1   -0.703        1   -0.265        1   -0.522        2    0.413        0</span></span>
<span><span class="co">#&gt; # ℹ 1 more variable: n &lt;int&gt;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p><code>.names</code> 인수는 <code><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate()</a></code>와 함께 <code><a href="https://dplyr.tidyverse.org/reference/across.html">across()</a></code>를 사용할 때 특히 중요합니다. 기본적으로 <code><a href="https://dplyr.tidyverse.org/reference/across.html">across()</a></code>의 출력에는 입력과 동일한 이름이 지정됩니다. 즉, <code><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate()</a></code> 내부의 <code><a href="https://dplyr.tidyverse.org/reference/across.html">across()</a></code>는 기존 열을 대체합니다. 예를 들어, 여기서는 <code><a href="https://dplyr.tidyverse.org/reference/coalesce.html">coalesce()</a></code>를 사용하여 <code>NA</code>를 <code>0</code>으로 바꿉니다:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb14"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">df_miss</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/across.html">across</a></span><span class="op">(</span><span class="va">a</span><span class="op">:</span><span class="va">d</span>, \<span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/coalesce.html">coalesce</a></span><span class="op">(</span><span class="va">x</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 5 × 4</span></span>
<span><span class="co">#&gt;          a      b      c        d</span></span>
<span><span class="co">#&gt;      &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;    &lt;dbl&gt;</span></span>
<span><span class="co">#&gt; 1 -0.00557 -0.283 -1.86  -0.783  </span></span>
<span><span class="co">#&gt; 2  0.255   -0.247 -0.522 -0.00289</span></span>
<span><span class="co">#&gt; 3 -1.40    -0.554  0.512  0.413  </span></span>
<span><span class="co">#&gt; 4 -2.44    -0.244  0      0.724  </span></span>
<span><span class="co">#&gt; 5  0        0      0      2.35</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>대신 새 열을 만들고 싶다면 <code>.names</code> 인수를 사용하여 출력에 새 이름을 지정할 수 있습니다:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb15"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">df_miss</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/across.html">across</a></span><span class="op">(</span><span class="va">a</span><span class="op">:</span><span class="va">d</span>, \<span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/coalesce.html">coalesce</a></span><span class="op">(</span><span class="va">x</span>, <span class="fl">0</span><span class="op">)</span>, .names <span class="op">=</span> <span class="st">"{.col}_na_zero"</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 5 × 8</span></span>
<span><span class="co">#&gt;          a      b      c        d a_na_zero b_na_zero c_na_zero d_na_zero</span></span>
<span><span class="co">#&gt;      &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;</span></span>
<span><span class="co">#&gt; 1 -0.00557 -0.283 -1.86  -0.783    -0.00557    -0.283    -1.86   -0.783  </span></span>
<span><span class="co">#&gt; 2  0.255   -0.247 -0.522 -0.00289   0.255      -0.247    -0.522  -0.00289</span></span>
<span><span class="co">#&gt; 3 -1.40    -0.554  0.512  0.413    -1.40       -0.554     0.512   0.413  </span></span>
<span><span class="co">#&gt; 4 -2.44    -0.244 NA      0.724    -2.44       -0.244     0       0.724  </span></span>
<span><span class="co">#&gt; 5 NA       NA     NA      2.35      0           0         0       2.35</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section><section id="필터링" class="level3" data-number="26.2.5"><h3 data-number="26.2.5" class="anchored" data-anchor-id="필터링">
<span class="header-section-number">26.2.5</span> 필터링</h3>
<p><code><a href="https://dplyr.tidyverse.org/reference/across.html">across()</a></code>는 <code><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarize()</a></code> 및 <code><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate()</a></code>와 훌륭한 조화를 이루지만 <code><a href="https://dplyr.tidyverse.org/reference/filter.html">filter()</a></code>와 함께 사용하기에는 더 어색합니다. 일반적으로 여러 조건을 <code>|</code> 또는 <code>&amp;</code>로 결합하기 때문입니다. <code><a href="https://dplyr.tidyverse.org/reference/across.html">across()</a></code>가 여러 논리형 열을 만드는 데 도움이 될 수 있다는 것은 분명하지만, 그 다음에는 어떻게 해야 할까요? 그래서 dplyr은 <code><a href="https://dplyr.tidyverse.org/reference/across.html">if_any()</a></code>와 <code><a href="https://dplyr.tidyverse.org/reference/across.html">if_all()</a></code>이라는 <code><a href="https://dplyr.tidyverse.org/reference/across.html">across()</a></code>의 두 가지 변형을 제공합니다:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb16"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># df_miss |&gt; filter(is.na(a) | is.na(b) | is.na(c) | is.na(d)) 와 동일</span></span>
<span><span class="va">df_miss</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/across.html">if_any</a></span><span class="op">(</span><span class="va">a</span><span class="op">:</span><span class="va">d</span>, <span class="va">is.na</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 2 × 4</span></span>
<span><span class="co">#&gt;       a      b     c     d</span></span>
<span><span class="co">#&gt;   &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;</span></span>
<span><span class="co">#&gt; 1 -2.44 -0.244    NA 0.724</span></span>
<span><span class="co">#&gt; 2 NA    NA        NA 2.35</span></span>
<span></span>
<span><span class="co"># df_miss |&gt; filter(is.na(a) &amp; is.na(b) &amp; is.na(c) &amp; is.na(d)) 와 동일</span></span>
<span><span class="va">df_miss</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/across.html">if_all</a></span><span class="op">(</span><span class="va">a</span><span class="op">:</span><span class="va">d</span>, <span class="va">is.na</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 0 × 4</span></span>
<span><span class="co">#&gt; # ℹ 4 variables: a &lt;dbl&gt;, b &lt;dbl&gt;, c &lt;dbl&gt;, d &lt;dbl&gt;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section><section id="함수-내의-across" class="level3" data-number="26.2.6"><h3 data-number="26.2.6" class="anchored" data-anchor-id="함수-내의-across">
<span class="header-section-number">26.2.6</span> 함수 내의 <code>across()</code>
</h3>
<p><code><a href="https://dplyr.tidyverse.org/reference/across.html">across()</a></code>는 여러 열에 대해 작업할 수 있게 해주기 때문에 프로그래밍하기에 특히 유용합니다. 예를 들어, <a href="https://twitter.com/_wurli/status/1571836746899283969">Jacob Scott</a>은 여러 lubridate 함수를 래핑하여 모든 날짜 열을 연, 월, 일 열로 확장하는 이 작은 도우미 함수를 사용합니다:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb17"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">expand_dates</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">df</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">df</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span></span>
<span>      <span class="fu"><a href="https://dplyr.tidyverse.org/reference/across.html">across</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/where.html">where</a></span><span class="op">(</span><span class="va">is.Date</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>year <span class="op">=</span> <span class="va">year</span>, month <span class="op">=</span> <span class="va">month</span>, day <span class="op">=</span> <span class="va">mday</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">df_date</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html">tibble</a></span><span class="op">(</span></span>
<span>  name <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Amy"</span>, <span class="st">"Bob"</span><span class="op">)</span>,</span>
<span>  date <span class="op">=</span> <span class="fu"><a href="https://lubridate.tidyverse.org/reference/ymd.html">ymd</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"2009-08-03"</span>, <span class="st">"2010-01-16"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">df_date</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">expand_dates</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 2 × 5</span></span>
<span><span class="co">#&gt;   name  date       date_year date_month date_day</span></span>
<span><span class="co">#&gt;   &lt;chr&gt; &lt;date&gt;         &lt;dbl&gt;      &lt;dbl&gt;    &lt;int&gt;</span></span>
<span><span class="co">#&gt; 1 Amy   2009-08-03      2009          8        3</span></span>
<span><span class="co">#&gt; 2 Bob   2010-01-16      2010          1       16</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p><code><a href="https://dplyr.tidyverse.org/reference/across.html">across()</a></code>는 또한 첫 번째 인수가 tidy-select를 사용하기 때문에 단일 인수에 여러 열을 쉽게 제공할 수 있습니다. <a href="functions.html#sec-embracing" class="quarto-xref"><span>Section 25.3.2</span></a> 에서 논의한 대로 해당 인수를 감싸야 한다는 점만 기억하면 됩니다. 예를 들어, 이 함수는 기본적으로 수치형 열의 평균을 계산합니다. 하지만 두 번째 인수를 제공하여 선택한 열만 요약하도록 선택할 수 있습니다:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb18"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">summarize_means</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">df</span>, <span class="va">summary_vars</span> <span class="op">=</span> <span class="fu"><a href="https://tidyselect.r-lib.org/reference/where.html">where</a></span><span class="op">(</span><span class="va">is.numeric</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">df</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarize</a></span><span class="op">(</span></span>
<span>      <span class="fu"><a href="https://dplyr.tidyverse.org/reference/across.html">across</a></span><span class="op">(</span><span class="op">{</span><span class="op">{</span> <span class="va">summary_vars</span> <span class="op">}</span><span class="op">}</span>, \<span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">x</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span>,</span>
<span>      n <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html">n</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>      .groups <span class="op">=</span> <span class="st">"drop"</span></span>
<span>    <span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="va">diamonds</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">cut</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">summarize_means</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 5 × 9</span></span>
<span><span class="co">#&gt;   cut       carat depth table price     x     y     z     n</span></span>
<span><span class="co">#&gt;   &lt;ord&gt;     &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;int&gt;</span></span>
<span><span class="co">#&gt; 1 Fair      1.05   64.0  59.1 4359.  6.25  6.18  3.98  1610</span></span>
<span><span class="co">#&gt; 2 Good      0.849  62.4  58.7 3929.  5.84  5.85  3.64  4906</span></span>
<span><span class="co">#&gt; 3 Very Good 0.806  61.8  58.0 3982.  5.74  5.77  3.56 12082</span></span>
<span><span class="co">#&gt; 4 Premium   0.892  61.3  58.7 4584.  5.97  5.94  3.65 13791</span></span>
<span><span class="co">#&gt; 5 Ideal     0.703  61.7  56.0 3458.  5.51  5.52  3.40 21551</span></span>
<span></span>
<span><span class="va">diamonds</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">cut</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">summarize_means</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">carat</span>, <span class="va">x</span><span class="op">:</span><span class="va">z</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 5 × 6</span></span>
<span><span class="co">#&gt;   cut       carat     x     y     z     n</span></span>
<span><span class="co">#&gt;   &lt;ord&gt;     &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;int&gt;</span></span>
<span><span class="co">#&gt; 1 Fair      1.05   6.25  6.18  3.98  1610</span></span>
<span><span class="co">#&gt; 2 Good      0.849  5.84  5.85  3.64  4906</span></span>
<span><span class="co">#&gt; 3 Very Good 0.806  5.74  5.77  3.56 12082</span></span>
<span><span class="co">#&gt; 4 Premium   0.892  5.97  5.94  3.65 13791</span></span>
<span><span class="co">#&gt; 5 Ideal     0.703  5.51  5.52  3.40 21551</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section><section id="pivot_longer와-비교" class="level3" data-number="26.2.7"><h3 data-number="26.2.7" class="anchored" data-anchor-id="pivot_longer와-비교">
<span class="header-section-number">26.2.7</span> <code>pivot_longer()</code>와 비교</h3>
<p>계속 진행하기 전에 <code><a href="https://dplyr.tidyverse.org/reference/across.html">across()</a></code>와 <code><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html">pivot_longer()</a></code>(<a href="data-tidy.html#sec-pivoting" class="quarto-xref"><span>Section 5.3</span></a>) 사이의 흥미로운 연결 고리를 짚고 넘어갈 가치가 있습니다. 많은 경우, 먼저 데이터를 피벗한 다음 열이 아닌 그룹별로 연산을 수행하여 동일한 계산을 수행할 수 있습니다. 예를 들어, 이 다중 함수 요약을 보세요:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb19"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">df</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarize</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/across.html">across</a></span><span class="op">(</span><span class="va">a</span><span class="op">:</span><span class="va">d</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>median <span class="op">=</span> <span class="va">median</span>, mean <span class="op">=</span> <span class="va">mean</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 1 × 8</span></span>
<span><span class="co">#&gt;   a_median  a_mean b_median  b_mean c_median  c_mean d_median d_mean</span></span>
<span><span class="co">#&gt;      &lt;dbl&gt;   &lt;dbl&gt;    &lt;dbl&gt;   &lt;dbl&gt;    &lt;dbl&gt;   &lt;dbl&gt;    &lt;dbl&gt;  &lt;dbl&gt;</span></span>
<span><span class="co">#&gt; 1   -0.246 -0.0426    0.155 -0.0656   0.0480 -0.0297   -0.193 -0.200</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>피벗을 더 길게(longer) 한 다음 요약하여 동일한 값을 계산할 수 있습니다:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb20"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">long</span> <span class="op">&lt;-</span> <span class="va">df</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html">pivot_longer</a></span><span class="op">(</span><span class="va">a</span><span class="op">:</span><span class="va">d</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">name</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarize</a></span><span class="op">(</span></span>
<span>    median <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/median.html">median</a></span><span class="op">(</span><span class="va">value</span><span class="op">)</span>,</span>
<span>    mean <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">value</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="va">long</span></span>
<span><span class="co">#&gt; # A tibble: 4 × 3</span></span>
<span><span class="co">#&gt;   name   median    mean</span></span>
<span><span class="co">#&gt;   &lt;chr&gt;   &lt;dbl&gt;   &lt;dbl&gt;</span></span>
<span><span class="co">#&gt; 1 a     -0.246  -0.0426</span></span>
<span><span class="co">#&gt; 2 b      0.155  -0.0656</span></span>
<span><span class="co">#&gt; 3 c      0.0480 -0.0297</span></span>
<span><span class="co">#&gt; 4 d     -0.193  -0.200</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>그리고 <code><a href="https://dplyr.tidyverse.org/reference/across.html">across()</a></code>와 동일한 구조를 원한다면 다시 피벗할 수 있습니다:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb21"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">long</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_wider.html">pivot_wider</a></span><span class="op">(</span></span>
<span>    names_from <span class="op">=</span> <span class="va">name</span>,</span>
<span>    values_from <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">median</span>, <span class="va">mean</span><span class="op">)</span>,</span>
<span>    names_vary <span class="op">=</span> <span class="st">"slowest"</span>,</span>
<span>    names_glue <span class="op">=</span> <span class="st">"{name}_{.value}"</span></span>
<span>  <span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 1 × 8</span></span>
<span><span class="co">#&gt;   a_median  a_mean b_median  b_mean c_median  c_mean d_median d_mean</span></span>
<span><span class="co">#&gt;      &lt;dbl&gt;   &lt;dbl&gt;    &lt;dbl&gt;   &lt;dbl&gt;    &lt;dbl&gt;   &lt;dbl&gt;    &lt;dbl&gt;  &lt;dbl&gt;</span></span>
<span><span class="co">#&gt; 1   -0.246 -0.0426    0.155 -0.0656   0.0480 -0.0297   -0.193 -0.200</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>이것은 가끔 현재 <code><a href="https://dplyr.tidyverse.org/reference/across.html">across()</a></code>로는 해결할 수 없는 문제에 부딪힐 때 유용한 기술입니다. 즉, 동시에 계산하려는 열 그룹이 있는 경우입니다. 예를 들어, 데이터 프레임에 값과 가중치가 모두 포함되어 있고 가중 평균을 계산하고 싶다고 가정해 봅시다:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb22"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">1014</span><span class="op">)</span></span>
<span><span class="va">df_paired</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html">tibble</a></span><span class="op">(</span></span>
<span>  a_val <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="fl">10</span><span class="op">)</span>,</span>
<span>  a_wts <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html">runif</a></span><span class="op">(</span><span class="fl">10</span><span class="op">)</span>,</span>
<span>  b_val <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="fl">10</span><span class="op">)</span>,</span>
<span>  b_wts <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html">runif</a></span><span class="op">(</span><span class="fl">10</span><span class="op">)</span>,</span>
<span>  c_val <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="fl">10</span><span class="op">)</span>,</span>
<span>  c_wts <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html">runif</a></span><span class="op">(</span><span class="fl">10</span><span class="op">)</span>,</span>
<span>  d_val <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="fl">10</span><span class="op">)</span>,</span>
<span>  d_wts <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html">runif</a></span><span class="op">(</span><span class="fl">10</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>현재로서는 <code><a href="https://dplyr.tidyverse.org/reference/across.html">across()</a></code>를 사용하여 이 작업을 수행할 수 있는 방법이 없지만<a href="#fn4" class="footnote-ref" id="fnref4" role="doc-noteref"><sup>4</sup></a>, <code><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html">pivot_longer()</a></code>를 사용하면 비교적 간단합니다:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb23"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">df_long</span> <span class="op">&lt;-</span> <span class="va">df_paired</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html">pivot_longer</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://tidyselect.r-lib.org/reference/everything.html">everything</a></span><span class="op">(</span><span class="op">)</span>, </span>
<span>    names_to <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"group"</span>, <span class="st">".value"</span><span class="op">)</span>, </span>
<span>    names_sep <span class="op">=</span> <span class="st">"_"</span></span>
<span>  <span class="op">)</span></span>
<span><span class="va">df_long</span></span>
<span><span class="co">#&gt; # A tibble: 40 × 3</span></span>
<span><span class="co">#&gt;   group    val   wts</span></span>
<span><span class="co">#&gt;   &lt;chr&gt;  &lt;dbl&gt; &lt;dbl&gt;</span></span>
<span><span class="co">#&gt; 1 a     -1.40  0.290</span></span>
<span><span class="co">#&gt; 2 b     -1.86  0.461</span></span>
<span><span class="co">#&gt; 3 c      0.935 0.528</span></span>
<span><span class="co">#&gt; 4 d      2.76  0.709</span></span>
<span><span class="co">#&gt; 5 a      0.255 0.678</span></span>
<span><span class="co">#&gt; 6 b     -0.522 0.315</span></span>
<span><span class="co">#&gt; # ℹ 34 more rows</span></span>
<span></span>
<span><span class="va">df_long</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">group</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarize</a></span><span class="op">(</span>mean <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/weighted.mean.html">weighted.mean</a></span><span class="op">(</span><span class="va">val</span>, <span class="va">wts</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 4 × 2</span></span>
<span><span class="co">#&gt;   group    mean</span></span>
<span><span class="co">#&gt;   &lt;chr&gt;   &lt;dbl&gt;</span></span>
<span><span class="co">#&gt; 1 a     -0.207 </span></span>
<span><span class="co">#&gt; 2 b     -0.237 </span></span>
<span><span class="co">#&gt; 3 c      0.0208</span></span>
<span><span class="co">#&gt; 4 d      0.0655</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>필요한 경우 <code><a href="https://tidyr.tidyverse.org/reference/pivot_wider.html">pivot_wider()</a></code>를 사용하여 이를 다시 원래 형태로 되돌릴 수 있습니다.</p>
</section><section id="연습문제" class="level3" data-number="26.2.8"><h3 data-number="26.2.8" class="anchored" data-anchor-id="연습문제">
<span class="header-section-number">26.2.8</span> 연습문제</h3>
<ol type="1">
<li>
<p>다음을 수행하여 <code><a href="https://dplyr.tidyverse.org/reference/across.html">across()</a></code> 기술을 연습하세요:</p>
<ol type="1">
<li><p><code><a href="https://allisonhorst.github.io/palmerpenguins/reference/penguins.html">palmerpenguins::penguins</a></code>의 각 열에 있는 고유 값의 개수를 계산합니다.</p></li>
<li><p><code>mtcars</code>의 모든 열의 평균을 계산합니다.</p></li>
<li><p><code>diamonds</code>를 <code>cut</code>, <code>clarity</code>, <code>color</code>로 그룹화한 다음 관측값 개수를 세고 각 수치형 열의 평균을 계산합니다.</p></li>
</ol>
</li>
<li><p><code><a href="https://dplyr.tidyverse.org/reference/across.html">across()</a></code>에 함수 리스트를 사용하면서 이름을 지정하지 않으면 어떻게 됩니까? 출력 이름은 어떻게 지정됩니까?</p></li>
<li><p>날짜 열이 확장된 후 자동으로 제거되도록 <code>expand_dates()</code>를 조정하세요. 인수를 감싸야(embrace) 합니까?</p></li>
<li>
<p>이 함수 파이프라인의 각 단계가 무엇을 하는지 설명하세요. <code><a href="https://tidyselect.r-lib.org/reference/where.html">where()</a></code>의 어떤 특별한 기능을 활용하고 있습니까?</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb24"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">show_missing</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">df</span>, <span class="va">group_vars</span>, <span class="va">summary_vars</span> <span class="op">=</span> <span class="fu"><a href="https://tidyselect.r-lib.org/reference/everything.html">everything</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">df</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/pick.html">pick</a></span><span class="op">(</span><span class="op">{</span><span class="op">{</span> <span class="va">group_vars</span> <span class="op">}</span><span class="op">}</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarize</a></span><span class="op">(</span></span>
<span>      <span class="fu"><a href="https://dplyr.tidyverse.org/reference/across.html">across</a></span><span class="op">(</span><span class="op">{</span><span class="op">{</span> <span class="va">summary_vars</span> <span class="op">}</span><span class="op">}</span>, \<span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,</span>
<span>      .groups <span class="op">=</span> <span class="st">"drop"</span></span>
<span>    <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/where.html">where</a></span><span class="op">(</span>\<span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/any.html">any</a></span><span class="op">(</span><span class="va">x</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="fu">nycflights13</span><span class="fu">::</span><span class="va"><a href="https://rdrr.io/pkg/nycflights13/man/flights.html">flights</a></span> <span class="op">|&gt;</span> <span class="fu">show_missing</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">year</span>, <span class="va">month</span>, <span class="va">day</span><span class="op">)</span><span class="op">)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</li>
</ol></section></section><section id="여러-파일-읽기" class="level2" data-number="26.3"><h2 data-number="26.3" class="anchored" data-anchor-id="여러-파일-읽기">
<span class="header-section-number">26.3</span> 여러 파일 읽기</h2>
<p>이전 섹션에서는 <code><a href="https://dplyr.tidyverse.org/reference/across.html">dplyr::across()</a></code>를 사용하여 여러 열에 대해 변환을 반복하는 방법을 배웠습니다. 이 섹션에서는 <code><a href="https://purrr.tidyverse.org/reference/map.html">purrr::map()</a></code>을 사용하여 디렉터리의 모든 파일에 대해 작업을 수행하는 방법을 배울 것입니다. 간단한 동기 부여로 시작하겠습니다. 읽고 싶은 엑셀 스프레드시트로 가득 찬 디렉터리가 있다고 가정해 봅시다<a href="#fn5" class="footnote-ref" id="fnref5" role="doc-noteref"><sup>5</sup></a>. 복사해서 붙여넣기를 사용하여 할 수 있습니다:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb25"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">data2019</span> <span class="op">&lt;-</span> <span class="fu">readxl</span><span class="fu">::</span><span class="fu"><a href="https://readxl.tidyverse.org/reference/read_excel.html">read_excel</a></span><span class="op">(</span><span class="st">"data/y2019.xlsx"</span><span class="op">)</span></span>
<span><span class="va">data2020</span> <span class="op">&lt;-</span> <span class="fu">readxl</span><span class="fu">::</span><span class="fu"><a href="https://readxl.tidyverse.org/reference/read_excel.html">read_excel</a></span><span class="op">(</span><span class="st">"data/y2020.xlsx"</span><span class="op">)</span></span>
<span><span class="va">data2021</span> <span class="op">&lt;-</span> <span class="fu">readxl</span><span class="fu">::</span><span class="fu"><a href="https://readxl.tidyverse.org/reference/read_excel.html">read_excel</a></span><span class="op">(</span><span class="st">"data/y2021.xlsx"</span><span class="op">)</span></span>
<span><span class="va">data2022</span> <span class="op">&lt;-</span> <span class="fu">readxl</span><span class="fu">::</span><span class="fu"><a href="https://readxl.tidyverse.org/reference/read_excel.html">read_excel</a></span><span class="op">(</span><span class="st">"data/y2022.xlsx"</span><span class="op">)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>그런 다음 <code><a href="https://dplyr.tidyverse.org/reference/bind_rows.html">dplyr::bind_rows()</a></code>를 사용하여 모두 결합합니다:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb26"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html">bind_rows</a></span><span class="op">(</span><span class="va">data2019</span>, <span class="va">data2020</span>, <span class="va">data2021</span>, <span class="va">data2022</span><span class="op">)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>이 작업은 파일이 4개가 아니라 수백 개라면 금방 지루해질 것임을 상상할 수 있습니다. 다음 섹션들에서는 이러한 종류의 작업을 자동화하는 방법을 보여줍니다. 세 가지 기본 단계가 있습니다: <code><a href="https://rdrr.io/r/base/list.files.html">list.files()</a></code>를 사용하여 디렉터리의 모든 파일을 나열한 다음, <code><a href="https://purrr.tidyverse.org/reference/map.html">purrr::map()</a></code>을 사용하여 각 파일을 리스트로 읽어 들인 다음, <code><a href="https://purrr.tidyverse.org/reference/list_c.html">purrr::list_rbind()</a></code>를 사용하여 이를 단일 데이터 프레임으로 결합합니다. 그런 다음 모든 파일에 대해 정확히 동일한 작업을 수행할 수 없는, 이질성이 증가하는 상황을 처리하는 방법에 대해 논의하겠습니다.</p>
<section id="디렉터리의-파일-나열하기" class="level3" data-number="26.3.1"><h3 data-number="26.3.1" class="anchored" data-anchor-id="디렉터리의-파일-나열하기">
<span class="header-section-number">26.3.1</span> 디렉터리의 파일 나열하기</h3>
<p>이름에서 알 수 있듯이 <code><a href="https://rdrr.io/r/base/list.files.html">list.files()</a></code>는 디렉터리의 파일을 나열합니다. 거의 항상 다음 세 가지 인수를 사용하게 될 것입니다:</p>
<ul>
<li><p>첫 번째 인수 <code>path</code>는 살펴볼 디렉터리입니다.</p></li>
<li><p><code>pattern</code>은 파일 이름을 필터링하는 데 사용되는 정규 표현식입니다. 가장 일반적인 패턴은 지정된 확장자를 가진 모든 파일을 찾기 위한 <code>[.]xlsx$</code> 또는 <code>[.]csv$</code>와 같은 것입니다.</p></li>
<li><p><code>full.names</code>는 디렉터리 이름을 출력에 포함할지 여부를 결정합니다. 거의 항상 이것을 <code>TRUE</code>로 설정하고 싶을 것입니다.</p></li>
</ul>
<p>우리의 동기 부여 예제를 구체화하기 위해, 이 책에는 gapminder 패키지의 데이터가 포함된 12개의 엑셀 스프레드시트가 있는 폴더가 있습니다. 이 폴더는 <a href="https://github.com/hadley/r4ds/tree/main/data/gapminder" class="uri">https://github.com/hadley/r4ds/tree/main/data/gapminder</a>에서 찾을 수 있습니다. 각 파일에는 142개 국가에 대한 1년 치 데이터가 들어 있습니다. 적절한 <code><a href="https://rdrr.io/r/base/list.files.html">list.files()</a></code> 호출로 이를 모두 나열할 수 있습니다:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb27"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">paths</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.files.html">list.files</a></span><span class="op">(</span><span class="st">"data/gapminder"</span>, pattern <span class="op">=</span> <span class="st">"[.]xlsx$"</span>, full.names <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">paths</span></span>
<span><span class="co">#&gt;  [1] "data/gapminder/1952.xlsx" "data/gapminder/1957.xlsx"</span></span>
<span><span class="co">#&gt;  [3] "data/gapminder/1962.xlsx" "data/gapminder/1967.xlsx"</span></span>
<span><span class="co">#&gt;  [5] "data/gapminder/1972.xlsx" "data/gapminder/1977.xlsx"</span></span>
<span><span class="co">#&gt;  [7] "data/gapminder/1982.xlsx" "data/gapminder/1987.xlsx"</span></span>
<span><span class="co">#&gt;  [9] "data/gapminder/1992.xlsx" "data/gapminder/1997.xlsx"</span></span>
<span><span class="co">#&gt; [11] "data/gapminder/2002.xlsx" "data/gapminder/2007.xlsx"</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section><section id="리스트" class="level3" data-number="26.3.2"><h3 data-number="26.3.2" class="anchored" data-anchor-id="리스트">
<span class="header-section-number">26.3.2</span> 리스트</h3>
<p>이제 이 12개의 경로가 있으므로 <code>read_excel()</code>을 12번 호출하여 12개의 데이터 프레임을 얻을 수 있습니다:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>gapminder_1952 <span class="ot">&lt;-</span> readxl<span class="sc">::</span><span class="fu">read_excel</span>(<span class="st">"data/gapminder/1952.xlsx"</span>)</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>gapminder_1957 <span class="ot">&lt;-</span> readxl<span class="sc">::</span><span class="fu">read_excel</span>(<span class="st">"data/gapminder/1957.xlsx"</span>)</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>gapminder_1962 <span class="ot">&lt;-</span> readxl<span class="sc">::</span><span class="fu">read_excel</span>(<span class="st">"data/gapminder/1962.xlsx"</span>)</span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a> ...,</span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>gapminder_2007 <span class="ot">&lt;-</span> readxl<span class="sc">::</span><span class="fu">read_excel</span>(<span class="st">"data/gapminder/2007.xlsx"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>하지만 각 시트를 자체 변수에 넣으면 몇 단계 후에 작업하기가 매우 어려워질 것입니다. 대신 단일 객체에 넣는 것이 작업하기 더 쉬울 것입니다. 리스트는 이 작업에 완벽한 도구입니다:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb29"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">files</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span></span>
<span>  <span class="fu">readxl</span><span class="fu">::</span><span class="fu"><a href="https://readxl.tidyverse.org/reference/read_excel.html">read_excel</a></span><span class="op">(</span><span class="st">"data/gapminder/1952.xlsx"</span><span class="op">)</span>,</span>
<span>  <span class="fu">readxl</span><span class="fu">::</span><span class="fu"><a href="https://readxl.tidyverse.org/reference/read_excel.html">read_excel</a></span><span class="op">(</span><span class="st">"data/gapminder/1957.xlsx"</span><span class="op">)</span>,</span>
<span>  <span class="fu">readxl</span><span class="fu">::</span><span class="fu"><a href="https://readxl.tidyverse.org/reference/read_excel.html">read_excel</a></span><span class="op">(</span><span class="st">"data/gapminder/1962.xlsx"</span><span class="op">)</span>,</span>
<span>  <span class="va">...</span>,</span>
<span>  <span class="fu">readxl</span><span class="fu">::</span><span class="fu"><a href="https://readxl.tidyverse.org/reference/read_excel.html">read_excel</a></span><span class="op">(</span><span class="st">"data/gapminder/2007.xlsx"</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>이제 리스트에 이 데이터 프레임들이 있으니, 어떻게 하나를 꺼낼까요? <code>files[[i]]</code>를 사용하여 i번째 요소를 추출할 수 있습니다:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb30"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">files</span><span class="op">[[</span><span class="fl">3</span><span class="op">]</span><span class="op">]</span></span>
<span><span class="co">#&gt; # A tibble: 142 × 5</span></span>
<span><span class="co">#&gt;   country     continent lifeExp      pop gdpPercap</span></span>
<span><span class="co">#&gt;   &lt;chr&gt;       &lt;chr&gt;       &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt;</span></span>
<span><span class="co">#&gt; 1 Afghanistan Asia         32.0 10267083      853.</span></span>
<span><span class="co">#&gt; 2 Albania     Europe       64.8  1728137     2313.</span></span>
<span><span class="co">#&gt; 3 Algeria     Africa       48.3 11000948     2551.</span></span>
<span><span class="co">#&gt; 4 Angola      Africa       34    4826015     4269.</span></span>
<span><span class="co">#&gt; 5 Argentina   Americas     65.1 21283783     7133.</span></span>
<span><span class="co">#&gt; 6 Australia   Oceania      70.9 10794968    12217.</span></span>
<span><span class="co">#&gt; # ℹ 136 more rows</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p><code>[[</code>에 대해서는 <a href="base-R.html#sec-subset-one" class="quarto-xref"><span>Section 27.3</span></a> 에서 더 자세히 다루겠습니다.</p>
</section><section id="purrrmap과-list_rbind" class="level3" data-number="26.3.3"><h3 data-number="26.3.3" class="anchored" data-anchor-id="purrrmap과-list_rbind">
<span class="header-section-number">26.3.3</span> <code>purrr::map()</code>과 <code>list_rbind()</code>
</h3>
<p>해당 데이터 프레임들을 리스트에 “수동으로” 모으는 코드는 파일을 하나씩 읽는 코드만큼이나 입력하기 지루합니다. 다행히도 <code><a href="https://purrr.tidyverse.org/reference/map.html">purrr::map()</a></code>을 사용하여 <code>paths</code> 벡터를 훨씬 더 잘 활용할 수 있습니다. <code><a href="https://purrr.tidyverse.org/reference/map.html">map()</a></code>은 <code><a href="https://dplyr.tidyverse.org/reference/across.html">across()</a></code>와 비슷하지만, 데이터 프레임의 각 열에 대해 작업을 수행하는 대신 벡터의 각 요소에 대해 작업을 수행합니다. <code>map(x, f)</code>는 다음의 단축 표현입니다:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb31"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span></span>
<span>  <span class="fu">f</span><span class="op">(</span><span class="va">x</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>,</span>
<span>  <span class="fu">f</span><span class="op">(</span><span class="va">x</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>,</span>
<span>  <span class="va">...</span>,</span>
<span>  <span class="fu">f</span><span class="op">(</span><span class="va">x</span><span class="op">[[</span><span class="va">n</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>따라서 <code><a href="https://purrr.tidyverse.org/reference/map.html">map()</a></code>을 사용하여 12개의 데이터 프레임 리스트를 얻을 수 있습니다:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb32"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">files</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map</a></span><span class="op">(</span><span class="va">paths</span>, <span class="fu">readxl</span><span class="fu">::</span><span class="va"><a href="https://readxl.tidyverse.org/reference/read_excel.html">read_excel</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">files</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 12</span></span>
<span></span>
<span><span class="va">files</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></span>
<span><span class="co">#&gt; # A tibble: 142 × 5</span></span>
<span><span class="co">#&gt;   country     continent lifeExp      pop gdpPercap</span></span>
<span><span class="co">#&gt;   &lt;chr&gt;       &lt;chr&gt;       &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt;</span></span>
<span><span class="co">#&gt; 1 Afghanistan Asia         28.8  8425333      779.</span></span>
<span><span class="co">#&gt; 2 Albania     Europe       55.2  1282697     1601.</span></span>
<span><span class="co">#&gt; 3 Algeria     Africa       43.1  9279525     2449.</span></span>
<span><span class="co">#&gt; 4 Angola      Africa       30.0  4232095     3521.</span></span>
<span><span class="co">#&gt; 5 Argentina   Americas     62.5 17876956     5911.</span></span>
<span><span class="co">#&gt; 6 Australia   Oceania      69.1  8691212    10040.</span></span>
<span><span class="co">#&gt; # ℹ 136 more rows</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>(이것은 <code><a href="https://rdrr.io/r/utils/str.html">str()</a></code>로 특히 간결하게 표시되지 않는 또 다른 데이터 구조이므로, RStudio에 로드하고 <code><a href="https://rdrr.io/r/utils/View.html">View()</a></code>로 검사하고 싶을 수 있습니다.)</p>
<p>이제 <code><a href="https://purrr.tidyverse.org/reference/list_c.html">purrr::list_rbind()</a></code>를 사용하여 해당 데이터 프레임 리스트를 단일 데이터 프레임으로 결합할 수 있습니다:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb33"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://purrr.tidyverse.org/reference/list_c.html">list_rbind</a></span><span class="op">(</span><span class="va">files</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 1,704 × 5</span></span>
<span><span class="co">#&gt;   country     continent lifeExp      pop gdpPercap</span></span>
<span><span class="co">#&gt;   &lt;chr&gt;       &lt;chr&gt;       &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt;</span></span>
<span><span class="co">#&gt; 1 Afghanistan Asia         28.8  8425333      779.</span></span>
<span><span class="co">#&gt; 2 Albania     Europe       55.2  1282697     1601.</span></span>
<span><span class="co">#&gt; 3 Algeria     Africa       43.1  9279525     2449.</span></span>
<span><span class="co">#&gt; 4 Angola      Africa       30.0  4232095     3521.</span></span>
<span><span class="co">#&gt; 5 Argentina   Americas     62.5 17876956     5911.</span></span>
<span><span class="co">#&gt; 6 Australia   Oceania      69.1  8691212    10040.</span></span>
<span><span class="co">#&gt; # ℹ 1,698 more rows</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>또는 파이프라인에서 두 단계를 한 번에 수행할 수도 있습니다:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb34"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">paths</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map</a></span><span class="op">(</span><span class="fu">readxl</span><span class="fu">::</span><span class="va"><a href="https://readxl.tidyverse.org/reference/read_excel.html">read_excel</a></span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://purrr.tidyverse.org/reference/list_c.html">list_rbind</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p><code>read_excel()</code>에 추가 인수를 전달하고 싶다면 어떻게 할까요? <code><a href="https://dplyr.tidyverse.org/reference/across.html">across()</a></code>와 동일한 기술을 사용합니다. 예를 들어, <code>n_max = 1</code>을 사용하여 데이터의 처음 몇 행만 엿보는 것이 종종 유용합니다:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb35"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">paths</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map</a></span><span class="op">(</span>\<span class="op">(</span><span class="va">path</span><span class="op">)</span> <span class="fu">readxl</span><span class="fu">::</span><span class="fu"><a href="https://readxl.tidyverse.org/reference/read_excel.html">read_excel</a></span><span class="op">(</span><span class="va">path</span>, n_max <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://purrr.tidyverse.org/reference/list_c.html">list_rbind</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 12 × 5</span></span>
<span><span class="co">#&gt;   country     continent lifeExp      pop gdpPercap</span></span>
<span><span class="co">#&gt;   &lt;chr&gt;       &lt;chr&gt;       &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt;</span></span>
<span><span class="co">#&gt; 1 Afghanistan Asia         28.8  8425333      779.</span></span>
<span><span class="co">#&gt; 2 Afghanistan Asia         30.3  9240934      821.</span></span>
<span><span class="co">#&gt; 3 Afghanistan Asia         32.0 10267083      853.</span></span>
<span><span class="co">#&gt; 4 Afghanistan Asia         34.0 11537966      836.</span></span>
<span><span class="co">#&gt; 5 Afghanistan Asia         36.1 13079460      740.</span></span>
<span><span class="co">#&gt; 6 Afghanistan Asia         38.4 14880372      786.</span></span>
<span><span class="co">#&gt; # ℹ 6 more rows</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>이것은 무언가 빠져 있다는 것을 명확히 해줍니다. <code>year</code> 열이 없는데, 해당 값은 개별 파일이 아니라 경로에 기록되어 있기 때문입니다. 다음으로 이 문제를 해결해 보겠습니다.</p>
</section><section id="sec-data-in-the-path" class="level3" data-number="26.3.4"><h3 data-number="26.3.4" class="anchored" data-anchor-id="sec-data-in-the-path">
<span class="header-section-number">26.3.4</span> 경로에 있는 데이터</h3>
<p>때로는 파일 이름 자체가 데이터이기도 합니다. 이 예제에서 파일 이름에는 연도가 포함되어 있는데, 이는 개별 파일 내부에는 기록되지 않습니다. 해당 열을 최종 데이터 프레임에 넣으려면 두 가지 작업을 수행해야 합니다:</p>
<p>먼저, 경로 벡터의 이름을 지정합니다. 가장 쉬운 방법은 함수를 인수로 받을 수 있는 <code><a href="https://rlang.r-lib.org/reference/set_names.html">set_names()</a></code> 함수를 사용하는 것입니다. 여기서는 <code><a href="https://rdrr.io/r/base/basename.html">basename()</a></code>을 사용하여 전체 경로에서 파일 이름만 추출합니다:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb36"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">paths</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rlang.r-lib.org/reference/set_names.html">set_names</a></span><span class="op">(</span><span class="va">basename</span><span class="op">)</span></span>
<span><span class="co">#&gt;                  1952.xlsx                  1957.xlsx </span></span>
<span><span class="co">#&gt; "data/gapminder/1952.xlsx" "data/gapminder/1957.xlsx" </span></span>
<span><span class="co">#&gt;                  1962.xlsx                  1967.xlsx </span></span>
<span><span class="co">#&gt; "data/gapminder/1962.xlsx" "data/gapminder/1967.xlsx" </span></span>
<span><span class="co">#&gt;                  1972.xlsx                  1977.xlsx </span></span>
<span><span class="co">#&gt; "data/gapminder/1972.xlsx" "data/gapminder/1977.xlsx" </span></span>
<span><span class="co">#&gt;                  1982.xlsx                  1987.xlsx </span></span>
<span><span class="co">#&gt; "data/gapminder/1982.xlsx" "data/gapminder/1987.xlsx" </span></span>
<span><span class="co">#&gt;                  1992.xlsx                  1997.xlsx </span></span>
<span><span class="co">#&gt; "data/gapminder/1992.xlsx" "data/gapminder/1997.xlsx" </span></span>
<span><span class="co">#&gt;                  2002.xlsx                  2007.xlsx </span></span>
<span><span class="co">#&gt; "data/gapminder/2002.xlsx" "data/gapminder/2007.xlsx"</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>이 이름들은 모든 map 함수에 의해 자동으로 전달되므로, 데이터 프레임 리스트도 동일한 이름을 갖게 됩니다:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb37"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">files</span> <span class="op">&lt;-</span> <span class="va">paths</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://rlang.r-lib.org/reference/set_names.html">set_names</a></span><span class="op">(</span><span class="va">basename</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map</a></span><span class="op">(</span><span class="fu">readxl</span><span class="fu">::</span><span class="va"><a href="https://readxl.tidyverse.org/reference/read_excel.html">read_excel</a></span><span class="op">)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>이렇게 하면 <code><a href="https://purrr.tidyverse.org/reference/map.html">map()</a></code> 호출은 다음의 단축 표현이 됩니다:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb38"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">files</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span></span>
<span>  <span class="st">"1952.xlsx"</span> <span class="op">=</span> <span class="fu">readxl</span><span class="fu">::</span><span class="fu"><a href="https://readxl.tidyverse.org/reference/read_excel.html">read_excel</a></span><span class="op">(</span><span class="st">"data/gapminder/1952.xlsx"</span><span class="op">)</span>,</span>
<span>  <span class="st">"1957.xlsx"</span> <span class="op">=</span> <span class="fu">readxl</span><span class="fu">::</span><span class="fu"><a href="https://readxl.tidyverse.org/reference/read_excel.html">read_excel</a></span><span class="op">(</span><span class="st">"data/gapminder/1957.xlsx"</span><span class="op">)</span>,</span>
<span>  <span class="st">"1962.xlsx"</span> <span class="op">=</span> <span class="fu">readxl</span><span class="fu">::</span><span class="fu"><a href="https://readxl.tidyverse.org/reference/read_excel.html">read_excel</a></span><span class="op">(</span><span class="st">"data/gapminder/1962.xlsx"</span><span class="op">)</span>,</span>
<span>  <span class="va">...</span>,</span>
<span>  <span class="st">"2007.xlsx"</span> <span class="op">=</span> <span class="fu">readxl</span><span class="fu">::</span><span class="fu"><a href="https://readxl.tidyverse.org/reference/read_excel.html">read_excel</a></span><span class="op">(</span><span class="st">"data/gapminder/2007.xlsx"</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>또한 <code>[[</code>를 사용하여 이름으로 요소를 추출할 수 있습니다:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb39"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">files</span><span class="op">[[</span><span class="st">"1962.xlsx"</span><span class="op">]</span><span class="op">]</span></span>
<span><span class="co">#&gt; # A tibble: 142 × 5</span></span>
<span><span class="co">#&gt;   country     continent lifeExp      pop gdpPercap</span></span>
<span><span class="co">#&gt;   &lt;chr&gt;       &lt;chr&gt;       &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt;</span></span>
<span><span class="co">#&gt; 1 Afghanistan Asia         32.0 10267083      853.</span></span>
<span><span class="co">#&gt; 2 Albania     Europe       64.8  1728137     2313.</span></span>
<span><span class="co">#&gt; 3 Algeria     Africa       48.3 11000948     2551.</span></span>
<span><span class="co">#&gt; 4 Angola      Africa       34    4826015     4269.</span></span>
<span><span class="co">#&gt; 5 Argentina   Americas     65.1 21283783     7133.</span></span>
<span><span class="co">#&gt; 6 Australia   Oceania      70.9 10794968    12217.</span></span>
<span><span class="co">#&gt; # ℹ 136 more rows</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>그런 다음 <code><a href="https://purrr.tidyverse.org/reference/list_c.html">list_rbind()</a></code>의 <code>names_to</code> 인수를 사용하여 이름을 <code>year</code>라는 새 열에 저장하도록 지시한 다음, <code><a href="https://readr.tidyverse.org/reference/parse_number.html">readr::parse_number()</a></code>를 사용하여 문자열에서 숫자를 추출합니다.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb40"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">paths</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://rlang.r-lib.org/reference/set_names.html">set_names</a></span><span class="op">(</span><span class="va">basename</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map</a></span><span class="op">(</span><span class="fu">readxl</span><span class="fu">::</span><span class="va"><a href="https://readxl.tidyverse.org/reference/read_excel.html">read_excel</a></span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://purrr.tidyverse.org/reference/list_c.html">list_rbind</a></span><span class="op">(</span>names_to <span class="op">=</span> <span class="st">"year"</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>year <span class="op">=</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/parse_number.html">parse_number</a></span><span class="op">(</span><span class="va">year</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 1,704 × 6</span></span>
<span><span class="co">#&gt;    year country     continent lifeExp      pop gdpPercap</span></span>
<span><span class="co">#&gt;   &lt;dbl&gt; &lt;chr&gt;       &lt;chr&gt;       &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt;</span></span>
<span><span class="co">#&gt; 1  1952 Afghanistan Asia         28.8  8425333      779.</span></span>
<span><span class="co">#&gt; 2  1952 Albania     Europe       55.2  1282697     1601.</span></span>
<span><span class="co">#&gt; 3  1952 Algeria     Africa       43.1  9279525     2449.</span></span>
<span><span class="co">#&gt; 4  1952 Angola      Africa       30.0  4232095     3521.</span></span>
<span><span class="co">#&gt; 5  1952 Argentina   Americas     62.5 17876956     5911.</span></span>
<span><span class="co">#&gt; 6  1952 Australia   Oceania      69.1  8691212    10040.</span></span>
<span><span class="co">#&gt; # ℹ 1,698 more rows</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>더 복잡한 경우에는 디렉터리 이름에 다른 변수가 저장되어 있거나, 파일 이름에 여러 데이터 비트가 포함되어 있을 수 있습니다. 이 경우 <code><a href="https://rlang.r-lib.org/reference/set_names.html">set_names()</a></code>(인수 없이)를 사용하여 전체 경로를 기록한 다음, <code><a href="https://tidyr.tidyverse.org/reference/separate_wider_delim.html">tidyr::separate_wider_delim()</a></code>과 그 친구들을 사용하여 유용한 열로 변환하세요.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb41"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">paths</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://rlang.r-lib.org/reference/set_names.html">set_names</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map</a></span><span class="op">(</span><span class="fu">readxl</span><span class="fu">::</span><span class="va"><a href="https://readxl.tidyverse.org/reference/read_excel.html">read_excel</a></span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://purrr.tidyverse.org/reference/list_c.html">list_rbind</a></span><span class="op">(</span>names_to <span class="op">=</span> <span class="st">"year"</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/separate_wider_delim.html">separate_wider_delim</a></span><span class="op">(</span><span class="va">year</span>, delim <span class="op">=</span> <span class="st">"/"</span>, names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="cn">NA</span>, <span class="st">"dir"</span>, <span class="st">"file"</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/separate_wider_delim.html">separate_wider_delim</a></span><span class="op">(</span><span class="va">file</span>, delim <span class="op">=</span> <span class="st">"."</span>, names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"file"</span>, <span class="st">"ext"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 1,704 × 8</span></span>
<span><span class="co">#&gt;   dir       file  ext   country     continent lifeExp      pop gdpPercap</span></span>
<span><span class="co">#&gt;   &lt;chr&gt;     &lt;chr&gt; &lt;chr&gt; &lt;chr&gt;       &lt;chr&gt;       &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt;</span></span>
<span><span class="co">#&gt; 1 gapminder 1952  xlsx  Afghanistan Asia         28.8  8425333      779.</span></span>
<span><span class="co">#&gt; 2 gapminder 1952  xlsx  Albania     Europe       55.2  1282697     1601.</span></span>
<span><span class="co">#&gt; 3 gapminder 1952  xlsx  Algeria     Africa       43.1  9279525     2449.</span></span>
<span><span class="co">#&gt; 4 gapminder 1952  xlsx  Angola      Africa       30.0  4232095     3521.</span></span>
<span><span class="co">#&gt; 5 gapminder 1952  xlsx  Argentina   Americas     62.5 17876956     5911.</span></span>
<span><span class="co">#&gt; 6 gapminder 1952  xlsx  Australia   Oceania      69.1  8691212    10040.</span></span>
<span><span class="co">#&gt; # ℹ 1,698 more rows</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section><section id="작업-저장" class="level3" data-number="26.3.5"><h3 data-number="26.3.5" class="anchored" data-anchor-id="작업-저장">
<span class="header-section-number">26.3.5</span> 작업 저장</h3>
<p>이제 멋지고 깔끔한 데이터 프레임을 얻기 위해 이 모든 노력을 기울였으니, 작업을 저장하기에 아주 좋은 시간입니다:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb42"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">gapminder</span> <span class="op">&lt;-</span> <span class="va">paths</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://rlang.r-lib.org/reference/set_names.html">set_names</a></span><span class="op">(</span><span class="va">basename</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map</a></span><span class="op">(</span><span class="fu">readxl</span><span class="fu">::</span><span class="va"><a href="https://readxl.tidyverse.org/reference/read_excel.html">read_excel</a></span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://purrr.tidyverse.org/reference/list_c.html">list_rbind</a></span><span class="op">(</span>names_to <span class="op">=</span> <span class="st">"year"</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>year <span class="op">=</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/parse_number.html">parse_number</a></span><span class="op">(</span><span class="va">year</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://readr.tidyverse.org/reference/write_delim.html">write_csv</a></span><span class="op">(</span><span class="va">gapminder</span>, <span class="st">"gapminder.csv"</span><span class="op">)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>이제 나중에 이 문제로 돌아올 때 단일 csv 파일을 읽어 들일 수 있습니다. 대규모의 풍부한 데이터셋의 경우 <a href="arrow.html#sec-parquet" class="quarto-xref"><span>Section 22.4</span></a> 에서 논의한 대로 <code>.csv</code>보다는 parquet를 사용하는 것이 더 나은 선택일 수 있습니다.</p>
<p>프로젝트에서 작업하는 경우, 이런 종류의 데이터 준비 작업을 수행하는 파일을 <code>0-cleanup.R</code>과 같은 이름으로 부르는 것이 좋습니다. 파일 이름의 <code>0</code>은 이 파일이 다른 무엇보다 먼저 실행되어야 함을 암시합니다.</p>
<p>입력 데이터 파일이 시간이 지남에 따라 변경된다면, 이런 종류의 데이터 정리 코드가 입력 파일 중 하나가 수정될 때마다 자동으로 다시 실행되도록 설정하는 <a href="https://docs.ropensci.org/targets/">targets</a>와 같은 도구를 배워서 사용하는 것을 고려해 보세요.</p>
</section><section id="여러-번의-단순한-반복" class="level3" data-number="26.3.6"><h3 data-number="26.3.6" class="anchored" data-anchor-id="여러-번의-단순한-반복">
<span class="header-section-number">26.3.6</span> 여러 번의 단순한 반복</h3>
<p>여기서는 데이터를 디스크에서 직접 로드했고, 운 좋게도 깔끔한 데이터셋을 얻었습니다. 대부분의 경우 추가적인 정리가 필요하며, 두 가지 기본 옵션이 있습니다. 복잡한 함수로 한 번의 반복을 수행하거나, 단순한 함수로 여러 번의 반복을 수행하는 것입니다. 우리의 경험상 대부분의 사람들은 먼저 한 번의 복잡한 반복을 시도하지만, 여러 번의 단순한 반복을 수행하는 것이 종종 더 좋습니다.</p>
<p>예를 들어 여러 파일을 읽어 들이고, 결측값을 필터링하고, 피벗한 다음, 결합하고 싶다고 가정해 봅시다. 문제에 접근하는 한 가지 방법은 파일을 받아서 그 모든 단계를 수행하는 함수를 작성한 다음 <code><a href="https://purrr.tidyverse.org/reference/map.html">map()</a></code>을 한 번 호출하는 것입니다:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb43"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">process_file</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">path</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html">read_csv</a></span><span class="op">(</span><span class="va">path</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">df</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">id</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>id <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/chartr.html">tolower</a></span><span class="op">(</span><span class="va">id</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html">pivot_longer</a></span><span class="op">(</span><span class="va">jan</span><span class="op">:</span><span class="va">dec</span>, names_to <span class="op">=</span> <span class="st">"month"</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">paths</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map</a></span><span class="op">(</span><span class="va">process_file</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://purrr.tidyverse.org/reference/list_c.html">list_rbind</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>또는 <code>process_file()</code>의 각 단계를 모든 파일에 대해 수행할 수도 있습니다:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb44"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">paths</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map</a></span><span class="op">(</span><span class="va">read_csv</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map</a></span><span class="op">(</span>\<span class="op">(</span><span class="va">df</span><span class="op">)</span> <span class="va">df</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">id</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map</a></span><span class="op">(</span>\<span class="op">(</span><span class="va">df</span><span class="op">)</span> <span class="va">df</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>id <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/chartr.html">tolower</a></span><span class="op">(</span><span class="va">id</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map</a></span><span class="op">(</span>\<span class="op">(</span><span class="va">df</span><span class="op">)</span> <span class="va">df</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html">pivot_longer</a></span><span class="op">(</span><span class="va">jan</span><span class="op">:</span><span class="va">dec</span>, names_to <span class="op">=</span> <span class="st">"month"</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://purrr.tidyverse.org/reference/list_c.html">list_rbind</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>이 접근 방식을 권장하는 이유는 첫 번째 파일을 올바르게 만드는 데 집착하지 않고 나머지로 넘어갈 수 있기 때문입니다. 정리 및 청소 작업을 할 때 모든 데이터를 고려함으로써 전체적으로 생각하고 더 높은 품질의 결과를 얻을 가능성이 큽니다.</p>
<p>이 특정 예제에서는 데이터 프레임들을 더 일찍 결합하여 또 다른 최적화를 할 수 있습니다. 그러면 일반적인 dplyr 동작에 의존할 수 있습니다:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb45"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">paths</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map</a></span><span class="op">(</span><span class="va">read_csv</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://purrr.tidyverse.org/reference/list_c.html">list_rbind</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">id</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>id <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/chartr.html">tolower</a></span><span class="op">(</span><span class="va">id</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html">pivot_longer</a></span><span class="op">(</span><span class="va">jan</span><span class="op">:</span><span class="va">dec</span>, names_to <span class="op">=</span> <span class="st">"month"</span><span class="op">)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section><section id="이질적인-데이터" class="level3" data-number="26.3.7"><h3 data-number="26.3.7" class="anchored" data-anchor-id="이질적인-데이터">
<span class="header-section-number">26.3.7</span> 이질적인 데이터</h3>
<p>불행히도 때로는 <code><a href="https://purrr.tidyverse.org/reference/map.html">map()</a></code>에서 <code><a href="https://purrr.tidyverse.org/reference/list_c.html">list_rbind()</a></code>로 바로 넘어갈 수 없는 경우가 있습니다. 데이터 프레임들이 너무 이질적이어서 <code><a href="https://purrr.tidyverse.org/reference/list_c.html">list_rbind()</a></code>가 실패하거나 별로 유용하지 않은 데이터 프레임을 생성하기 때문입니다. 이럴 때는 여전히 모든 파일을 로드하는 것부터 시작하는 것이 유용합니다:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb46"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">files</span> <span class="op">&lt;-</span> <span class="va">paths</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map</a></span><span class="op">(</span><span class="fu">readxl</span><span class="fu">::</span><span class="va"><a href="https://readxl.tidyverse.org/reference/read_excel.html">read_excel</a></span><span class="op">)</span> </span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>그런 다음 데이터 프레임의 구조를 캡처하여 데이터 과학 기술로 탐색할 수 있게 하는 전략이 매우 유용합니다. 그렇게 하는 한 가지 방법은 각 열에 대해 한 행씩 있는 티블을 반환하는 이 편리한 <code>df_types</code> 함수<a href="#fn6" class="footnote-ref" id="fnref6" role="doc-noteref"><sup>6</sup></a>를 사용하는 것입니다:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb47"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">df_types</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">df</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html">tibble</a></span><span class="op">(</span></span>
<span>    col_name <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span>, </span>
<span>    col_type <span class="op">=</span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map_chr</a></span><span class="op">(</span><span class="va">df</span>, <span class="fu">vctrs</span><span class="fu">::</span><span class="va"><a href="https://vctrs.r-lib.org/reference/vec_ptype_full.html">vec_ptype_full</a></span><span class="op">)</span>,</span>
<span>    n_miss <span class="op">=</span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map_int</a></span><span class="op">(</span><span class="va">df</span>, \<span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="fu">df_types</span><span class="op">(</span><span class="va">gapminder</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 6 × 3</span></span>
<span><span class="co">#&gt;   col_name  col_type  n_miss</span></span>
<span><span class="co">#&gt;   &lt;chr&gt;     &lt;chr&gt;      &lt;int&gt;</span></span>
<span><span class="co">#&gt; 1 year      double         0</span></span>
<span><span class="co">#&gt; 2 country   character      0</span></span>
<span><span class="co">#&gt; 3 continent character      0</span></span>
<span><span class="co">#&gt; 4 lifeExp   double         0</span></span>
<span><span class="co">#&gt; 5 pop       double         0</span></span>
<span><span class="co">#&gt; 6 gdpPercap double         0</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>그런 다음 이 함수를 모든 파일에 적용하고, 차이점이 어디에 있는지 더 쉽게 볼 수 있도록 피벗을 수행할 수 있습니다. 예를 들어, 이를 통해 우리가 작업해 온 gapminder 스프레드시트가 모두 상당히 동질적임을 쉽게 확인할 수 있습니다:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb48"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">files</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map</a></span><span class="op">(</span><span class="va">df_types</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://purrr.tidyverse.org/reference/list_c.html">list_rbind</a></span><span class="op">(</span>names_to <span class="op">=</span> <span class="st">"file_name"</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">n_miss</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_wider.html">pivot_wider</a></span><span class="op">(</span>names_from <span class="op">=</span> <span class="va">col_name</span>, values_from <span class="op">=</span> <span class="va">col_type</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 12 × 6</span></span>
<span><span class="co">#&gt;   file_name country   continent lifeExp pop    gdpPercap</span></span>
<span><span class="co">#&gt;   &lt;chr&gt;     &lt;chr&gt;     &lt;chr&gt;     &lt;chr&gt;   &lt;chr&gt;  &lt;chr&gt;    </span></span>
<span><span class="co">#&gt; 1 1952.xlsx character character double  double double   </span></span>
<span><span class="co">#&gt; 2 1957.xlsx character character double  double double   </span></span>
<span><span class="co">#&gt; 3 1962.xlsx character character double  double double   </span></span>
<span><span class="co">#&gt; 4 1967.xlsx character character double  double double   </span></span>
<span><span class="co">#&gt; 5 1972.xlsx character character double  double double   </span></span>
<span><span class="co">#&gt; 6 1977.xlsx character character double  double double   </span></span>
<span><span class="co">#&gt; # ℹ 6 more rows</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>파일 형식이 이질적이라면 성공적으로 병합하기 전에 추가 처리를 수행해야 할 수도 있습니다. 불행히도 이 부분은 여러분이 스스로 알아내도록 남겨두겠지만, <code><a href="https://purrr.tidyverse.org/reference/map_if.html">map_if()</a></code> 및 <code><a href="https://purrr.tidyverse.org/reference/map_if.html">map_at()</a></code>에 대해 읽어보는 것이 좋습니다. <code><a href="https://purrr.tidyverse.org/reference/map_if.html">map_if()</a></code>를 사용하면 값에 따라 리스트의 요소를 선택적으로 수정할 수 있고, <code><a href="https://purrr.tidyverse.org/reference/map_if.html">map_at()</a></code>을 사용하면 이름에 따라 요소를 선택적으로 수정할 수 있습니다.</p>
</section><section id="실패-처리" class="level3" data-number="26.3.8"><h3 data-number="26.3.8" class="anchored" data-anchor-id="실패-처리">
<span class="header-section-number">26.3.8</span> 실패 처리</h3>
<p>때로는 데이터의 구조가 너무 엉망이라 단일 명령으로 모든 파일을 읽을 수조차 없을 때가 있습니다. 그러면 <code><a href="https://purrr.tidyverse.org/reference/map.html">map()</a></code>의 단점 중 하나를 만나게 됩니다. 즉, 전체가 성공하거나 실패한다는 것입니다. <code><a href="https://purrr.tidyverse.org/reference/map.html">map()</a></code>은 디렉터리의 모든 파일을 성공적으로 읽거나, 아니면 오류와 함께 실패하여 파일을 하나도 읽지 못합니다. 이것은 짜증 나는 일입니다. 왜 단 하나의 실패가 다른 모든 성공에 접근하는 것을 막아야 할까요?</p>
<p>다행히 purrr에는 이 문제를 해결하기 위한 도우미인 <code><a href="https://purrr.tidyverse.org/reference/possibly.html">possibly()</a></code>가 있습니다. <code><a href="https://purrr.tidyverse.org/reference/possibly.html">possibly()</a></code>는 함수 연산자(function operator)로 알려져 있습니다. 함수를 인수로 받아 수정된 동작을 가진 함수를 반환합니다. 특히 <code><a href="https://purrr.tidyverse.org/reference/possibly.html">possibly()</a></code>는 함수가 오류를 발생시키는 대신 지정된 값을 반환하도록 변경합니다:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb49"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">files</span> <span class="op">&lt;-</span> <span class="va">paths</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map</a></span><span class="op">(</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/possibly.html">possibly</a></span><span class="op">(</span>\<span class="op">(</span><span class="va">path</span><span class="op">)</span> <span class="fu">readxl</span><span class="fu">::</span><span class="fu"><a href="https://readxl.tidyverse.org/reference/read_excel.html">read_excel</a></span><span class="op">(</span><span class="va">path</span><span class="op">)</span>, <span class="cn">NULL</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">data</span> <span class="op">&lt;-</span> <span class="va">files</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/list_c.html">list_rbind</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>이것은 여기서 특히 잘 작동하는데, <code><a href="https://purrr.tidyverse.org/reference/list_c.html">list_rbind()</a></code>가 많은 tidyverse 함수와 마찬가지로 <code>NULL</code>을 자동으로 무시하기 때문입니다.</p>
<p>이제 쉽게 읽을 수 있는 모든 데이터를 확보했으니, 일부 파일 로드에 실패한 이유와 그에 대해 무엇을 할지 알아내는 어려운 부분을 해결할 차례입니다. 먼저 실패한 경로들을 가져옵니다:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb50"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">failed</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map_vec</a></span><span class="op">(</span><span class="va">files</span>, <span class="va">is.null</span><span class="op">)</span></span>
<span><span class="va">paths</span><span class="op">[</span><span class="va">failed</span><span class="op">]</span></span>
<span><span class="co">#&gt; character(0)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>그런 다음 실패한 각 파일에 대해 가져오기 함수를 다시 호출하여 무엇이 잘못되었는지 확인합니다.</p>
</section></section><section id="여러-출력-저장하기" class="level2" data-number="26.4"><h2 data-number="26.4" class="anchored" data-anchor-id="여러-출력-저장하기">
<span class="header-section-number">26.4</span> 여러 출력 저장하기</h2>
<p>지난 섹션에서는 여러 파일을 단일 객체로 읽어 들이는 데 유용한 <code><a href="https://purrr.tidyverse.org/reference/map.html">map()</a></code>에 대해 배웠습니다. 이 섹션에서는 이제 그 반대 문제, 즉 하나 이상의 R 객체를 가져와서 하나 이상의 파일에 저장하는 방법을 살펴보겠습니다. 다음 세 가지 예제를 사용하여 이 과제를 탐구하겠습니다:</p>
<ul>
<li>여러 데이터 프레임을 하나의 데이터베이스에 저장하기.</li>
<li>여러 데이터 프레임을 여러 <code>.csv</code> 파일에 저장하기.</li>
<li>여러 플롯을 여러 <code>.png</code> 파일에 저장하기.</li>
</ul>
<section id="sec-save-database" class="level3" data-number="26.4.1"><h3 data-number="26.4.1" class="anchored" data-anchor-id="sec-save-database">
<span class="header-section-number">26.4.1</span> 데이터베이스에 쓰기</h3>
<p>때로는 한꺼번에 많은 파일로 작업할 때 모든 데이터를 메모리에 한 번에 올릴 수 없어서 <code>map(files, read_csv)</code>를 수행할 수 없는 경우가 있습니다. 이 문제를 처리하는 한 가지 접근 방식은 dbplyr을 사용하여 필요한 부분만 액세스할 수 있도록 데이터를 데이터베이스에 로드하는 것입니다.</p>
<p>운이 좋다면 사용 중인 데이터베이스 패키지가 경로 벡터를 받아서 모두 데이터베이스에 로드하는 편리한 함수를 제공할 것입니다. duckdb의 <code>duckdb_read_csv()</code>가 그런 사례입니다:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb51"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">con</span> <span class="op">&lt;-</span> <span class="fu">DBI</span><span class="fu">::</span><span class="fu"><a href="https://dbi.r-dbi.org/reference/dbConnect.html">dbConnect</a></span><span class="op">(</span><span class="fu">duckdb</span><span class="fu">::</span><span class="fu"><a href="https://r.duckdb.org/reference/duckdb.html">duckdb</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu">duckdb</span><span class="fu">::</span><span class="fu"><a href="https://r.duckdb.org/reference/duckdb_read_csv.html">duckdb_read_csv</a></span><span class="op">(</span><span class="va">con</span>, <span class="st">"gapminder"</span>, <span class="va">paths</span><span class="op">)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>이것은 여기서 잘 작동하겠지만, 우리는 csv 파일이 아니라 엑셀 스프레드시트를 가지고 있습니다. 그래서 “수동으로” 해야 할 것입니다. 수동으로 하는 법을 배우면 csv 파일 뭉치가 있고, 작업 중인 데이터베이스에 이를 모두 로드하는 단일 함수가 없는 경우에도 도움이 될 것입니다.</p>
<p>먼저 데이터를 채울 테이블을 만드는 것부터 시작해야 합니다. 가장 쉬운 방법은 원하는 모든 열을 포함하지만 데이터는 샘플링된 정도만 포함하는 더미 데이터 프레임인 템플릿을 만드는 것입니다. gapminder 데이터의 경우, 단일 파일을 읽고 연도를 추가하여 해당 템플릿을 만들 수 있습니다:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb52"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">template</span> <span class="op">&lt;-</span> <span class="fu">readxl</span><span class="fu">::</span><span class="fu"><a href="https://readxl.tidyverse.org/reference/read_excel.html">read_excel</a></span><span class="op">(</span><span class="va">paths</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="va">template</span><span class="op">$</span><span class="va">year</span> <span class="op">&lt;-</span> <span class="fl">1952</span></span>
<span><span class="va">template</span></span>
<span><span class="co">#&gt; # A tibble: 142 × 6</span></span>
<span><span class="co">#&gt;   country     continent lifeExp      pop gdpPercap  year</span></span>
<span><span class="co">#&gt;   &lt;chr&gt;       &lt;chr&gt;       &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt; &lt;dbl&gt;</span></span>
<span><span class="co">#&gt; 1 Afghanistan Asia         28.8  8425333      779.  1952</span></span>
<span><span class="co">#&gt; 2 Albania     Europe       55.2  1282697     1601.  1952</span></span>
<span><span class="co">#&gt; 3 Algeria     Africa       43.1  9279525     2449.  1952</span></span>
<span><span class="co">#&gt; 4 Angola      Africa       30.0  4232095     3521.  1952</span></span>
<span><span class="co">#&gt; 5 Argentina   Americas     62.5 17876956     5911.  1952</span></span>
<span><span class="co">#&gt; 6 Australia   Oceania      69.1  8691212    10040.  1952</span></span>
<span><span class="co">#&gt; # ℹ 136 more rows</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>이제 데이터베이스에 연결하고 <code><a href="https://dbi.r-dbi.org/reference/dbCreateTable.html">DBI::dbCreateTable()</a></code>을 사용하여 템플릿을 데이터베이스 테이블로 바꿀 수 있습니다:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb53"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">con</span> <span class="op">&lt;-</span> <span class="fu">DBI</span><span class="fu">::</span><span class="fu"><a href="https://dbi.r-dbi.org/reference/dbConnect.html">dbConnect</a></span><span class="op">(</span><span class="fu">duckdb</span><span class="fu">::</span><span class="fu"><a href="https://r.duckdb.org/reference/duckdb.html">duckdb</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu">DBI</span><span class="fu">::</span><span class="fu"><a href="https://dbi.r-dbi.org/reference/dbCreateTable.html">dbCreateTable</a></span><span class="op">(</span><span class="va">con</span>, <span class="st">"gapminder"</span>, <span class="va">template</span><span class="op">)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p><code>dbCreateTable()</code>은 <code>template</code>의 데이터를 사용하지 않고 변수 이름과 유형만 사용합니다. 따라서 지금 <code>gapminder</code> 테이블을 검사해 보면 비어 있지만, 우리가 예상하는 유형을 가진 필요한 변수들이 있는 것을 볼 수 있습니다:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb54"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">con</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/tbl.html">tbl</a></span><span class="op">(</span><span class="st">"gapminder"</span><span class="op">)</span></span>
<span><span class="co">#&gt; # Source:   table&lt;gapminder&gt; [?? x 6]</span></span>
<span><span class="co">#&gt; # Database: DuckDB 1.4.3 [root@Darwin 25.1.0:R 4.5.0/:memory:]</span></span>
<span><span class="co">#&gt; # ℹ 6 variables: country &lt;chr&gt;, continent &lt;chr&gt;, lifeExp &lt;dbl&gt;, pop &lt;dbl&gt;,</span></span>
<span><span class="co">#&gt; #   gdpPercap &lt;dbl&gt;, year &lt;dbl&gt;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>다음으로, 단일 파일 경로를 받아서 R로 읽어 들이고 그 결과를 <code>gapminder</code> 테이블에 추가하는 함수가 필요합니다. <code>read_excel()</code>을 <code><a href="https://dbi.r-dbi.org/reference/dbAppendTable.html">DBI::dbAppendTable()</a></code>과 결합하여 이를 수행할 수 있습니다:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb55"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">append_file</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">path</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">df</span> <span class="op">&lt;-</span> <span class="fu">readxl</span><span class="fu">::</span><span class="fu"><a href="https://readxl.tidyverse.org/reference/read_excel.html">read_excel</a></span><span class="op">(</span><span class="va">path</span><span class="op">)</span></span>
<span>  <span class="va">df</span><span class="op">$</span><span class="va">year</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/parse_number.html">parse_number</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/basename.html">basename</a></span><span class="op">(</span><span class="va">path</span><span class="op">)</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="fu">DBI</span><span class="fu">::</span><span class="fu"><a href="https://dbi.r-dbi.org/reference/dbAppendTable.html">dbAppendTable</a></span><span class="op">(</span><span class="va">con</span>, <span class="st">"gapminder"</span>, <span class="va">df</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>이제 <code>paths</code>의 각 요소에 대해 <code>append_file()</code>을 한 번씩 호출해야 합니다. <code><a href="https://purrr.tidyverse.org/reference/map.html">map()</a></code>으로도 가능합니다:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb56"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">paths</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map</a></span><span class="op">(</span><span class="va">append_file</span><span class="op">)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>하지만 우리는 <code>append_file()</code>의 출력 결과에는 관심이 없으므로, <code><a href="https://purrr.tidyverse.org/reference/map.html">map()</a></code> 대신 <code><a href="https://purrr.tidyverse.org/reference/map.html">walk()</a></code>를 사용하는 것이 약간 더 좋습니다. <code><a href="https://purrr.tidyverse.org/reference/map.html">walk()</a></code>는 <code><a href="https://purrr.tidyverse.org/reference/map.html">map()</a></code>과 정확히 동일한 작업을 수행하지만 출력 결과는 버립니다:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb57"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">paths</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">walk</a></span><span class="op">(</span><span class="va">append_file</span><span class="op">)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>이제 테이블에 모든 데이터가 들어 있는지 확인할 수 있습니다:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb58"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">con</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/tbl.html">tbl</a></span><span class="op">(</span><span class="st">"gapminder"</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/count.html">count</a></span><span class="op">(</span><span class="va">year</span><span class="op">)</span></span>
<span><span class="co">#&gt; # Source:   SQL [?? x 2]</span></span>
<span><span class="co">#&gt; # Database: DuckDB 1.4.3 [root@Darwin 25.1.0:R 4.5.0/:memory:]</span></span>
<span><span class="co">#&gt;    year     n</span></span>
<span><span class="co">#&gt;   &lt;dbl&gt; &lt;dbl&gt;</span></span>
<span><span class="co">#&gt; 1  1967   142</span></span>
<span><span class="co">#&gt; 2  1952   142</span></span>
<span><span class="co">#&gt; 3  1977   142</span></span>
<span><span class="co">#&gt; 4  1987   142</span></span>
<span><span class="co">#&gt; 5  2007   142</span></span>
<span><span class="co">#&gt; 6  1962   142</span></span>
<span><span class="co">#&gt; # ℹ more rows</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section><section id="csv-파일-쓰기" class="level3" data-number="26.4.2"><h3 data-number="26.4.2" class="anchored" data-anchor-id="csv-파일-쓰기">
<span class="header-section-number">26.4.2</span> csv 파일 쓰기</h3>
<p>각 그룹에 대해 하나씩 여러 csv 파일을 쓰려는 경우에도 동일한 기본 원칙이 적용됩니다. <code><a href="https://ggplot2.tidyverse.org/reference/diamonds.html">ggplot2::diamonds</a></code> 데이터를 가져와서 각 <code>clarity</code>(투명도)별로 하나의 csv 파일을 저장하고 싶다고 가정해 봅시다. 먼저 그 개별 데이터셋들을 만들어야 합니다. 여러 가지 방법으로 할 수 있지만, 우리가 특히 좋아하는 방법은 <code><a href="https://dplyr.tidyverse.org/reference/group_nest.html">group_nest()</a></code>입니다.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb59"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">by_clarity</span> <span class="op">&lt;-</span> <span class="va">diamonds</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_nest.html">group_nest</a></span><span class="op">(</span><span class="va">clarity</span><span class="op">)</span></span>
<span></span>
<span><span class="va">by_clarity</span></span>
<span><span class="co">#&gt; # A tibble: 8 × 2</span></span>
<span><span class="co">#&gt;   clarity               data</span></span>
<span><span class="co">#&gt;   &lt;ord&gt;   &lt;list&lt;tibble[,9]&gt;&gt;</span></span>
<span><span class="co">#&gt; 1 I1               [741 × 9]</span></span>
<span><span class="co">#&gt; 2 SI2            [9,194 × 9]</span></span>
<span><span class="co">#&gt; 3 SI1           [13,065 × 9]</span></span>
<span><span class="co">#&gt; 4 VS2           [12,258 × 9]</span></span>
<span><span class="co">#&gt; 5 VS1            [8,171 × 9]</span></span>
<span><span class="co">#&gt; 6 VVS2           [5,066 × 9]</span></span>
<span><span class="co">#&gt; # ℹ 2 more rows</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>이것은 8개의 행과 2개의 열이 있는 새로운 티블을 제공합니다. <code>clarity</code>는 그룹화 변수이고, <code>data</code>는 각 고유한 <code>clarity</code> 값에 대해 하나의 티블을 포함하는 리스트 열입니다:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb60"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">by_clarity</span><span class="op">$</span><span class="va">data</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></span>
<span><span class="co">#&gt; # A tibble: 741 × 9</span></span>
<span><span class="co">#&gt;   carat cut       color depth table price     x     y     z</span></span>
<span><span class="co">#&gt;   &lt;dbl&gt; &lt;ord&gt;     &lt;ord&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;</span></span>
<span><span class="co">#&gt; 1  0.32 Premium   E      60.9    58   345  4.38  4.42  2.68</span></span>
<span><span class="co">#&gt; 2  1.17 Very Good J      60.2    61  2774  6.83  6.9   4.13</span></span>
<span><span class="co">#&gt; 3  1.01 Premium   F      61.8    60  2781  6.39  6.36  3.94</span></span>
<span><span class="co">#&gt; 4  1.01 Fair      E      64.5    58  2788  6.29  6.21  4.03</span></span>
<span><span class="co">#&gt; 5  0.96 Ideal     F      60.7    55  2801  6.37  6.41  3.88</span></span>
<span><span class="co">#&gt; 6  1.04 Premium   G      62.2    58  2801  6.46  6.41  4   </span></span>
<span><span class="co">#&gt; # ℹ 735 more rows</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>여기서 <code><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate()</a></code>와 <code><a href="https://stringr.tidyverse.org/reference/str_glue.html">str_glue()</a></code>를 사용하여 출력 파일의 이름을 제공하는 열을 만들어 보겠습니다:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb61"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">by_clarity</span> <span class="op">&lt;-</span> <span class="va">by_clarity</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>path <span class="op">=</span> <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_glue.html">str_glue</a></span><span class="op">(</span><span class="st">"diamonds-{clarity}.csv"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">by_clarity</span></span>
<span><span class="co">#&gt; # A tibble: 8 × 3</span></span>
<span><span class="co">#&gt;   clarity               data path             </span></span>
<span><span class="co">#&gt;   &lt;ord&gt;   &lt;list&lt;tibble[,9]&gt;&gt; &lt;glue&gt;           </span></span>
<span><span class="co">#&gt; 1 I1               [741 × 9] diamonds-I1.csv  </span></span>
<span><span class="co">#&gt; 2 SI2            [9,194 × 9] diamonds-SI2.csv </span></span>
<span><span class="co">#&gt; 3 SI1           [13,065 × 9] diamonds-SI1.csv </span></span>
<span><span class="co">#&gt; 4 VS2           [12,258 × 9] diamonds-VS2.csv </span></span>
<span><span class="co">#&gt; 5 VS1            [8,171 × 9] diamonds-VS1.csv </span></span>
<span><span class="co">#&gt; 6 VVS2           [5,066 × 9] diamonds-VVS2.csv</span></span>
<span><span class="co">#&gt; # ℹ 2 more rows</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>따라서 이 데이터 프레임들을 수동으로 저장한다면 다음과 같이 쓸 수 있을 것입니다:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb62"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://readr.tidyverse.org/reference/write_delim.html">write_csv</a></span><span class="op">(</span><span class="va">by_clarity</span><span class="op">$</span><span class="va">data</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>, <span class="va">by_clarity</span><span class="op">$</span><span class="va">path</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://readr.tidyverse.org/reference/write_delim.html">write_csv</a></span><span class="op">(</span><span class="va">by_clarity</span><span class="op">$</span><span class="va">data</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span>, <span class="va">by_clarity</span><span class="op">$</span><span class="va">path</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://readr.tidyverse.org/reference/write_delim.html">write_csv</a></span><span class="op">(</span><span class="va">by_clarity</span><span class="op">$</span><span class="va">data</span><span class="op">[[</span><span class="fl">3</span><span class="op">]</span><span class="op">]</span>, <span class="va">by_clarity</span><span class="op">$</span><span class="va">path</span><span class="op">[[</span><span class="fl">3</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="va">...</span></span>
<span><span class="fu"><a href="https://readr.tidyverse.org/reference/write_delim.html">write_csv</a></span><span class="op">(</span><span class="va">by_clarity</span><span class="op">$</span><span class="va">by_clarity</span><span class="op">[[</span><span class="fl">8</span><span class="op">]</span><span class="op">]</span>, <span class="va">by_clarity</span><span class="op">$</span><span class="va">path</span><span class="op">[[</span><span class="fl">8</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>이것은 변하는 인수가 하나가 아니라 두 개이므로 이전의 <code><a href="https://purrr.tidyverse.org/reference/map.html">map()</a></code> 사용과는 조금 다릅니다. 즉, 첫 번째 인수와 두 번째 인수를 모두 변경하는 <code><a href="https://purrr.tidyverse.org/reference/map2.html">map2()</a></code>라는 새로운 함수가 필요합니다. 그리고 이번에도 출력 결과에는 관심이 없으므로 <code><a href="https://purrr.tidyverse.org/reference/map2.html">map2()</a></code> 대신 <code><a href="https://purrr.tidyverse.org/reference/map2.html">walk2()</a></code>를 원합니다. 그러면 다음과 같습니다:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb63"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map2.html">walk2</a></span><span class="op">(</span><span class="va">by_clarity</span><span class="op">$</span><span class="va">data</span>, <span class="va">by_clarity</span><span class="op">$</span><span class="va">path</span>, <span class="va">write_csv</span><span class="op">)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section><section id="플롯-저장하기" class="level3" data-number="26.4.3"><h3 data-number="26.4.3" class="anchored" data-anchor-id="플롯-저장하기">
<span class="header-section-number">26.4.3</span> 플롯 저장하기</h3>
<p>동일한 기본 접근 방식을 사용하여 많은 플롯을 만들 수 있습니다. 먼저 원하는 플롯을 그리는 함수를 만들어 보겠습니다:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb64"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">carat_histogram</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">df</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">df</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">carat</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_histogram.html">geom_histogram</a></span><span class="op">(</span>binwidth <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span>  </span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="fu">carat_histogram</span><span class="op">(</span><span class="va">by_clarity</span><span class="op">$</span><span class="va">data</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="iteration_files/figure-html/unnamed-chunk-68-1.png" class="img-fluid figure-img" alt="0에서 5캐럿 사이인 by_clarity 데이터셋의 다이아몬드 캐럿 히스토그램.  분포는 단봉형이며 오른쪽으로 치우쳐 있고 1캐럿 부근에서 피크를 보입니다." width="576"></p>
</figure>
</div>
</div>
</div>
<p>이제 <code><a href="https://purrr.tidyverse.org/reference/map.html">map()</a></code>을 사용하여 많은 플롯<a href="#fn7" class="footnote-ref" id="fnref7" role="doc-noteref"><sup>7</sup></a>과 최종 파일 경로의 리스트를 만들 수 있습니다:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb65"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">by_clarity</span> <span class="op">&lt;-</span> <span class="va">by_clarity</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span></span>
<span>    plot <span class="op">=</span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map</a></span><span class="op">(</span><span class="va">data</span>, <span class="va">carat_histogram</span><span class="op">)</span>,</span>
<span>    path <span class="op">=</span> <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_glue.html">str_glue</a></span><span class="op">(</span><span class="st">"clarity-{clarity}.png"</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>그런 다음 <code><a href="https://purrr.tidyverse.org/reference/map2.html">walk2()</a></code>를 <code><a href="https://ggplot2.tidyverse.org/reference/ggsave.html">ggsave()</a></code>와 함께 사용하여 각 플롯을 저장합니다:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb66"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map2.html">walk2</a></span><span class="op">(</span></span>
<span>  <span class="va">by_clarity</span><span class="op">$</span><span class="va">path</span>,</span>
<span>  <span class="va">by_clarity</span><span class="op">$</span><span class="va">plot</span>,</span>
<span>  \<span class="op">(</span><span class="va">path</span>, <span class="va">plot</span><span class="op">)</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsave.html">ggsave</a></span><span class="op">(</span><span class="va">path</span>, <span class="va">plot</span>, width <span class="op">=</span> <span class="fl">6</span>, height <span class="op">=</span> <span class="fl">6</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>이것은 다음의 단축 표현입니다:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb67"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsave.html">ggsave</a></span><span class="op">(</span><span class="va">by_clarity</span><span class="op">$</span><span class="va">path</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>, <span class="va">by_clarity</span><span class="op">$</span><span class="va">plot</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>, width <span class="op">=</span> <span class="fl">6</span>, height <span class="op">=</span> <span class="fl">6</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsave.html">ggsave</a></span><span class="op">(</span><span class="va">by_clarity</span><span class="op">$</span><span class="va">path</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span>, <span class="va">by_clarity</span><span class="op">$</span><span class="va">plot</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span>, width <span class="op">=</span> <span class="fl">6</span>, height <span class="op">=</span> <span class="fl">6</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsave.html">ggsave</a></span><span class="op">(</span><span class="va">by_clarity</span><span class="op">$</span><span class="va">path</span><span class="op">[[</span><span class="fl">3</span><span class="op">]</span><span class="op">]</span>, <span class="va">by_clarity</span><span class="op">$</span><span class="va">plot</span><span class="op">[[</span><span class="fl">3</span><span class="op">]</span><span class="op">]</span>, width <span class="op">=</span> <span class="fl">6</span>, height <span class="op">=</span> <span class="fl">6</span><span class="op">)</span></span>
<span><span class="va">...</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsave.html">ggsave</a></span><span class="op">(</span><span class="va">by_clarity</span><span class="op">$</span><span class="va">path</span><span class="op">[[</span><span class="fl">8</span><span class="op">]</span><span class="op">]</span>, <span class="va">by_clarity</span><span class="op">$</span><span class="va">plot</span><span class="op">[[</span><span class="fl">8</span><span class="op">]</span><span class="op">]</span>, width <span class="op">=</span> <span class="fl">6</span>, height <span class="op">=</span> <span class="fl">6</span><span class="op">)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<!-- 
### 연습문제

1.  (다른 변수들 중에서) `school_name`과 `student_id`를 포함하는 학생 데이터 테이블이 있다고 가정해 봅시다. 각 학생의 모든 정보를 `{school}` 디렉터리의 `{student_id}.csv`라는 파일로 저장하고 싶다면 어떤 코드를 작성할지 스케치해 보세요.
-->
</section></section><section id="요약" class="level2" data-number="26.5"><h2 data-number="26.5" class="anchored" data-anchor-id="요약">
<span class="header-section-number">26.5</span> 요약</h2>
<p>이 장에서는 데이터 과학을 할 때 자주 발생하는 세 가지 문제, 즉 여러 열 조작하기, 여러 파일 읽기, 여러 출력 저장하기를 해결하기 위해 명시적 반복을 사용하는 방법을 살펴보았습니다. 하지만 일반적으로 반복은 슈퍼 파워입니다. 올바른 반복 기술을 알고 있다면 하나의 문제를 해결하는 것에서 모든 문제를 해결하는 것으로 쉽게 나아갈 수 있습니다. 이 장의 기술들을 마스터했다면, <em>Advanced R</em>의 <a href="https://adv-r.hadley.nz/functionals.html">함수형(Functionals) 장</a>을 읽고 <a href="https://purrr.tidyverse.org">purrr 웹사이트</a>를 참고하여 더 많은 내용을 배워보시기를 강력히 추천합니다.</p>
<p>다른 언어의 반복문에 대해 많이 알고 있다면, 우리가 <code>for</code> 루프에 대해 논의하지 않은 것에 놀랐을 수도 있습니다. 그 이유는 R의 데이터 분석 지향적 특성이 반복 방식을 바꾸기 때문입니다. 대부분의 경우 기존의 관용구에 의존하여 각 열이나 각 그룹에 작업을 수행할 수 있습니다. 그럴 수 없는 경우에는 리스트의 각 요소에 작업을 수행하는 <code><a href="https://purrr.tidyverse.org/reference/map.html">map()</a></code>과 같은 함수형 프로그래밍 도구를 종종 사용할 수 있습니다. 하지만 야생에서 마주치는 코드에서는 <code>for</code> 루프를 보게 될 것이므로, 몇 가지 중요한 기본(base) R 도구를 논의하는 다음 장에서 이에 대해 배울 것입니다.</p>


</section><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><hr>
<ol>
<li id="fn1"><p>익명인 이유는 <code>&lt;-</code>를 사용하여 명시적으로 이름을 지정하지 않았기 때문입니다. 프로그래머들은 이를 “람다 함수”라고도 부릅니다.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2"><p>오래된 코드에서는 <code>~ .x + 1</code>과 같은 구문을 볼 수 있습니다. 이것은 익명 함수를 작성하는 또 다른 방법이지만 tidyverse 함수 내에서만 작동하며 항상 변수 이름 <code>.x</code>를 사용합니다. 우리는 이제 기본 구문인 <code>\(x) x + 1</code>을 권장합니다.<a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn3"><p>현재로서는 열의 순서를 변경할 수는 없지만, <code><a href="https://dplyr.tidyverse.org/reference/relocate.html">relocate()</a></code> 등을 사용하여 나중에 재정렬할 수 있습니다.<a href="#fnref3" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn4"><p>언젠가는 가능할 수도 있겠지만, 현재로서는 방법이 보이지 않습니다.<a href="#fnref4" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn5"><p>대신 동일한 형식의 csv 파일 디렉터리가 있다면 <a href="data-import.html#sec-readr-directory" class="quarto-xref"><span>Section 7.4</span></a> 의 기술을 사용할 수 있습니다.<a href="#fnref5" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn6"><p>이 함수의 작동 방식은 설명하지 않겠지만, 사용된 함수들의 문서를 찾아보면 알아낼 수 있을 것입니다.<a href="#fnref6" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn7"><p><code>by_clarity$plot</code>을 인쇄하여 조잡한 애니메이션을 얻을 수 있습니다. <code>plots</code>의 각 요소에 대해 하나의 플롯을 얻게 됩니다. 참고: 저에게는 이런 일이 일어나지 않았습니다.<a href="#fnref7" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol></section></main><!-- /main --><script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
      const outerScaffold = trigger.parentElement.cloneNode(true);
      const codeEl = outerScaffold.querySelector('code');
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp("https:\/\/r4ds\.hadley\.nz\/");
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script><nav class="page-navigation"><div class="nav-page nav-page-previous">
      <a href="./functions.html" class="pagination-link" aria-label="함수 (Functions)">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">25</span>&nbsp; <span class="chapter-title">함수 (Functions)</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./base-R.html" class="pagination-link" aria-label="기본 R 필드 가이드">
        <span class="nav-page-text"><span class="chapter-number">27</span>&nbsp; <span class="chapter-title">기본 R 필드 가이드</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer"><div class="nav-footer">
    <div class="nav-footer-left">
<p>R for Data Science (2e) was written by Hadley Wickham, Mine Çetinkaya-Rundel, and Garrett Grolemund.</p>
</div>   
    <div class="nav-footer-center">
      &nbsp;
    <div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/hadley/r4ds/edit/main/iteration.qmd" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/hadley/r4ds/issues/new" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></div>
    <div class="nav-footer-right">
<p>This book was built with <a href="https://quarto.org/">Quarto</a>.</p>
</div>
  </div>
</footer>


</body></html>
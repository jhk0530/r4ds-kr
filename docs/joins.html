<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="generator" content="quarto-1.8.25">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<meta name="author" content="Hadley Wickham, Mine Çetinkaya-Rundel, and Garrett Grolemund">
<title>19&nbsp; 조인(Joins) – R for Data Science (2e)</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>

<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./import.html" rel="next">
<link href="./missing-values.html" rel="prev">
<link href="./cover.jpg" rel="icon" type="image/jpeg">
<script src="site_libs/quarto-html/quarto.js" type="module"></script>
<script src="site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="site_libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-7b89279ff1a6dce999919e0e67d4d9ec.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-8df9fc159a2c64db71ab329accd4d345.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light"><script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script><script defer="" data-domain="r4ds.hadley.nz" src="https://plausible.io/js/plausible.js"></script>
</head>
<body class="nav-sidebar floating quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top"><nav class="quarto-secondary-nav"><div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./transform.html">변형 (Transform)</a></li><li class="breadcrumb-item"><a href="./joins.html"><span class="chapter-number">19</span>&nbsp; <span class="chapter-title">조인(Joins)</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav></header><!-- content --><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto"><div class="pt-lg-2 mt-2 text-left sidebar-header sidebar-header-stacked">
      <a href="./index.html" class="sidebar-logo-link">
      </a>
    <div class="sidebar-title mb-0 py-0">
      <a href="./">R for Data Science (2e)</a> 
        <div class="sidebar-tools-main">
    <a href="https://github.com/hadley/r4ds/" title="Source Code" class="quarto-navigation-tool px-1" aria-label="Source Code"><i class="bi bi-github"></i></a>
  <a href="" class="quarto-reader-toggle quarto-navigation-tool px-1" onclick="window.quartoToggleReader(); return false;" title="Toggle reader mode">
  <div class="quarto-reader-toggle-btn">
  <i class="bi"></i>
  </div>
</a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">환영합니다</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./preface-2e.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">제2판 서문</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">소개</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./whole-game.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">전체 게임</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./data-visualize.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">데이터 시각화</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./workflow-basics.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">워크플로우: 기초</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./data-transform.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">데이터 변형</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./workflow-style.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">워크플로우: 코드 스타일</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./data-tidy.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">데이터 정리</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./workflow-scripts.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">워크플로우: 스크립트와 프로젝트</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./data-import.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">데이터 가져오기</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./workflow-help.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">워크플로우: 도움 받기</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./visualize.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">시각화 (Visualize)</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./layers.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">레이어(Layers)</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./EDA.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">탐색적 데이터 분석(Exploratory data analysis)</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./communication.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">소통(Communication)</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./transform.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">변형 (Transform)</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./logicals.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">논리형 벡터</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./numbers.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">숫자</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./strings.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">문자열</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./regexps.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">정규 표현식 (Regular expressions)</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./factors.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">팩터(Factors)</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./datetimes.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">17</span>&nbsp; <span class="chapter-title">날짜와 시간</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./missing-values.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">18</span>&nbsp; <span class="chapter-title">결측값(Missing values)</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./joins.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">19</span>&nbsp; <span class="chapter-title">조인(Joins)</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./import.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">가져오기 (Import)</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./spreadsheets.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">20</span>&nbsp; <span class="chapter-title">스프레드시트</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./databases.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">21</span>&nbsp; <span class="chapter-title">데이터베이스</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./arrow.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">22</span>&nbsp; <span class="chapter-title">Arrow</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./rectangling.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">23</span>&nbsp; <span class="chapter-title">계층적 데이터</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./webscraping.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">24</span>&nbsp; <span class="chapter-title">웹 스크래핑</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./program.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">프로그램 (Program)</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./functions.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">25</span>&nbsp; <span class="chapter-title">함수 (Functions)</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./iteration.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">26</span>&nbsp; <span class="chapter-title">반복</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./base-R.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">27</span>&nbsp; <span class="chapter-title">기본 R 필드 가이드</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./communicate.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">소통 (Communicate)</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-6" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./quarto.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">28</span>&nbsp; <span class="chapter-title">Quarto</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./quarto-formats.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">29</span>&nbsp; <span class="chapter-title">Quarto 형식</span></span></a>
  </div>
</li>
      </ul>
</li>
    </ul>
</div>
</nav><div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active"><h2 id="toc-title">Table of contents</h2>
   
  <ul>
<li>
<a href="#%EC%86%8C%EA%B0%9C" id="toc-소개" class="nav-link active" data-scroll-target="#%EC%86%8C%EA%B0%9C"><span class="header-section-number">19.1</span> 소개</a>
  <ul class="collapse">
<li><a href="#%EC%84%A0%EC%88%98-%EC%A7%80%EC%8B%9D" id="toc-선수-지식" class="nav-link" data-scroll-target="#%EC%84%A0%EC%88%98-%EC%A7%80%EC%8B%9D"><span class="header-section-number">19.1.1</span> 선수 지식</a></li>
  </ul>
</li>
  <li>
<a href="#%ED%82%A4keys" id="toc-키keys" class="nav-link" data-scroll-target="#%ED%82%A4keys"><span class="header-section-number">19.2</span> 키(Keys)</a>
  <ul class="collapse">
<li><a href="#%EA%B8%B0%EB%B3%B8-%ED%82%A4%EC%99%80-%EC%99%B8%EB%9E%98-%ED%82%A4" id="toc-기본-키와-외래-키" class="nav-link" data-scroll-target="#%EA%B8%B0%EB%B3%B8-%ED%82%A4%EC%99%80-%EC%99%B8%EB%9E%98-%ED%82%A4"><span class="header-section-number">19.2.1</span> 기본 키와 외래 키</a></li>
  <li><a href="#%EA%B8%B0%EB%B3%B8-%ED%82%A4-%ED%99%95%EC%9D%B8" id="toc-기본-키-확인" class="nav-link" data-scroll-target="#%EA%B8%B0%EB%B3%B8-%ED%82%A4-%ED%99%95%EC%9D%B8"><span class="header-section-number">19.2.2</span> 기본 키 확인</a></li>
  <li><a href="#%EB%8C%80%EB%A6%AC-%ED%82%A4surrogate-keys" id="toc-대리-키surrogate-keys" class="nav-link" data-scroll-target="#%EB%8C%80%EB%A6%AC-%ED%82%A4surrogate-keys"><span class="header-section-number">19.2.3</span> 대리 키(Surrogate keys)</a></li>
  <li><a href="#%EC%97%B0%EC%8A%B5%EB%AC%B8%EC%A0%9C" id="toc-연습문제" class="nav-link" data-scroll-target="#%EC%97%B0%EC%8A%B5%EB%AC%B8%EC%A0%9C"><span class="header-section-number">19.2.4</span> 연습문제</a></li>
  </ul>
</li>
  <li>
<a href="#sec-mutating-joins" id="toc-sec-mutating-joins" class="nav-link" data-scroll-target="#sec-mutating-joins"><span class="header-section-number">19.3</span> 기본 조인</a>
  <ul class="collapse">
<li><a href="#%EB%B3%80%ED%98%95-%EC%A1%B0%EC%9D%B8mutating-joins" id="toc-변형-조인mutating-joins" class="nav-link" data-scroll-target="#%EB%B3%80%ED%98%95-%EC%A1%B0%EC%9D%B8mutating-joins"><span class="header-section-number">19.3.1</span> 변형 조인(Mutating joins)</a></li>
  <li><a href="#%EC%A1%B0%EC%9D%B8-%ED%82%A4-%EC%A7%80%EC%A0%95" id="toc-조인-키-지정" class="nav-link" data-scroll-target="#%EC%A1%B0%EC%9D%B8-%ED%82%A4-%EC%A7%80%EC%A0%95"><span class="header-section-number">19.3.2</span> 조인 키 지정</a></li>
  <li><a href="#%ED%95%84%ED%84%B0%EB%A7%81-%EC%A1%B0%EC%9D%B8filtering-joins" id="toc-필터링-조인filtering-joins" class="nav-link" data-scroll-target="#%ED%95%84%ED%84%B0%EB%A7%81-%EC%A1%B0%EC%9D%B8filtering-joins"><span class="header-section-number">19.3.3</span> 필터링 조인(Filtering joins)</a></li>
  <li><a href="#%EC%97%B0%EC%8A%B5%EB%AC%B8%EC%A0%9C-1" id="toc-연습문제-1" class="nav-link" data-scroll-target="#%EC%97%B0%EC%8A%B5%EB%AC%B8%EC%A0%9C-1"><span class="header-section-number">19.3.4</span> 연습문제</a></li>
  </ul>
</li>
  <li>
<a href="#%EC%A1%B0%EC%9D%B8%EC%9D%80-%EC%96%B4%EB%96%BB%EA%B2%8C-%EC%9E%91%EB%8F%99%ED%95%A9%EB%8B%88%EA%B9%8C" id="toc-조인은-어떻게-작동합니까" class="nav-link" data-scroll-target="#%EC%A1%B0%EC%9D%B8%EC%9D%80-%EC%96%B4%EB%96%BB%EA%B2%8C-%EC%9E%91%EB%8F%99%ED%95%A9%EB%8B%88%EA%B9%8C"><span class="header-section-number">19.4</span> 조인은 어떻게 작동합니까?</a>
  <ul class="collapse">
<li><a href="#%ED%96%89-%EC%9D%BC%EC%B9%98" id="toc-행-일치" class="nav-link" data-scroll-target="#%ED%96%89-%EC%9D%BC%EC%B9%98"><span class="header-section-number">19.4.1</span> 행 일치</a></li>
  <li><a href="#%ED%95%84%ED%84%B0%EB%A7%81-%EC%A1%B0%EC%9D%B8" id="toc-필터링-조인" class="nav-link" data-scroll-target="#%ED%95%84%ED%84%B0%EB%A7%81-%EC%A1%B0%EC%9D%B8"><span class="header-section-number">19.4.2</span> 필터링 조인</a></li>
  </ul>
</li>
  <li>
<a href="#sec-non-equi-joins" id="toc-sec-non-equi-joins" class="nav-link" data-scroll-target="#sec-non-equi-joins"><span class="header-section-number">19.5</span> 비동등 조인(Non-equi joins)</a>
  <ul class="collapse">
<li><a href="#%EA%B5%90%EC%B0%A8-%EC%A1%B0%EC%9D%B8cross-joins" id="toc-교차-조인cross-joins" class="nav-link" data-scroll-target="#%EA%B5%90%EC%B0%A8-%EC%A1%B0%EC%9D%B8cross-joins"><span class="header-section-number">19.5.1</span> 교차 조인(Cross joins)</a></li>
  <li><a href="#%EB%B6%80%EB%93%B1-%EC%A1%B0%EC%9D%B8inequality-joins" id="toc-부등-조인inequality-joins" class="nav-link" data-scroll-target="#%EB%B6%80%EB%93%B1-%EC%A1%B0%EC%9D%B8inequality-joins"><span class="header-section-number">19.5.2</span> 부등 조인(Inequality joins)</a></li>
  <li><a href="#%EB%A1%A4%EB%A7%81-%EC%A1%B0%EC%9D%B8rolling-joins" id="toc-롤링-조인rolling-joins" class="nav-link" data-scroll-target="#%EB%A1%A4%EB%A7%81-%EC%A1%B0%EC%9D%B8rolling-joins"><span class="header-section-number">19.5.3</span> 롤링 조인(Rolling joins)</a></li>
  <li><a href="#%EC%A4%91%EC%B2%A9-%EC%A1%B0%EC%9D%B8overlap-joins" id="toc-중첩-조인overlap-joins" class="nav-link" data-scroll-target="#%EC%A4%91%EC%B2%A9-%EC%A1%B0%EC%9D%B8overlap-joins"><span class="header-section-number">19.5.4</span> 중첩 조인(Overlap joins)</a></li>
  <li><a href="#%EC%97%B0%EC%8A%B5%EB%AC%B8%EC%A0%9C-2" id="toc-연습문제-2" class="nav-link" data-scroll-target="#%EC%97%B0%EC%8A%B5%EB%AC%B8%EC%A0%9C-2"><span class="header-section-number">19.5.5</span> 연습문제</a></li>
  </ul>
</li>
  <li><a href="#%EC%9A%94%EC%95%BD" id="toc-요약" class="nav-link" data-scroll-target="#%EC%9A%94%EC%95%BD"><span class="header-section-number">19.6</span> 요약</a></li>
  </ul><div class="toc-actions"><ul><li><a href="https://github.com/hadley/r4ds/edit/main/joins.qmd" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/hadley/r4ds/issues/new" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content"><header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./transform.html">변형 (Transform)</a></li><li class="breadcrumb-item"><a href="./joins.html"><span class="chapter-number">19</span>&nbsp; <span class="chapter-title">조인(Joins)</span></a></li></ol></nav><div class="quarto-title">
<h1 class="title"><span id="sec-joins" class="quarto-section-identifier"><span class="chapter-number">19</span>&nbsp; <span class="chapter-title">조인(Joins)</span></span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header><section id="소개" class="level2" data-number="19.1"><h2 data-number="19.1" class="anchored" data-anchor-id="소개">
<span class="header-section-number">19.1</span> 소개</h2>
<p>데이터 분석에 단일 데이터 프레임만 포함되는 경우는 드뭅니다. 일반적으로 많은 데이터 프레임이 있으며 관심 있는 질문에 답하려면 이들을 <strong>조인(join)</strong>, 즉 결합해야 합니다. 이 장에서는 두 가지 중요한 조인 유형을 소개합니다:</p>
<ul>
<li>변형 조인(Mutating joins): 다른 데이터 프레임의 일치하는 관측값에서 한 데이터 프레임에 새 변수를 추가합니다.</li>
<li>필터링 조인(Filtering joins): 다른 데이터 프레임의 관측값과 일치하는지 여부에 따라 한 데이터 프레임에서 관측값을 필터링합니다.</li>
</ul>
<p>조인에서 두 데이터 프레임을 연결하는 데 사용되는 변수인 키(keys)에 대해 논의하는 것으로 시작하겠습니다. nycflights13 패키지의 데이터셋에 있는 키를 검사하여 이론을 공고히 한 다음, 그 지식을 사용하여 데이터 프레임을 조인하기 시작할 것입니다. 다음으로 행에 대한 조치에 초점을 맞춰 조인이 작동하는 방식에 대해 설명합니다. 기본 동등 관계보다 키를 일치시키는 더 유연한 방법을 제공하는 조인 제품군인 비동등 조인(non-equi joins)에 대한 논의로 마무리하겠습니다.</p>
<section id="선수-지식" class="level3" data-number="19.1.1"><h3 data-number="19.1.1" class="anchored" data-anchor-id="선수-지식">
<span class="header-section-number">19.1.1</span> 선수 지식</h3>
<p>이 장에서는 dplyr의 조인 함수를 사용하여 nycflights13의 5가지 관련 데이터셋을 탐색합니다.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb1"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org">tidyverse</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning: package 'ggplot2' was built under R version 4.5.2</span></span>
<span><span class="co">#&gt; Warning: package 'readr' was built under R version 4.5.2</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/hadley/nycflights13">nycflights13</a></span><span class="op">)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section></section><section id="키keys" class="level2" data-number="19.2"><h2 data-number="19.2" class="anchored" data-anchor-id="키keys">
<span class="header-section-number">19.2</span> 키(Keys)</h2>
<p>조인을 이해하려면 먼저 두 테이블이 각 테이블 내의 키 쌍을 통해 어떻게 연결될 수 있는지 이해해야 합니다. 이 섹션에서는 두 가지 유형의 키에 대해 배우고 nycflights13 패키지의 데이터셋에서 두 가지 예를 모두 볼 것입니다. 또한 키가 유효한지 확인하는 방법과 테이블에 키가 없는 경우 수행할 작업을 배웁니다.</p>
<section id="기본-키와-외래-키" class="level3" data-number="19.2.1"><h3 data-number="19.2.1" class="anchored" data-anchor-id="기본-키와-외래-키">
<span class="header-section-number">19.2.1</span> 기본 키와 외래 키</h3>
<p>모든 조인에는 기본 키와 외래 키라는 한 쌍의 키가 포함됩니다. <strong>기본 키(Primary key)</strong> 는 각 관측값을 고유하게 식별하는 변수 또는 변수 집합입니다. 둘 이상의 변수가 필요한 경우 키를 <strong>복합 키(compound key)</strong> 라고 합니다. 예를 들어 nycflights13에서:</p>
<ul>
<li>
<p><code>airlines</code>는 각 항공사에 대한 두 가지 데이터인 항공사 코드와 전체 이름을 기록합니다. 두 글자 항공사 코드로 항공사를 식별할 수 있으므로 <code>carrier</code>가 기본 키가 됩니다.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb2"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">airlines</span></span>
<span><span class="co">#&gt; # A tibble: 16 × 2</span></span>
<span><span class="co">#&gt;   carrier name                    </span></span>
<span><span class="co">#&gt;   &lt;chr&gt;   &lt;chr&gt;                   </span></span>
<span><span class="co">#&gt; 1 9E      Endeavor Air Inc.       </span></span>
<span><span class="co">#&gt; 2 AA      American Airlines Inc.  </span></span>
<span><span class="co">#&gt; 3 AS      Alaska Airlines Inc.    </span></span>
<span><span class="co">#&gt; 4 B6      JetBlue Airways         </span></span>
<span><span class="co">#&gt; 5 DL      Delta Air Lines Inc.    </span></span>
<span><span class="co">#&gt; 6 EV      ExpressJet Airlines Inc.</span></span>
<span><span class="co">#&gt; # ℹ 10 more rows</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</li>
<li>
<p><code>airports</code>는 각 공항에 대한 데이터를 기록합니다. 세 글자 공항 코드로 각 공항을 식별할 수 있으므로 <code>faa</code>가 기본 키가 됩니다.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb3"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">airports</span></span>
<span><span class="co">#&gt; # A tibble: 1,458 × 8</span></span>
<span><span class="co">#&gt;   faa   name                            lat   lon   alt    tz dst  </span></span>
<span><span class="co">#&gt;   &lt;chr&gt; &lt;chr&gt;                         &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;</span></span>
<span><span class="co">#&gt; 1 04G   Lansdowne Airport              41.1 -80.6  1044    -5 A    </span></span>
<span><span class="co">#&gt; 2 06A   Moton Field Municipal Airport  32.5 -85.7   264    -6 A    </span></span>
<span><span class="co">#&gt; 3 06C   Schaumburg Regional            42.0 -88.1   801    -6 A    </span></span>
<span><span class="co">#&gt; 4 06N   Randall Airport                41.4 -74.4   523    -5 A    </span></span>
<span><span class="co">#&gt; 5 09J   Jekyll Island Airport          31.1 -81.4    11    -5 A    </span></span>
<span><span class="co">#&gt; 6 0A9   Elizabethton Municipal Airpo…  36.4 -82.2  1593    -5 A    </span></span>
<span><span class="co">#&gt; # ℹ 1,452 more rows</span></span>
<span><span class="co">#&gt; # ℹ 1 more variable: tzone &lt;chr&gt;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</li>
<li>
<p><code>planes</code>는 각 비행기에 대한 데이터를 기록합니다. 꼬리 번호로 비행기를 식별할 수 있으므로 <code>tailnum</code>이 기본 키가 됩니다.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb4"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">planes</span></span>
<span><span class="co">#&gt; # A tibble: 3,322 × 9</span></span>
<span><span class="co">#&gt;   tailnum  year type              manufacturer    model     engines</span></span>
<span><span class="co">#&gt;   &lt;chr&gt;   &lt;int&gt; &lt;chr&gt;             &lt;chr&gt;           &lt;chr&gt;       &lt;int&gt;</span></span>
<span><span class="co">#&gt; 1 N10156   2004 Fixed wing multi… EMBRAER         EMB-145XR       2</span></span>
<span><span class="co">#&gt; 2 N102UW   1998 Fixed wing multi… AIRBUS INDUSTR… A320-214        2</span></span>
<span><span class="co">#&gt; 3 N103US   1999 Fixed wing multi… AIRBUS INDUSTR… A320-214        2</span></span>
<span><span class="co">#&gt; 4 N104UW   1999 Fixed wing multi… AIRBUS INDUSTR… A320-214        2</span></span>
<span><span class="co">#&gt; 5 N10575   2002 Fixed wing multi… EMBRAER         EMB-145LR       2</span></span>
<span><span class="co">#&gt; 6 N105UW   1999 Fixed wing multi… AIRBUS INDUSTR… A320-214        2</span></span>
<span><span class="co">#&gt; # ℹ 3,316 more rows</span></span>
<span><span class="co">#&gt; # ℹ 3 more variables: seats &lt;int&gt;, speed &lt;int&gt;, engine &lt;chr&gt;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</li>
<li>
<p><code>weather</code>는 출발 공항의 날씨에 대한 데이터를 기록합니다. 위치와 시간의 조합으로 각 관측값을 식별할 수 있으므로 <code>origin</code>과 <code>time_hour</code>가 복합 기본 키가 됩니다.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb5"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">weather</span></span>
<span><span class="co">#&gt; # A tibble: 26,115 × 15</span></span>
<span><span class="co">#&gt;   origin  year month   day  hour  temp  dewp humid wind_dir</span></span>
<span><span class="co">#&gt;   &lt;chr&gt;  &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt;</span></span>
<span><span class="co">#&gt; 1 EWR     2013     1     1     1  39.0  26.1  59.4      270</span></span>
<span><span class="co">#&gt; 2 EWR     2013     1     1     2  39.0  27.0  61.6      250</span></span>
<span><span class="co">#&gt; 3 EWR     2013     1     1     3  39.0  28.0  64.4      240</span></span>
<span><span class="co">#&gt; 4 EWR     2013     1     1     4  39.9  28.0  62.2      250</span></span>
<span><span class="co">#&gt; 5 EWR     2013     1     1     5  39.0  28.0  64.4      260</span></span>
<span><span class="co">#&gt; 6 EWR     2013     1     1     6  37.9  28.0  67.2      240</span></span>
<span><span class="co">#&gt; # ℹ 26,109 more rows</span></span>
<span><span class="co">#&gt; # ℹ 6 more variables: wind_speed &lt;dbl&gt;, wind_gust &lt;dbl&gt;, …</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</li>
</ul>
<p><strong>외래 키(Foreign key)</strong> 는 다른 테이블의 기본 키에 해당하는 변수(또는 변수 집합)입니다. 예를 들어:</p>
<ul>
<li>
<code>flights$tailnum</code>은 기본 키 <code>planes$tailnum</code>에 해당하는 외래 키입니다.</li>
<li>
<code>flights$carrier</code>는 기본 키 <code>airlines$carrier</code>에 해당하는 외래 키입니다.</li>
<li>
<code>flights$origin</code>은 기본 키 <code>airports$faa</code>에 해당하는 외래 키입니다.</li>
<li>
<code>flights$dest</code>는 기본 키 <code>airports$faa</code>에 해당하는 외래 키입니다.</li>
<li>
<code>flights$origin</code>-<code>flights$time_hour</code>는 복합 기본 키 <code>weather$origin</code>-<code>weather$time_hour</code>에 해당하는 복합 외래 키입니다.</li>
</ul>
<p>이러한 관계는 <a href="#fig-flights-relationships" class="quarto-xref">Figure&nbsp;<span>19.1</span></a> 에 시각적으로 요약되어 있습니다.</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-flights-relationships" class="quarto-float quarto-figure quarto-figure-center anchored" alt="nycflights13 패키지의 airports, planes, flights, weather, airlines  데이터셋 간의 관계. airports$faa는 flights$origin 및 flights$dest에  연결됩니다. planes$tailnum은 flights$tailnum에 연결됩니다.  weather$time_hour 및 weather$origin은 공동으로 flights$time_hour 및  flights$origin에 연결됩니다. airlines$carrier는 flights$carrier에  연결됩니다. airports, planes, airlines, weather 데이터 프레임 간에는  직접적인 연결이 없습니다.">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-flights-relationships-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="diagrams/relational.png" class="img-fluid figure-img" alt="nycflights13 패키지의 airports, planes, flights, weather, airlines  데이터셋 간의 관계. airports$faa는 flights$origin 및 flights$dest에  연결됩니다. planes$tailnum은 flights$tailnum에 연결됩니다.  weather$time_hour 및 weather$origin은 공동으로 flights$time_hour 및  flights$origin에 연결됩니다. airlines$carrier는 flights$carrier에  연결됩니다. airports, planes, airlines, weather 데이터 프레임 간에는  직접적인 연결이 없습니다." width="502">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-flights-relationships-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;19.1: nycflights13 패키지의 5개 데이터 프레임 간의 연결. 기본 키를 구성하는 변수는 회색으로 표시되며 화살표로 해당 외래 키에 연결됩니다.
</figcaption></figure>
</div>
</div>
</div>
<p>이 키들의 설계에서 좋은 특징을 발견할 수 있습니다. 기본 키와 외래 키는 거의 항상 동일한 이름을 가지고 있으며, 이는 곧 보게 되겠지만 조인 작업을 훨씬 쉽게 만들어 줄 것입니다. 반대 관계도 주목할 가치가 있습니다. 여러 테이블에서 사용되는 거의 모든 변수 이름은 각 장소에서 동일한 의미를 갖습니다. 예외는 단 하나뿐입니다. <code>year</code>는 <code>flights</code>에서는 출발 연도를 의미하고 <code>planes</code>에서는 제조 연도를 의미합니다. 이것은 실제로 테이블을 조인하기 시작할 때 중요해질 것입니다.</p>
</section><section id="기본-키-확인" class="level3" data-number="19.2.2"><h3 data-number="19.2.2" class="anchored" data-anchor-id="기본-키-확인">
<span class="header-section-number">19.2.2</span> 기본 키 확인</h3>
<p>이제 각 테이블의 기본 키를 식별했으므로 실제로 각 관측값을 고유하게 식별하는지 확인하는 것이 좋습니다. 그렇게 하는 한 가지 방법은 기본 키를 <code><a href="https://dplyr.tidyverse.org/reference/count.html">count()</a></code>하고 <code>n</code>이 1보다 큰 항목을 찾는 것입니다. <code>planes</code>와 <code>weather</code>는 모두 좋아 보입니다:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb6"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">planes</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/count.html">count</a></span><span class="op">(</span><span class="va">tailnum</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">n</span> <span class="op">&gt;</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 0 × 2</span></span>
<span><span class="co">#&gt; # ℹ 2 variables: tailnum &lt;chr&gt;, n &lt;int&gt;</span></span>
<span></span>
<span><span class="va">weather</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/count.html">count</a></span><span class="op">(</span><span class="va">time_hour</span>, <span class="va">origin</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">n</span> <span class="op">&gt;</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 0 × 3</span></span>
<span><span class="co">#&gt; # ℹ 3 variables: time_hour &lt;dttm&gt;, origin &lt;chr&gt;, n &lt;int&gt;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>또한 기본 키에 결측값이 있는지 확인해야 합니다. 값이 누락되면 관측값을 식별할 수 없습니다!</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb7"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">planes</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">tailnum</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 0 × 9</span></span>
<span><span class="co">#&gt; # ℹ 9 variables: tailnum &lt;chr&gt;, year &lt;int&gt;, type &lt;chr&gt;, manufacturer &lt;chr&gt;,</span></span>
<span><span class="co">#&gt; #   model &lt;chr&gt;, engines &lt;int&gt;, seats &lt;int&gt;, speed &lt;int&gt;, engine &lt;chr&gt;</span></span>
<span></span>
<span><span class="va">weather</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">time_hour</span><span class="op">)</span> <span class="op">|</span> <span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">origin</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 0 × 15</span></span>
<span><span class="co">#&gt; # ℹ 15 variables: origin &lt;chr&gt;, year &lt;int&gt;, month &lt;int&gt;, day &lt;int&gt;,</span></span>
<span><span class="co">#&gt; #   hour &lt;int&gt;, temp &lt;dbl&gt;, dewp &lt;dbl&gt;, humid &lt;dbl&gt;, wind_dir &lt;dbl&gt;, …</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section><section id="대리-키surrogate-keys" class="level3" data-number="19.2.3"><h3 data-number="19.2.3" class="anchored" data-anchor-id="대리-키surrogate-keys">
<span class="header-section-number">19.2.3</span> 대리 키(Surrogate keys)</h3>
<p>지금까지 우리는 <code>flights</code>의 기본 키에 대해 이야기하지 않았습니다. 외래 키로 사용하는 데이터 프레임이 없기 때문에 여기서는 별로 중요하지 않지만, 다른 사람들에게 설명할 방법이 있다면 관측값으로 작업하기가 더 쉽기 때문에 고려해 볼 만합니다.</p>
<p>약간의 생각과 실험 끝에 우리는 함께 각 항공편을 고유하게 식별하는 세 가지 변수가 있다고 결정했습니다:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb8"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">flights</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/count.html">count</a></span><span class="op">(</span><span class="va">time_hour</span>, <span class="va">carrier</span>, <span class="va">flight</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">n</span> <span class="op">&gt;</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 0 × 4</span></span>
<span><span class="co">#&gt; # ℹ 4 variables: time_hour &lt;dttm&gt;, carrier &lt;chr&gt;, flight &lt;int&gt;, n &lt;int&gt;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>중복이 없으면 <code>time_hour</code>-<code>carrier</code>-<code>flight</code>가 자동으로 기본 키가 될까요? 확실히 좋은 시작이지만 보장하지는 않습니다. 예를 들어 고도와 위도는 <code>airports</code>에 대한 좋은 기본 키입니까?</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb9"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">airports</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/count.html">count</a></span><span class="op">(</span><span class="va">alt</span>, <span class="va">lat</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">n</span> <span class="op">&gt;</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 1 × 3</span></span>
<span><span class="co">#&gt;     alt   lat     n</span></span>
<span><span class="co">#&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;int&gt;</span></span>
<span><span class="co">#&gt; 1    13  40.6     2</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>고도와 위도로 공항을 식별하는 것은 분명히 나쁜 생각이며 일반적으로 변수 조합이 좋은 기본 키를 만드는지 여부를 데이터만으로는 알 수 없습니다. 그러나 항공편의 경우 <code>time_hour</code>, <code>carrier</code>, <code>flight</code>의 조합은 합리적으로 보입니다. 동일한 비행 편명을 가진 여러 항공편이 동시에 공중에 있다면 항공사와 고객에게 정말 혼란스러울 것이기 때문입니다.</p>
<p>그렇긴 해도 행 번호를 사용하는 간단한 숫자 대리 키를 도입하는 것이 더 나을 수 있습니다:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb10"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">flights2</span> <span class="op">&lt;-</span> <span class="va">flights</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>id <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/row_number.html">row_number</a></span><span class="op">(</span><span class="op">)</span>, .before <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">flights2</span></span>
<span><span class="co">#&gt; # A tibble: 336,776 × 20</span></span>
<span><span class="co">#&gt;      id  year month   day dep_time sched_dep_time dep_delay arr_time</span></span>
<span><span class="co">#&gt;   &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;</span></span>
<span><span class="co">#&gt; 1     1  2013     1     1      517            515         2      830</span></span>
<span><span class="co">#&gt; 2     2  2013     1     1      533            529         4      850</span></span>
<span><span class="co">#&gt; 3     3  2013     1     1      542            540         2      923</span></span>
<span><span class="co">#&gt; 4     4  2013     1     1      544            545        -1     1004</span></span>
<span><span class="co">#&gt; 5     5  2013     1     1      554            600        -6      812</span></span>
<span><span class="co">#&gt; 6     6  2013     1     1      554            558        -4      740</span></span>
<span><span class="co">#&gt; # ℹ 336,770 more rows</span></span>
<span><span class="co">#&gt; # ℹ 12 more variables: sched_arr_time &lt;int&gt;, arr_delay &lt;dbl&gt;, …</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>대리 키는 다른 사람들과 소통할 때 특히 유용할 수 있습니다. 2013-01-03 오전 9시에 출발한 UA430을 보라고 말하는 것보다 2001번 항공편을 보라고 말하는 것이 훨씬 쉽습니다.</p>
</section><section id="연습문제" class="level3" data-number="19.2.4"><h3 data-number="19.2.4" class="anchored" data-anchor-id="연습문제">
<span class="header-section-number">19.2.4</span> 연습문제</h3>
<ol type="1">
<li><p><a href="#fig-flights-relationships" class="quarto-xref">Figure&nbsp;<span>19.1</span></a> 에서 <code>weather</code>와 <code>airports</code> 사이의 관계를 그리는 것을 잊었습니다. 관계는 무엇이며 다이어그램에 어떻게 나타나야 합니까?</p></li>
<li><p><code>weather</code>에는 NYC의 3개 출발 공항에 대한 정보만 포함되어 있습니다. 미국 전역의 공항에 대한 날씨 기록이 포함되어 있다면 <code>flights</code>와 어떤 추가 연결이 생길까요?</p></li>
<li><p><code>weather</code>의 <code>year</code>, <code>month</code>, <code>day</code>, <code>hour</code>, <code>origin</code> 변수는 거의 복합 키를 형성하지만 중복 관측값이 있는 시간이 하나 있습니다. 그 시간의 특별한 점을 파악할 수 있습니까?</p></li>
<li><p>우리는 일년 중 며칠은 특별하고 평소보다 비행하는 사람이 적다는 것을 알고 있습니다(예: 크리스마스 이브와 크리스마스 당일). 해당 데이터를 데이터 프레임으로 어떻게 나타낼 수 있습니까? 기본 키는 무엇입니까? 기존 데이터 프레임과 어떻게 연결됩니까?</p></li>
<li><p>Lahman 패키지의 <code>Batting</code>, <code>People</code>, <code>Salaries</code> 데이터 프레임 간의 연결을 설명하는 다이어그램을 그리세요. <code>People</code>, <code>Managers</code>, <code>AwardsManagers</code> 간의 관계를 보여주는 다른 다이어그램을 그리세요. <code>Batting</code>, <code>Pitching</code>, <code>Fielding</code> 데이터 프레임 간의 관계를 어떻게 특성화하시겠습니까?</p></li>
</ol></section></section><section id="sec-mutating-joins" class="level2" data-number="19.3"><h2 data-number="19.3" class="anchored" data-anchor-id="sec-mutating-joins">
<span class="header-section-number">19.3</span> 기본 조인</h2>
<p>이제 키를 통해 데이터 프레임이 어떻게 연결되는지 이해했으므로 조인을 사용하여 <code>flights</code> 데이터셋을 더 잘 이해할 수 있습니다. dplyr은 6가지 조인 함수를 제공합니다: <code><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join()</a></code>, <code><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">inner_join()</a></code>, <code><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">right_join()</a></code>, <code><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">full_join()</a></code>, <code><a href="https://dplyr.tidyverse.org/reference/filter-joins.html">semi_join()</a></code>, <code>anti_join().</code> 모두 동일한 인터페이스를 가지고 있습니다: 한 쌍의 데이터 프레임(<code>x</code>와 <code>y</code>)을 취하고 데이터 프레임을 반환합니다. 출력의 행과 열 순서는 주로 <code>x</code>에 의해 결정됩니다.</p>
<p>이 섹션에서는 하나의 변형 조인 <code><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join()</a></code>과 두 개의 필터링 조인 <code><a href="https://dplyr.tidyverse.org/reference/filter-joins.html">semi_join()</a></code> 및 <code><a href="https://dplyr.tidyverse.org/reference/filter-joins.html">anti_join()</a></code>을 사용하는 방법을 배웁니다. 다음 섹션에서는 이러한 함수가 어떻게 작동하는지, 그리고 나머지 <code><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">inner_join()</a></code>, <code><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">right_join()</a></code>, <code><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">full_join()</a></code>에 대해 정확히 배울 것입니다.</p>
<section id="변형-조인mutating-joins" class="level3" data-number="19.3.1"><h3 data-number="19.3.1" class="anchored" data-anchor-id="변형-조인mutating-joins">
<span class="header-section-number">19.3.1</span> 변형 조인(Mutating joins)</h3>
<p><strong>변형 조인</strong>을 사용하면 두 데이터 프레임의 변수를 결합할 수 있습니다. 먼저 키로 관측값을 일치시킨 다음 한 데이터 프레임에서 다른 데이터 프레임으로 변수를 복사합니다. <code><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate()</a></code>와 마찬가지로 조인 함수는 오른쪽에 변수를 추가하므로 데이터셋에 변수가 많으면 새 변수가 보이지 않을 수 있습니다. 이 예제에서는 변수가 6개뿐인 좁은 데이터셋을 만들어 무슨 일이 일어나고 있는지 더 쉽게 볼 수 있도록 하겠습니다<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a>:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb11"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">flights2</span> <span class="op">&lt;-</span> <span class="va">flights</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">year</span>, <span class="va">time_hour</span>, <span class="va">origin</span>, <span class="va">dest</span>, <span class="va">tailnum</span>, <span class="va">carrier</span><span class="op">)</span></span>
<span><span class="va">flights2</span></span>
<span><span class="co">#&gt; # A tibble: 336,776 × 6</span></span>
<span><span class="co">#&gt;    year time_hour           origin dest  tailnum carrier</span></span>
<span><span class="co">#&gt;   &lt;int&gt; &lt;dttm&gt;              &lt;chr&gt;  &lt;chr&gt; &lt;chr&gt;   &lt;chr&gt;  </span></span>
<span><span class="co">#&gt; 1  2013 2013-01-01 05:00:00 EWR    IAH   N14228  UA     </span></span>
<span><span class="co">#&gt; 2  2013 2013-01-01 05:00:00 LGA    IAH   N24211  UA     </span></span>
<span><span class="co">#&gt; 3  2013 2013-01-01 05:00:00 JFK    MIA   N619AA  AA     </span></span>
<span><span class="co">#&gt; 4  2013 2013-01-01 05:00:00 JFK    BQN   N804JB  B6     </span></span>
<span><span class="co">#&gt; 5  2013 2013-01-01 06:00:00 LGA    ATL   N668DN  DL     </span></span>
<span><span class="co">#&gt; 6  2013 2013-01-01 05:00:00 EWR    ORD   N39463  UA     </span></span>
<span><span class="co">#&gt; # ℹ 336,770 more rows</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>네 가지 유형의 변형 조인이 있지만 거의 항상 사용하는 하나가 있습니다: <code><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join()</a></code>. 출력이 항상 조인하는 데이터 프레임인 <code>x</code>와 동일한 행을 갖기 때문에 특별합니다<a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a>. <code><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join()</a></code>의 주된 용도는 추가 메타데이터를 추가하는 것입니다. 예를 들어 <code><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join()</a></code>을 사용하여 <code>flights2</code> 데이터에 전체 항공사 이름을 추가할 수 있습니다:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb12"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">flights2</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join</a></span><span class="op">(</span><span class="va">airlines</span><span class="op">)</span></span>
<span><span class="co">#&gt; Joining with `by = join_by(carrier)`</span></span>
<span><span class="co">#&gt; # A tibble: 336,776 × 7</span></span>
<span><span class="co">#&gt;    year time_hour           origin dest  tailnum carrier name                </span></span>
<span><span class="co">#&gt;   &lt;int&gt; &lt;dttm&gt;              &lt;chr&gt;  &lt;chr&gt; &lt;chr&gt;   &lt;chr&gt;   &lt;chr&gt;               </span></span>
<span><span class="co">#&gt; 1  2013 2013-01-01 05:00:00 EWR    IAH   N14228  UA      United Air Lines In…</span></span>
<span><span class="co">#&gt; 2  2013 2013-01-01 05:00:00 LGA    IAH   N24211  UA      United Air Lines In…</span></span>
<span><span class="co">#&gt; 3  2013 2013-01-01 05:00:00 JFK    MIA   N619AA  AA      American Airlines I…</span></span>
<span><span class="co">#&gt; 4  2013 2013-01-01 05:00:00 JFK    BQN   N804JB  B6      JetBlue Airways     </span></span>
<span><span class="co">#&gt; 5  2013 2013-01-01 06:00:00 LGA    ATL   N668DN  DL      Delta Air Lines Inc.</span></span>
<span><span class="co">#&gt; 6  2013 2013-01-01 05:00:00 EWR    ORD   N39463  UA      United Air Lines In…</span></span>
<span><span class="co">#&gt; # ℹ 336,770 more rows</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>또는 각 비행기가 출발할 때의 온도와 풍속을 알아낼 수 있습니다:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb13"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">flights2</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join</a></span><span class="op">(</span><span class="va">weather</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">origin</span>, <span class="va">time_hour</span>, <span class="va">temp</span>, <span class="va">wind_speed</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; Joining with `by = join_by(time_hour, origin)`</span></span>
<span><span class="co">#&gt; # A tibble: 336,776 × 8</span></span>
<span><span class="co">#&gt;    year time_hour           origin dest  tailnum carrier  temp wind_speed</span></span>
<span><span class="co">#&gt;   &lt;int&gt; &lt;dttm&gt;              &lt;chr&gt;  &lt;chr&gt; &lt;chr&gt;   &lt;chr&gt;   &lt;dbl&gt;      &lt;dbl&gt;</span></span>
<span><span class="co">#&gt; 1  2013 2013-01-01 05:00:00 EWR    IAH   N14228  UA       39.0       12.7</span></span>
<span><span class="co">#&gt; 2  2013 2013-01-01 05:00:00 LGA    IAH   N24211  UA       39.9       15.0</span></span>
<span><span class="co">#&gt; 3  2013 2013-01-01 05:00:00 JFK    MIA   N619AA  AA       39.0       15.0</span></span>
<span><span class="co">#&gt; 4  2013 2013-01-01 05:00:00 JFK    BQN   N804JB  B6       39.0       15.0</span></span>
<span><span class="co">#&gt; 5  2013 2013-01-01 06:00:00 LGA    ATL   N668DN  DL       39.9       16.1</span></span>
<span><span class="co">#&gt; 6  2013 2013-01-01 05:00:00 EWR    ORD   N39463  UA       39.0       12.7</span></span>
<span><span class="co">#&gt; # ℹ 336,770 more rows</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>또는 어떤 크기의 비행기가 비행했는지:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb14"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">flights2</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join</a></span><span class="op">(</span><span class="va">planes</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">tailnum</span>, <span class="va">type</span>, <span class="va">engines</span>, <span class="va">seats</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; Joining with `by = join_by(tailnum)`</span></span>
<span><span class="co">#&gt; # A tibble: 336,776 × 9</span></span>
<span><span class="co">#&gt;    year time_hour           origin dest  tailnum carrier type                </span></span>
<span><span class="co">#&gt;   &lt;int&gt; &lt;dttm&gt;              &lt;chr&gt;  &lt;chr&gt; &lt;chr&gt;   &lt;chr&gt;   &lt;chr&gt;               </span></span>
<span><span class="co">#&gt; 1  2013 2013-01-01 05:00:00 EWR    IAH   N14228  UA      Fixed wing multi en…</span></span>
<span><span class="co">#&gt; 2  2013 2013-01-01 05:00:00 LGA    IAH   N24211  UA      Fixed wing multi en…</span></span>
<span><span class="co">#&gt; 3  2013 2013-01-01 05:00:00 JFK    MIA   N619AA  AA      Fixed wing multi en…</span></span>
<span><span class="co">#&gt; 4  2013 2013-01-01 05:00:00 JFK    BQN   N804JB  B6      Fixed wing multi en…</span></span>
<span><span class="co">#&gt; 5  2013 2013-01-01 06:00:00 LGA    ATL   N668DN  DL      Fixed wing multi en…</span></span>
<span><span class="co">#&gt; 6  2013 2013-01-01 05:00:00 EWR    ORD   N39463  UA      Fixed wing multi en…</span></span>
<span><span class="co">#&gt; # ℹ 336,770 more rows</span></span>
<span><span class="co">#&gt; # ℹ 2 more variables: engines &lt;int&gt;, seats &lt;int&gt;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p><code><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join()</a></code>이 <code>x</code>의 행에 대한 일치 항목을 찾지 못하면 새 변수를 결측값으로 채웁니다. 예를 들어 꼬리 번호가 <code>N3ALAA</code>인 비행기에 대한 정보가 없으므로 <code>type</code>, <code>engines</code>, <code>seats</code>는 누락됩니다:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb15"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">flights2</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">tailnum</span> <span class="op">==</span> <span class="st">"N3ALAA"</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join</a></span><span class="op">(</span><span class="va">planes</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">tailnum</span>, <span class="va">type</span>, <span class="va">engines</span>, <span class="va">seats</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; Joining with `by = join_by(tailnum)`</span></span>
<span><span class="co">#&gt; # A tibble: 63 × 9</span></span>
<span><span class="co">#&gt;    year time_hour           origin dest  tailnum carrier type  engines seats</span></span>
<span><span class="co">#&gt;   &lt;int&gt; &lt;dttm&gt;              &lt;chr&gt;  &lt;chr&gt; &lt;chr&gt;   &lt;chr&gt;   &lt;chr&gt;   &lt;int&gt; &lt;int&gt;</span></span>
<span><span class="co">#&gt; 1  2013 2013-01-01 06:00:00 LGA    ORD   N3ALAA  AA      &lt;NA&gt;       NA    NA</span></span>
<span><span class="co">#&gt; 2  2013 2013-01-02 18:00:00 LGA    ORD   N3ALAA  AA      &lt;NA&gt;       NA    NA</span></span>
<span><span class="co">#&gt; 3  2013 2013-01-03 06:00:00 LGA    ORD   N3ALAA  AA      &lt;NA&gt;       NA    NA</span></span>
<span><span class="co">#&gt; 4  2013 2013-01-07 19:00:00 LGA    ORD   N3ALAA  AA      &lt;NA&gt;       NA    NA</span></span>
<span><span class="co">#&gt; 5  2013 2013-01-08 17:00:00 JFK    ORD   N3ALAA  AA      &lt;NA&gt;       NA    NA</span></span>
<span><span class="co">#&gt; 6  2013 2013-01-16 06:00:00 LGA    ORD   N3ALAA  AA      &lt;NA&gt;       NA    NA</span></span>
<span><span class="co">#&gt; # ℹ 57 more rows</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>이 장의 나머지 부분에서 이 문제로 몇 번 돌아올 것입니다.</p>
</section><section id="조인-키-지정" class="level3" data-number="19.3.2"><h3 data-number="19.3.2" class="anchored" data-anchor-id="조인-키-지정">
<span class="header-section-number">19.3.2</span> 조인 키 지정</h3>
<p>기본적으로 <code><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join()</a></code>은 두 데이터 프레임에 모두 나타나는 모든 변수를 조인 키로 사용합니다. 이를 소위 <strong>자연(natural)</strong> 조인이라고 합니다. 유용한 경험적 방법이지만 항상 작동하는 것은 아닙니다. 예를 들어 <code>flights2</code>를 전체 <code>planes</code> 데이터셋과 조인하려고 하면 어떻게 될까요?</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb16"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">flights2</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join</a></span><span class="op">(</span><span class="va">planes</span><span class="op">)</span></span>
<span><span class="co">#&gt; Joining with `by = join_by(year, tailnum)`</span></span>
<span><span class="co">#&gt; # A tibble: 336,776 × 13</span></span>
<span><span class="co">#&gt;    year time_hour           origin dest  tailnum carrier type  manufacturer</span></span>
<span><span class="co">#&gt;   &lt;int&gt; &lt;dttm&gt;              &lt;chr&gt;  &lt;chr&gt; &lt;chr&gt;   &lt;chr&gt;   &lt;chr&gt; &lt;chr&gt;       </span></span>
<span><span class="co">#&gt; 1  2013 2013-01-01 05:00:00 EWR    IAH   N14228  UA      &lt;NA&gt;  &lt;NA&gt;        </span></span>
<span><span class="co">#&gt; 2  2013 2013-01-01 05:00:00 LGA    IAH   N24211  UA      &lt;NA&gt;  &lt;NA&gt;        </span></span>
<span><span class="co">#&gt; 3  2013 2013-01-01 05:00:00 JFK    MIA   N619AA  AA      &lt;NA&gt;  &lt;NA&gt;        </span></span>
<span><span class="co">#&gt; 4  2013 2013-01-01 05:00:00 JFK    BQN   N804JB  B6      &lt;NA&gt;  &lt;NA&gt;        </span></span>
<span><span class="co">#&gt; 5  2013 2013-01-01 06:00:00 LGA    ATL   N668DN  DL      &lt;NA&gt;  &lt;NA&gt;        </span></span>
<span><span class="co">#&gt; 6  2013 2013-01-01 05:00:00 EWR    ORD   N39463  UA      &lt;NA&gt;  &lt;NA&gt;        </span></span>
<span><span class="co">#&gt; # ℹ 336,770 more rows</span></span>
<span><span class="co">#&gt; # ℹ 5 more variables: model &lt;chr&gt;, engines &lt;int&gt;, seats &lt;int&gt;, …</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>조인이 <code>tailnum</code>과 <code>year</code>를 복합 키로 사용하려고 하기 때문에 누락된 일치 항목이 많이 발생합니다. <code>flights</code>와 <code>planes</code> 모두 <code>year</code> 열이 있지만 의미가 다릅니다. <code>flights$year</code>는 비행이 발생한 연도이고 <code>planes$year</code>는 비행기가 제조된 연도입니다. 우리는 <code>tailnum</code>으로만 조인하고 싶으므로 <code><a href="https://dplyr.tidyverse.org/reference/join_by.html">join_by()</a></code>를 사용하여 명시적 사양을 제공해야 합니다:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb17"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">flights2</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join</a></span><span class="op">(</span><span class="va">planes</span>, <span class="fu"><a href="https://dplyr.tidyverse.org/reference/join_by.html">join_by</a></span><span class="op">(</span><span class="va">tailnum</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 336,776 × 14</span></span>
<span><span class="co">#&gt;   year.x time_hour           origin dest  tailnum carrier year.y</span></span>
<span><span class="co">#&gt;    &lt;int&gt; &lt;dttm&gt;              &lt;chr&gt;  &lt;chr&gt; &lt;chr&gt;   &lt;chr&gt;    &lt;int&gt;</span></span>
<span><span class="co">#&gt; 1   2013 2013-01-01 05:00:00 EWR    IAH   N14228  UA        1999</span></span>
<span><span class="co">#&gt; 2   2013 2013-01-01 05:00:00 LGA    IAH   N24211  UA        1998</span></span>
<span><span class="co">#&gt; 3   2013 2013-01-01 05:00:00 JFK    MIA   N619AA  AA        1990</span></span>
<span><span class="co">#&gt; 4   2013 2013-01-01 05:00:00 JFK    BQN   N804JB  B6        2012</span></span>
<span><span class="co">#&gt; 5   2013 2013-01-01 06:00:00 LGA    ATL   N668DN  DL        1991</span></span>
<span><span class="co">#&gt; 6   2013 2013-01-01 05:00:00 EWR    ORD   N39463  UA        2012</span></span>
<span><span class="co">#&gt; # ℹ 336,770 more rows</span></span>
<span><span class="co">#&gt; # ℹ 7 more variables: type &lt;chr&gt;, manufacturer &lt;chr&gt;, model &lt;chr&gt;, …</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p><code>year</code> 변수는 출력에서 접미사(<code>year.x</code> 및 <code>year.y</code>)로 구분되어 변수가 <code>x</code> 또는 <code>y</code> 인수에서 왔는지 알려줍니다. <code>suffix</code> 인수로 기본 접미사를 재정의할 수 있습니다.</p>
<p><code>join_by(tailnum)</code>은 <code>join_by(tailnum == tailnum)</code>의 줄임말입니다. 두 가지 이유로 이 더 긴 형식에 대해 아는 것이 중요합니다. 첫째, 두 테이블 간의 관계를 설명합니다. 키는 동일해야 합니다. 이것이 이러한 유형의 조인을 종종 <strong>동등 조인(equi join)</strong> 이라고 부르는 이유입니다. <a href="#sec-non-equi-joins" class="quarto-xref"><span>Section 19.5</span></a> 에서 비동등 조인에 대해 배울 것입니다.</p>
<p>둘째, 각 테이블에서 서로 다른 조인 키를 지정하는 방법입니다. 예를 들어 <code>flight2</code>와 <code>airports</code> 테이블을 조인하는 방법에는 <code>dest</code> 또는 <code>origin</code>의 두 가지가 있습니다:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb18"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">flights2</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join</a></span><span class="op">(</span><span class="va">airports</span>, <span class="fu"><a href="https://dplyr.tidyverse.org/reference/join_by.html">join_by</a></span><span class="op">(</span><span class="va">dest</span> <span class="op">==</span> <span class="va">faa</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 336,776 × 13</span></span>
<span><span class="co">#&gt;    year time_hour           origin dest  tailnum carrier name                </span></span>
<span><span class="co">#&gt;   &lt;int&gt; &lt;dttm&gt;              &lt;chr&gt;  &lt;chr&gt; &lt;chr&gt;   &lt;chr&gt;   &lt;chr&gt;               </span></span>
<span><span class="co">#&gt; 1  2013 2013-01-01 05:00:00 EWR    IAH   N14228  UA      George Bush Interco…</span></span>
<span><span class="co">#&gt; 2  2013 2013-01-01 05:00:00 LGA    IAH   N24211  UA      George Bush Interco…</span></span>
<span><span class="co">#&gt; 3  2013 2013-01-01 05:00:00 JFK    MIA   N619AA  AA      Miami Intl          </span></span>
<span><span class="co">#&gt; 4  2013 2013-01-01 05:00:00 JFK    BQN   N804JB  B6      &lt;NA&gt;                </span></span>
<span><span class="co">#&gt; 5  2013 2013-01-01 06:00:00 LGA    ATL   N668DN  DL      Hartsfield Jackson …</span></span>
<span><span class="co">#&gt; 6  2013 2013-01-01 05:00:00 EWR    ORD   N39463  UA      Chicago Ohare Intl  </span></span>
<span><span class="co">#&gt; # ℹ 336,770 more rows</span></span>
<span><span class="co">#&gt; # ℹ 6 more variables: lat &lt;dbl&gt;, lon &lt;dbl&gt;, alt &lt;dbl&gt;, tz &lt;dbl&gt;, …</span></span>
<span></span>
<span><span class="va">flights2</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join</a></span><span class="op">(</span><span class="va">airports</span>, <span class="fu"><a href="https://dplyr.tidyverse.org/reference/join_by.html">join_by</a></span><span class="op">(</span><span class="va">origin</span> <span class="op">==</span> <span class="va">faa</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 336,776 × 13</span></span>
<span><span class="co">#&gt;    year time_hour           origin dest  tailnum carrier name               </span></span>
<span><span class="co">#&gt;   &lt;int&gt; &lt;dttm&gt;              &lt;chr&gt;  &lt;chr&gt; &lt;chr&gt;   &lt;chr&gt;   &lt;chr&gt;              </span></span>
<span><span class="co">#&gt; 1  2013 2013-01-01 05:00:00 EWR    IAH   N14228  UA      Newark Liberty Intl</span></span>
<span><span class="co">#&gt; 2  2013 2013-01-01 05:00:00 LGA    IAH   N24211  UA      La Guardia         </span></span>
<span><span class="co">#&gt; 3  2013 2013-01-01 05:00:00 JFK    MIA   N619AA  AA      John F Kennedy Intl</span></span>
<span><span class="co">#&gt; 4  2013 2013-01-01 05:00:00 JFK    BQN   N804JB  B6      John F Kennedy Intl</span></span>
<span><span class="co">#&gt; 5  2013 2013-01-01 06:00:00 LGA    ATL   N668DN  DL      La Guardia         </span></span>
<span><span class="co">#&gt; 6  2013 2013-01-01 05:00:00 EWR    ORD   N39463  UA      Newark Liberty Intl</span></span>
<span><span class="co">#&gt; # ℹ 336,770 more rows</span></span>
<span><span class="co">#&gt; # ℹ 6 more variables: lat &lt;dbl&gt;, lon &lt;dbl&gt;, alt &lt;dbl&gt;, tz &lt;dbl&gt;, …</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>이전 코드에서는 문자 벡터를 사용하여 조인 키를 지정하는 다른 방법을 볼 수 있습니다:</p>
<ul>
<li>
<code>by = "x"</code>는 <code>join_by(x)</code>에 해당합니다.</li>
<li>
<code>by = c("a" = "x")</code>는 <code>join_by(a == x)</code>에 해당합니다.</li>
</ul>
<p>이제 <code><a href="https://dplyr.tidyverse.org/reference/join_by.html">join_by()</a></code>가 존재하므로 더 명확하고 유연한 사양을 제공하기 때문에 선호합니다.</p>
<p><code><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">inner_join()</a></code>, <code><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">right_join()</a></code>, <code><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">full_join()</a></code>은 <code><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join()</a></code>과 동일한 인터페이스를 가집니다. 차이점은 유지하는 행입니다. 왼쪽 조인은 <code>x</code>의 모든 행을 유지하고, 오른쪽 조인은 <code>y</code>의 모든 행을 유지하고, 전체 조인은 <code>x</code> 또는 <code>y</code>의 모든 행을 유지하고, 내부 조인은 <code>x</code>와 <code>y</code> 모두에서 발생하는 행만 유지합니다. 나중에 이에 대해 더 자세히 다시 다룰 것입니다.</p>
</section><section id="필터링-조인filtering-joins" class="level3" data-number="19.3.3"><h3 data-number="19.3.3" class="anchored" data-anchor-id="필터링-조인filtering-joins">
<span class="header-section-number">19.3.3</span> 필터링 조인(Filtering joins)</h3>
<p>짐작할 수 있듯이 <strong>필터링 조인</strong>의 주요 조치는 행을 필터링하는 것입니다. 세미 조인과 안티 조인의 두 가지 유형이 있습니다. <strong>세미 조인(Semi-joins)</strong> 은 <code>y</code>에 일치하는 항목이 있는 <code>x</code>의 모든 행을 유지합니다. 예를 들어 세미 조인을 사용하여 <code>airports</code> 데이터셋을 필터링하여 출발 공항만 표시할 수 있습니다:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb19"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">airports</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter-joins.html">semi_join</a></span><span class="op">(</span><span class="va">flights2</span>, <span class="fu"><a href="https://dplyr.tidyverse.org/reference/join_by.html">join_by</a></span><span class="op">(</span><span class="va">faa</span> <span class="op">==</span> <span class="va">origin</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 3 × 8</span></span>
<span><span class="co">#&gt;   faa   name                  lat   lon   alt    tz dst   tzone           </span></span>
<span><span class="co">#&gt;   &lt;chr&gt; &lt;chr&gt;               &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;           </span></span>
<span><span class="co">#&gt; 1 EWR   Newark Liberty Intl  40.7 -74.2    18    -5 A     America/New_York</span></span>
<span><span class="co">#&gt; 2 JFK   John F Kennedy Intl  40.6 -73.8    13    -5 A     America/New_York</span></span>
<span><span class="co">#&gt; 3 LGA   La Guardia           40.8 -73.9    22    -5 A     America/New_York</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>또는 목적지만:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb20"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">airports</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter-joins.html">semi_join</a></span><span class="op">(</span><span class="va">flights2</span>, <span class="fu"><a href="https://dplyr.tidyverse.org/reference/join_by.html">join_by</a></span><span class="op">(</span><span class="va">faa</span> <span class="op">==</span> <span class="va">dest</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 101 × 8</span></span>
<span><span class="co">#&gt;   faa   name                     lat    lon   alt    tz dst   tzone          </span></span>
<span><span class="co">#&gt;   &lt;chr&gt; &lt;chr&gt;                  &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;          </span></span>
<span><span class="co">#&gt; 1 ABQ   Albuquerque Internati…  35.0 -107.   5355    -7 A     America/Denver </span></span>
<span><span class="co">#&gt; 2 ACK   Nantucket Mem           41.3  -70.1    48    -5 A     America/New_Yo…</span></span>
<span><span class="co">#&gt; 3 ALB   Albany Intl             42.7  -73.8   285    -5 A     America/New_Yo…</span></span>
<span><span class="co">#&gt; 4 ANC   Ted Stevens Anchorage…  61.2 -150.    152    -9 A     America/Anchor…</span></span>
<span><span class="co">#&gt; 5 ATL   Hartsfield Jackson At…  33.6  -84.4  1026    -5 A     America/New_Yo…</span></span>
<span><span class="co">#&gt; 6 AUS   Austin Bergstrom Intl   30.2  -97.7   542    -6 A     America/Chicago</span></span>
<span><span class="co">#&gt; # ℹ 95 more rows</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p><strong>안티 조인(Anti-joins)</strong> 은 그 반대입니다. <code>y</code>에 일치하는 항목이 없는 <code>x</code>의 모든 행을 반환합니다. <a href="missing-values.html#sec-missing-implicit" class="quarto-xref"><span>Section 18.3</span></a> 의 주제인 데이터에 <strong>암시된</strong> 결측값을 찾는 데 유용합니다. 암시적으로 누락된 값은 <code>NA</code>로 표시되지 않고 부재로만 존재합니다. 예를 들어 일치하는 목적지 공항이 없는 항공편을 찾아 <code>airports</code>에서 누락된 행을 찾을 수 있습니다:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb21"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">flights2</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter-joins.html">anti_join</a></span><span class="op">(</span><span class="va">airports</span>, <span class="fu"><a href="https://dplyr.tidyverse.org/reference/join_by.html">join_by</a></span><span class="op">(</span><span class="va">dest</span> <span class="op">==</span> <span class="va">faa</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/distinct.html">distinct</a></span><span class="op">(</span><span class="va">dest</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 4 × 1</span></span>
<span><span class="co">#&gt;   dest </span></span>
<span><span class="co">#&gt;   &lt;chr&gt;</span></span>
<span><span class="co">#&gt; 1 BQN  </span></span>
<span><span class="co">#&gt; 2 SJU  </span></span>
<span><span class="co">#&gt; 3 STT  </span></span>
<span><span class="co">#&gt; 4 PSE</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>또는 <code>planes</code>에서 누락된 <code>tailnum</code>을 찾을 수 있습니다:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb22"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">flights2</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter-joins.html">anti_join</a></span><span class="op">(</span><span class="va">planes</span>, <span class="fu"><a href="https://dplyr.tidyverse.org/reference/join_by.html">join_by</a></span><span class="op">(</span><span class="va">tailnum</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/distinct.html">distinct</a></span><span class="op">(</span><span class="va">tailnum</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 722 × 1</span></span>
<span><span class="co">#&gt;   tailnum</span></span>
<span><span class="co">#&gt;   &lt;chr&gt;  </span></span>
<span><span class="co">#&gt; 1 N3ALAA </span></span>
<span><span class="co">#&gt; 2 N3DUAA </span></span>
<span><span class="co">#&gt; 3 N542MQ </span></span>
<span><span class="co">#&gt; 4 N730MQ </span></span>
<span><span class="co">#&gt; 5 N9EAMQ </span></span>
<span><span class="co">#&gt; 6 N532UA </span></span>
<span><span class="co">#&gt; # ℹ 716 more rows</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section><section id="연습문제-1" class="level3" data-number="19.3.4"><h3 data-number="19.3.4" class="anchored" data-anchor-id="연습문제-1">
<span class="header-section-number">19.3.4</span> 연습문제</h3>
<ol type="1">
<li><p>(일년 전체 과정에서) 최악의 지연이 있는 48시간을 찾으세요. <code>weather</code> 데이터와 상호 참조하세요. 패턴을 볼 수 있습니까?</p></li>
<li>
<p>이 코드를 사용하여 가장 인기 있는 10개 목적지를 찾았다고 상상해 보세요:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb23"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">top_dest</span> <span class="op">&lt;-</span> <span class="va">flights2</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/count.html">count</a></span><span class="op">(</span><span class="va">dest</span>, sort <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="fl">10</span><span class="op">)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>그 목적지로 가는 모든 항공편을 어떻게 찾을 수 있습니까?</p>
</li>
<li><p>모든 출발 항공편에 해당 시간의 날씨 데이터가 있습니까?</p></li>
<li><p><code>planes</code>에 일치하는 기록이 없는 꼬리 번호의 공통점은 무엇입니까? (힌트: 하나의 변수가 문제의 약 90%를 설명합니다.)</p></li>
<li><p>해당 비행기를 운항한 모든 <code>carrier</code>를 나열하는 열을 <code>planes</code>에 추가하세요. 각 비행기는 단일 항공사에 의해 운항되기 때문에 비행기와 항공사 사이에 암시적인 관계가 있을 것이라고 기대할 수 있습니다. 이전 장에서 배운 도구를 사용하여 이 가설을 확인하거나 기각하세요.</p></li>
<li><p><code>flights</code>에 출발 <em>및</em> 도착 공항의 위도와 경도를 추가하세요. 조인 전이나 후에 열 이름을 바꾸는 것이 더 쉽습니까?</p></li>
<li>
<p>목적지별 평균 지연을 계산한 다음 <code>airports</code> 데이터 프레임에 조인하여 지연의 공간적 분포를 보여줄 수 있도록 하세요. 미국 지도를 그리는 쉬운 방법은 다음과 같습니다:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb24"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">airports</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter-joins.html">semi_join</a></span><span class="op">(</span><span class="va">flights</span>, <span class="fu"><a href="https://dplyr.tidyverse.org/reference/join_by.html">join_by</a></span><span class="op">(</span><span class="va">faa</span> <span class="op">==</span> <span class="va">dest</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">lon</span>, y <span class="op">=</span> <span class="va">lat</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/annotation_borders.html">borders</a></span><span class="op">(</span><span class="st">"state"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_map.html">coord_quickmap</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>점의 <code>size</code> 또는 <code>color</code>를 사용하여 각 공항의 평균 지연을 표시하고 싶을 수 있습니다.</p>
</li>
<li><p>2013년 6월 13일에 무슨 일이 일어났습니까? 지연 지도를 그린 다음 Google을 사용하여 날씨와 상호 참조하세요.</p></li>
</ol></section></section><section id="조인은-어떻게-작동합니까" class="level2" data-number="19.4"><h2 data-number="19.4" class="anchored" data-anchor-id="조인은-어떻게-작동합니까">
<span class="header-section-number">19.4</span> 조인은 어떻게 작동합니까?</h2>
<p>이제 조인을 몇 번 사용했으므로 <code>x</code>의 각 행이 <code>y</code>의 행과 어떻게 일치하는지에 초점을 맞춰 조인이 작동하는 방식에 대해 자세히 알아볼 때입니다. <a href="#fig-join-setup" class="quarto-xref">Figure&nbsp;<span>19.2</span></a> 에 표시된 아래 정의된 간단한 티블을 사용하여 조인의 시각적 표현을 소개하는 것으로 시작하겠습니다. 이 예제에서는 <code>key</code>라는 단일 키와 단일 값 열(<code>val_x</code> 및 <code>val_y</code>)을 사용하지만 아이디어는 모두 여러 키와 여러 값으로 일반화됩니다.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb25"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tribble.html">tribble</a></span><span class="op">(</span></span>
<span>  <span class="op">~</span><span class="va">key</span>, <span class="op">~</span><span class="va">val_x</span>,</span>
<span>     <span class="fl">1</span>, <span class="st">"x1"</span>,</span>
<span>     <span class="fl">2</span>, <span class="st">"x2"</span>,</span>
<span>     <span class="fl">3</span>, <span class="st">"x3"</span></span>
<span><span class="op">)</span></span>
<span><span class="va">y</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tribble.html">tribble</a></span><span class="op">(</span></span>
<span>  <span class="op">~</span><span class="va">key</span>, <span class="op">~</span><span class="va">val_y</span>,</span>
<span>     <span class="fl">1</span>, <span class="st">"y1"</span>,</span>
<span>     <span class="fl">2</span>, <span class="st">"y2"</span>,</span>
<span>     <span class="fl">4</span>, <span class="st">"y3"</span></span>
<span><span class="op">)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div class="cell">
<div class="cell-output-display">
<div id="fig-join-setup" class="quarto-float quarto-figure quarto-figure-center anchored" alt="x와 y는 텍스트에 설명된 내용을 포함하는 2열 3행의 데이터 프레임입니다.  키 값은 색상으로 지정됩니다: 1은 녹색, 2는 보라색, 3은 주황색, 4는  노란색입니다.">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-join-setup-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="diagrams/join/setup.png" class="img-fluid figure-img" alt="x와 y는 텍스트에 설명된 내용을 포함하는 2열 3행의 데이터 프레임입니다.  키 값은 색상으로 지정됩니다: 1은 녹색, 2는 보라색, 3은 주황색, 4는  노란색입니다." width="160">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-join-setup-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;19.2: 두 개의 간단한 테이블의 그래픽 표현. 색상이 지정된 <code>key</code> 열은 배경색을 키 값에 매핑합니다. 회색 열은 따라오는 “값” 열을 나타냅니다.
</figcaption></figure>
</div>
</div>
</div>
<p><a href="#fig-join-setup2" class="quarto-xref">Figure&nbsp;<span>19.3</span></a> 는 시각적 표현의 기초를 소개합니다. <code>x</code>의 각 행과 <code>y</code>의 각 행에서 그려진 선 사이의 교차점으로 <code>x</code>와 <code>y</code> 사이의 모든 잠재적 일치를 보여줍니다. 출력의 행과 열은 주로 <code>x</code>에 의해 결정되므로 <code>x</code> 테이블은 수평이며 출력과 일치합니다.</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-join-setup2" class="quarto-float quarto-figure quarto-figure-center anchored" alt="x와 y는 직각으로 배치되어 있으며 x에서 수평선이, y에서 수직선이  확장됩니다. x에 3개 행, y에 3개 행이 있어 9개의 잠재적 일치를  나타내는 9개의 교차점이 생성됩니다.">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-join-setup2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="diagrams/join/setup2.png" class="img-fluid figure-img" alt="x와 y는 직각으로 배치되어 있으며 x에서 수평선이, y에서 수직선이  확장됩니다. x에 3개 행, y에 3개 행이 있어 9개의 잠재적 일치를  나타내는 9개의 교차점이 생성됩니다." width="170">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-join-setup2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;19.3: 조인이 작동하는 방식을 이해하려면 가능한 모든 일치를 생각하는 것이 유용합니다. 여기서는 연결선 그리드로 보여줍니다.
</figcaption></figure>
</div>
</div>
</div>
<p>특정 유형의 조인을 설명하기 위해 일치 항목을 점으로 나타냅니다. 일치 항목은 키, x 값, y 값을 포함하는 새 데이터 프레임인 출력의 행을 결정합니다. 예를 들어 <a href="#fig-join-inner" class="quarto-xref">Figure&nbsp;<span>19.4</span></a> 는 키가 동일한 경우에만 행이 유지되는 내부 조인을 보여줍니다.</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-join-inner" class="quarto-float quarto-figure quarto-figure-center anchored" alt="x와 y는 잠재적 일치 그리드를 형성하는 선과 함께 직각으로 배치됩니다.  키 1과 2가 x와 y 모두에 나타나므로 일치 항목을 얻으며 점으로 표시됩니다.  각 점은 출력의 행에 해당하므로 결과 조인된 데이터 프레임에는 2개의  행이 있습니다.">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-join-inner-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="diagrams/join/inner.png" class="img-fluid figure-img" alt="x와 y는 잠재적 일치 그리드를 형성하는 선과 함께 직각으로 배치됩니다.  키 1과 2가 x와 y 모두에 나타나므로 일치 항목을 얻으며 점으로 표시됩니다.  각 점은 출력의 행에 해당하므로 결과 조인된 데이터 프레임에는 2개의  행이 있습니다." width="363">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-join-inner-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;19.4: 내부 조인은 <code>x</code>의 각 행을 <code>key</code> 값이 같은 <code>y</code>의 행과 일치시킵니다. 각 일치 항목은 출력에서 하나의 행이 됩니다.
</figcaption></figure>
</div>
</div>
</div>
<p>동일한 원칙을 적용하여 데이터 프레임 중 하나 이상에 나타나는 관측값을 유지하는 <strong>외부 조인(outer joins)</strong> 을 설명할 수 있습니다. 이러한 조인은 각 데이터 프레임에 추가 “가상” 관측값을 추가하여 작동합니다. 이 관측값에는 다른 키가 일치하지 않는 경우 일치하는 키와 <code>NA</code>로 채워진 값이 있습니다. 세 가지 유형의 외부 조인이 있습니다:</p>
<ul>
<li>
<p><strong>왼쪽 조인</strong>은 <code>x</code>의 모든 관측값을 유지합니다(<a href="#fig-join-left" class="quarto-xref">Figure&nbsp;<span>19.5</span></a>). <code>x</code>의 모든 행은 <code>y</code>의 <code>NA</code> 행과 일치하도록 폴백할 수 있으므로 출력에 보존됩니다.</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-join-left" class="quarto-float quarto-figure quarto-figure-center anchored" alt="내부 조인을 보여주는 이전 다이어그램과 비교하여, y 테이블은 그렇지  않으면 일치하지 않는 x의 모든 행과 일치할 NA를 포함하는 새로운 가상 행을  얻습니다. 이는 출력이 이제 세 개의 행을 가짐을 의미합니다. 이 가상  행과 일치하는 key = 3의 경우 val_y는 NA 값을 갖습니다.">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-join-left-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="diagrams/join/left.png" class="img-fluid figure-img" alt="내부 조인을 보여주는 이전 다이어그램과 비교하여, y 테이블은 그렇지  않으면 일치하지 않는 x의 모든 행과 일치할 NA를 포함하는 새로운 가상 행을  얻습니다. 이는 출력이 이제 세 개의 행을 가짐을 의미합니다. 이 가상  행과 일치하는 key = 3의 경우 val_y는 NA 값을 갖습니다." width="385">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-join-left-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;19.5: <code>x</code>의 모든 행이 출력에 나타나는 왼쪽 조인의 시각적 표현.
</figcaption></figure>
</div>
</div>
</div>
</li>
<li>
<p><strong>오른쪽 조인</strong>은 <code>y</code>의 모든 관측값을 유지합니다(<a href="#fig-join-right" class="quarto-xref">Figure&nbsp;<span>19.6</span></a>). <code>y</code>의 모든 행은 <code>x</code>의 <code>NA</code> 행과 일치하도록 폴백할 수 있으므로 출력에 보존됩니다. 출력은 여전히 가능한 한 <code>x</code>와 일치합니다. <code>y</code>의 모든 추가 행은 끝에 추가됩니다.</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-join-right" class="quarto-float quarto-figure quarto-figure-center anchored" alt="왼쪽 조인을 보여주는 이전 다이어그램과 비교하여, x 테이블은 이제  y의 모든 행이 x에서 일치 항목을 얻도록 가상 행을 얻습니다. val_x에는 x와 일치하지 않는 y의 행에 대해 NA가 포함됩니다.">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-join-right-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="diagrams/join/right.png" class="img-fluid figure-img" alt="왼쪽 조인을 보여주는 이전 다이어그램과 비교하여, x 테이블은 이제  y의 모든 행이 x에서 일치 항목을 얻도록 가상 행을 얻습니다. val_x에는 x와 일치하지 않는 y의 행에 대해 NA가 포함됩니다." width="380">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-join-right-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;19.6: <code>y</code>의 모든 행이 출력에 나타나는 오른쪽 조인의 시각적 표현.
</figcaption></figure>
</div>
</div>
</div>
</li>
<li>
<p><strong>전체 조인</strong>은 <code>x</code> 또는 <code>y</code>에 나타나는 모든 관측값을 유지합니다(<a href="#fig-join-full" class="quarto-xref">Figure&nbsp;<span>19.7</span></a>). <code>x</code>와 <code>y</code> 모두 <code>NA</code> 폴백 행이 있으므로 <code>x</code>와 <code>y</code>의 모든 행이 출력에 포함됩니다. 다시 출력은 <code>x</code>의 모든 행으로 시작하고 일치하지 않는 나머지 <code>y</code> 행이 뒤따릅니다.</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-join-full" class="quarto-float quarto-figure quarto-figure-center anchored" alt="이제 x와 y 모두 항상 일치하는 가상 행이 있습니다. 결과에는 4개의 행이 있습니다: val_x 및 val_y의 모든 값이 있는  키 1, 2, 3, 4이지만, 키 2의 val_y와 키 4의 val_x는 다른 데이터  프레임에 일치하는 항목이 없으므로 NA입니다.">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-join-full-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="diagrams/join/full.png" class="img-fluid figure-img" alt="이제 x와 y 모두 항상 일치하는 가상 행이 있습니다. 결과에는 4개의 행이 있습니다: val_x 및 val_y의 모든 값이 있는  키 1, 2, 3, 4이지만, 키 2의 val_y와 키 4의 val_x는 다른 데이터  프레임에 일치하는 항목이 없으므로 NA입니다." width="388">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-join-full-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;19.7: <code>x</code>와 <code>y</code>의 모든 행이 출력에 나타나는 전체 조인의 시각적 표현.
</figcaption></figure>
</div>
</div>
</div>
</li>
</ul>
<p>외부 조인 유형이 어떻게 다른지 보여주는 또 다른 방법은 <a href="#fig-join-venn" class="quarto-xref">Figure&nbsp;<span>19.8</span></a> 과 같은 벤 다이어그램을 사용하는 것입니다. 그러나 이것은 어떤 행이 보존되는지 기억을 되살릴 수는 있지만 열에서 무슨 일이 일어나는지 설명하지 못하기 때문에 훌륭한 표현은 아닙니다.</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-join-venn" class="quarto-float quarto-figure quarto-figure-center anchored" alt="내부, 전체, 왼쪽, 오른쪽 조인에 대한 벤 다이어그램. 각 조인은  데이터 프레임 x와 y를 나타내는 두 개의 교차하는 원으로 표현되며  x는 오른쪽, y는 왼쪽에 있습니다. 음영은 조인의 결과를 나타냅니다. ">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-join-venn-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="diagrams/join/venn.png" class="img-fluid figure-img" alt="내부, 전체, 왼쪽, 오른쪽 조인에 대한 벤 다이어그램. 각 조인은  데이터 프레임 x와 y를 나타내는 두 개의 교차하는 원으로 표현되며  x는 오른쪽, y는 왼쪽에 있습니다. 음영은 조인의 결과를 나타냅니다. " width="385">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-join-venn-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;19.8: 내부, 왼쪽, 오른쪽, 전체 조인의 차이를 보여주는 벤 다이어그램.
</figcaption></figure>
</div>
</div>
</div>
<p>여기에 표시된 조인은 키가 같으면 행이 일치하는 소위 <strong>동등(equi)</strong> <strong>조인</strong>입니다. 동등 조인은 가장 일반적인 유형의 조인이므로 일반적으로 동등 접두사를 생략하고 “동등 내부 조인”이 아닌 그냥 “내부 조인”이라고 말합니다. <a href="#sec-non-equi-joins" class="quarto-xref"><span>Section 19.5</span></a> 에서 비동등 조인으로 다시 돌아올 것입니다.</p>
<section id="행-일치" class="level3" data-number="19.4.1"><h3 data-number="19.4.1" class="anchored" data-anchor-id="행-일치">
<span class="header-section-number">19.4.1</span> 행 일치</h3>
<p>지금까지 <code>x</code>의 행이 <code>y</code>의 0개 또는 1개 행과 일치하면 어떻게 되는지 살펴보았습니다. 둘 이상의 행과 일치하면 어떻게 됩니까? 무슨 일이 일어나고 있는지 이해하기 위해 먼저 <code><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">inner_join()</a></code>에 초점을 맞추고 그림을 그려보겠습니다(<a href="#fig-join-match-types" class="quarto-xref">Figure&nbsp;<span>19.9</span></a>).</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-join-match-types" class="quarto-float quarto-figure quarto-figure-center anchored" alt="x의 키 값이 1, 2, 3이고 y의 키 값이 1, 2, 2인 조인 다이어그램.  키 1은 1개 행과 일치하고, 키 2는 2개 행과 일치하며, 키 3은 0개 행과  일치하므로 출력에는 3개 행이 있습니다.">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-join-match-types-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="diagrams/join/match-types.png" class="img-fluid figure-img" alt="x의 키 값이 1, 2, 3이고 y의 키 값이 1, 2, 2인 조인 다이어그램.  키 1은 1개 행과 일치하고, 키 2는 2개 행과 일치하며, 키 3은 0개 행과  일치하므로 출력에는 3개 행이 있습니다." width="348">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-join-match-types-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;19.9: <code>x</code>의 행이 일치할 수 있는 세 가지 방법. <code>x1</code>은 <code>y</code>의 한 행과 일치하고, <code>x2</code>는 <code>y</code>의 두 행과 일치하며, <code>x3</code>은 y의 0개 행과 일치합니다. <code>x</code>에 3개 행이 있고 출력에 3개 행이 있지만 행 간에 직접적인 대응 관계는 없다는 점에 유의하세요.
</figcaption></figure>
</div>
</div>
</div>
<p><code>x</code>의 행에 대해 세 가지 가능한 결과가 있습니다:</p>
<ul>
<li>아무것도 일치하지 않으면 삭제됩니다.</li>
<li>
<code>y</code>의 1개 행과 일치하면 보존됩니다.</li>
<li>
<code>y</code>의 1개 이상의 행과 일치하면 각 일치 항목에 대해 한 번씩 복제됩니다.</li>
</ul>
<p>원칙적으로 이는 출력의 행과 <code>x</code>의 행 사이에 보장된 대응 관계가 없음을 의미하지만 실제로는 거의 문제를 일으키지 않습니다. 그러나 행의 조합적 폭발을 일으킬 수 있는 특히 위험한 경우가 하나 있습니다. 다음 두 테이블을 조인한다고 상상해 보세요:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb26"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">df1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html">tibble</a></span><span class="op">(</span>key <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">2</span><span class="op">)</span>, val_x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"x1"</span>, <span class="st">"x2"</span>, <span class="st">"x3"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">df2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html">tibble</a></span><span class="op">(</span>key <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">2</span><span class="op">)</span>, val_y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"y1"</span>, <span class="st">"y2"</span>, <span class="st">"y3"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p><code>df1</code>의 첫 번째 행은 <code>df2</code>의 한 행과만 일치하지만 두 번째와 세 번째 행은 모두 두 행과 일치합니다. 이것을 때때로 <code>다대다(many-to-many)</code> 조인이라고 하며 dplyr이 경고를 보내도록 합니다:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb27"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">df1</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">inner_join</a></span><span class="op">(</span><span class="va">df2</span>, <span class="fu"><a href="https://dplyr.tidyverse.org/reference/join_by.html">join_by</a></span><span class="op">(</span><span class="va">key</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning in inner_join(df1, df2, join_by(key)): Detected an unexpected many-to-many relationship between `x` and `y`.</span></span>
<span><span class="co">#&gt; ℹ Row 2 of `x` matches multiple rows in `y`.</span></span>
<span><span class="co">#&gt; ℹ Row 2 of `y` matches multiple rows in `x`.</span></span>
<span><span class="co">#&gt; ℹ If a many-to-many relationship is expected, set `relationship =</span></span>
<span><span class="co">#&gt;   "many-to-many"` to silence this warning.</span></span>
<span><span class="co">#&gt; # A tibble: 5 × 3</span></span>
<span><span class="co">#&gt;     key val_x val_y</span></span>
<span><span class="co">#&gt;   &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;</span></span>
<span><span class="co">#&gt; 1     1 x1    y1   </span></span>
<span><span class="co">#&gt; 2     2 x2    y2   </span></span>
<span><span class="co">#&gt; 3     2 x2    y3   </span></span>
<span><span class="co">#&gt; 4     2 x3    y2   </span></span>
<span><span class="co">#&gt; 5     2 x3    y3</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>의도적으로 이 작업을 수행하는 경우 경고가 제안하는 대로 <code>relationship = "many-to-many"</code>를 설정할 수 있습니다.</p>
</section><section id="필터링-조인" class="level3" data-number="19.4.2"><h3 data-number="19.4.2" class="anchored" data-anchor-id="필터링-조인">
<span class="header-section-number">19.4.2</span> 필터링 조인</h3>
<p>일치하는 항목 수는 필터링 조인의 동작도 결정합니다. 세미 조인은 <a href="#fig-join-semi" class="quarto-xref">Figure&nbsp;<span>19.10</span></a> 와 같이 <code>y</code>에 하나 이상의 일치 항목이 있는 <code>x</code>의 행을 유지합니다. 안티 조인은 <a href="#fig-join-anti" class="quarto-xref">Figure&nbsp;<span>19.11</span></a> 와 같이 <code>y</code>에 0개의 행이 일치하는 <code>x</code>의 행을 유지합니다. 두 경우 모두 일치 항목의 존재 여부만 중요합니다. 몇 번 일치하는지는 중요하지 않습니다. 즉, 필터링 조인은 변형 조인처럼 행을 중복시키지 않습니다.</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-join-semi" class="quarto-float quarto-figure quarto-figure-center anchored" alt="오랜 친구 x와 y가 있는 조인 다이어그램. 세미 조인에서는 일치 항목의  존재만 중요하므로 출력에는 x와 동일한 열이 포함됩니다.">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-join-semi-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="diagrams/join/semi.png" class="img-fluid figure-img" alt="오랜 친구 x와 y가 있는 조인 다이어그램. 세미 조인에서는 일치 항목의  존재만 중요하므로 출력에는 x와 동일한 열이 포함됩니다." width="318">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-join-semi-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;19.10: 세미 조인에서는 일치 항목이 있다는 것만 중요합니다. 그렇지 않으면 <code>y</code>의 값은 출력에 영향을 주지 않습니다.
</figcaption></figure>
</div>
</div>
</div>
<div class="cell">
<div class="cell-output-display">
<div id="fig-join-anti" class="quarto-float quarto-figure quarto-figure-center anchored" alt="안티 조인은 세미 조인의 반대이므로 일치 항목은 빨간색 선으로 그려져  출력에서 삭제됨을 나타냅니다.">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-join-anti-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="diagrams/join/anti.png" class="img-fluid figure-img" alt="안티 조인은 세미 조인의 반대이므로 일치 항목은 빨간색 선으로 그려져  출력에서 삭제됨을 나타냅니다." width="317">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-join-anti-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;19.11: 안티 조인은 세미 조인의 반대이며 <code>y</code>에 일치하는 항목이 있는 <code>x</code>의 행을 삭제합니다.
</figcaption></figure>
</div>
</div>
</div>
</section></section><section id="sec-non-equi-joins" class="level2" data-number="19.5"><h2 data-number="19.5" class="anchored" data-anchor-id="sec-non-equi-joins">
<span class="header-section-number">19.5</span> 비동등 조인(Non-equi joins)</h2>
<p>지금까지 <code>x</code> 키가 <code>y</code> 키와 같으면 행이 일치하는 동등 조인만 보았습니다. 이제 그 제한을 완화하고 한 쌍의 행이 일치하는지 확인하는 다른 방법에 대해 논의하겠습니다.</p>
<p>하지만 그렇게 하기 전에 위에서 만든 단순화를 다시 살펴봐야 합니다. 동등 조인에서 <code>x</code> 키와 <code>y</code>는 항상 동일하므로 출력에 하나만 표시하면 됩니다. <code>keep = TRUE</code>를 사용하여 dplyr에 두 키를 모두 유지하도록 요청할 수 있으며, 이는 아래 코드와 <a href="#fig-inner-both" class="quarto-xref">Figure&nbsp;<span>19.12</span></a> 의 다시 그려진 <code><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">inner_join()</a></code>으로 이어집니다.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb28"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">x</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">inner_join</a></span><span class="op">(</span><span class="va">y</span>, <span class="fu"><a href="https://dplyr.tidyverse.org/reference/join_by.html">join_by</a></span><span class="op">(</span><span class="va">key</span> <span class="op">==</span> <span class="va">key</span><span class="op">)</span>, keep <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 2 × 4</span></span>
<span><span class="co">#&gt;   key.x val_x key.y val_y</span></span>
<span><span class="co">#&gt;   &lt;dbl&gt; &lt;chr&gt; &lt;dbl&gt; &lt;chr&gt;</span></span>
<span><span class="co">#&gt; 1     1 x1        1 y1   </span></span>
<span><span class="co">#&gt; 2     2 x2        2 y2</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div class="cell">
<div class="cell-output-display">
<div id="fig-inner-both" class="quarto-float quarto-figure quarto-figure-center anchored" alt="x와 y 사이의 내부 조인을 보여주는 조인 다이어그램. 결과에는 이제  key.x, val_x, key.y, val_y의 4개 열이 포함됩니다. key.x와 key.y의  값은 동일하므로 일반적으로 하나만 표시합니다. ">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-inner-both-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="diagrams/join/inner-both.png" class="img-fluid figure-img" alt="x와 y 사이의 내부 조인을 보여주는 조인 다이어그램. 결과에는 이제  key.x, val_x, key.y, val_y의 4개 열이 포함됩니다. key.x와 key.y의  값은 동일하므로 일반적으로 하나만 표시합니다. " width="415">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-inner-both-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;19.12: 출력에 <code>x</code>와 <code>y</code> 키를 모두 보여주는 내부 조인.
</figcaption></figure>
</div>
</div>
</div>
<p>동등 조인에서 벗어나면 키 값이 종종 다르기 때문에 항상 키를 표시합니다. 예를 들어 <code>x$key</code>와 <code>y$key</code>가 같을 때만 일치시키는 대신 <code>x$key</code>가 <code>y$key</code>보다 크거나 같을 때마다 일치시켜 <a href="#fig-join-gte" class="quarto-xref">Figure&nbsp;<span>19.13</span></a> 로 이어질 수 있습니다. dplyr의 조인 함수는 이 차이점 동등 조인과 비동등 조인을 이해하므로 비동등 조인을 수행할 때 항상 두 키를 모두 표시합니다.</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-join-gte" class="quarto-float quarto-figure quarto-figure-center anchored" alt="join_by(key >= key)를 설명하는 조인 다이어그램. x의 첫 번째 행은  y의 한 행과 일치하고 두 번째와 세 번째 행은 각각 두 행과 일치합니다.  즉, 출력에는 (1, 1), (2, 1), (2, 2), (3, 1), (3, 2)의 (key.x, key.y)  쌍을 포함하는 5개의 행이 있습니다.">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-join-gte-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="diagrams/join/gte.png" class="img-fluid figure-img" alt="join_by(key >= key)를 설명하는 조인 다이어그램. x의 첫 번째 행은  y의 한 행과 일치하고 두 번째와 세 번째 행은 각각 두 행과 일치합니다.  즉, 출력에는 (1, 1), (2, 1), (2, 2), (3, 1), (3, 2)의 (key.x, key.y)  쌍을 포함하는 5개의 행이 있습니다." width="385">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-join-gte-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;19.13: <code>x</code> 키가 <code>y</code> 키보다 크거나 같아야 하는 비동등 조인. 많은 행이 여러 일치 항목을 생성합니다.
</figcaption></figure>
</div>
</div>
</div>
<p>비동등 조인은 조인이 아닌 것이 무엇인지만 알려주고 무엇인지 알려주지 않기 때문에 특별히 유용한 용어는 아닙니다. dplyr은 4가지 특히 유용한 비동등 조인 유형을 식별하여 도움을 줍니다:</p>
<ul>
<li>
<strong>교차 조인(Cross joins)</strong> 은 모든 행 쌍을 일치시킵니다.</li>
<li>
<strong>부등 조인(Inequality joins)</strong> 은 <code>==</code> 대신 <code>&lt;</code>, <code>&lt;=</code>, <code>&gt;</code>, <code>&gt;=</code>를 사용합니다.</li>
<li>
<strong>롤링 조인(Rolling joins)</strong> 은 부등 조인과 유사하지만 가장 가까운 일치 항목만 찾습니다.</li>
<li>
<strong>중첩 조인(Overlap joins)</strong> 은 범위와 함께 작동하도록 설계된 특수한 유형의 부등 조인입니다.</li>
</ul>
<p>이들 각각은 다음 섹션에서 자세히 설명합니다.</p>
<section id="교차-조인cross-joins" class="level3" data-number="19.5.1"><h3 data-number="19.5.1" class="anchored" data-anchor-id="교차-조인cross-joins">
<span class="header-section-number">19.5.1</span> 교차 조인(Cross joins)</h3>
<p>교차 조인은 <a href="#fig-join-cross" class="quarto-xref">Figure&nbsp;<span>19.14</span></a> 와 같이 모든 것을 일치시켜 행의 데카르트 곱(Cartesian product)을 생성합니다. 이는 출력이 <code>nrow(x) * nrow(y)</code>개의 행을 가짐을 의미합니다.</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-join-cross" class="quarto-float quarto-figure quarto-figure-center anchored" alt="x와 y의 모든 조합에 대한 점을 보여주는 조인 다이어그램.">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-join-cross-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="diagrams/join/cross.png" class="img-fluid figure-img" alt="x와 y의 모든 조합에 대한 점을 보여주는 조인 다이어그램." width="155">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-join-cross-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;19.14: 교차 조인은 <code>x</code>의 각 행을 <code>y</code>의 모든 행과 일치시킵니다.
</figcaption></figure>
</div>
</div>
</div>
<p>교차 조인은 순열을 생성할 때 유용합니다. 예를 들어 아래 코드는 가능한 모든 이름 쌍을 생성합니다. <code>df</code>를 자신에게 조인하므로 이를 때때로 <strong>자체 조인(self-join)</strong> 이라고 합니다. 교차 조인은 모든 행을 일치시킬 때 내부/왼쪽/오른쪽/전체 구분 없기 때문에 다른 조인 함수를 사용합니다.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb29"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html">tibble</a></span><span class="op">(</span>name <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"John"</span>, <span class="st">"Simon"</span>, <span class="st">"Tracy"</span>, <span class="st">"Max"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">df</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/cross_join.html">cross_join</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 16 × 2</span></span>
<span><span class="co">#&gt;   name.x name.y</span></span>
<span><span class="co">#&gt;   &lt;chr&gt;  &lt;chr&gt; </span></span>
<span><span class="co">#&gt; 1 John   John  </span></span>
<span><span class="co">#&gt; 2 John   Simon </span></span>
<span><span class="co">#&gt; 3 John   Tracy </span></span>
<span><span class="co">#&gt; 4 John   Max   </span></span>
<span><span class="co">#&gt; 5 Simon  John  </span></span>
<span><span class="co">#&gt; 6 Simon  Simon </span></span>
<span><span class="co">#&gt; # ℹ 10 more rows</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section><section id="부등-조인inequality-joins" class="level3" data-number="19.5.2"><h3 data-number="19.5.2" class="anchored" data-anchor-id="부등-조인inequality-joins">
<span class="header-section-number">19.5.2</span> 부등 조인(Inequality joins)</h3>
<p>부등 조인은 <code>&lt;</code>, <code>&lt;=</code>, <code>&gt;=</code>, <code>&gt;</code>를 사용하여 가능한 일치 항목 집합을 제한합니다(<a href="#fig-join-gte" class="quarto-xref">Figure&nbsp;<span>19.13</span></a> 및 <a href="#fig-join-lt" class="quarto-xref">Figure&nbsp;<span>19.15</span></a>).</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-join-lt" class="quarto-float quarto-figure quarto-figure-center anchored" alt="x의 키가 y의 키보다 작은 데이터 프레임 x가 데이터 프레임 y에 의해  조인되는 부등 조인을 묘사한 다이어그램으로 왼쪽 상단 모서리에 삼각형  모양이 나타납니다.">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-join-lt-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="diagrams/join/lt.png" class="img-fluid figure-img" alt="x의 키가 y의 키보다 작은 데이터 프레임 x가 데이터 프레임 y에 의해  조인되는 부등 조인을 묘사한 다이어그램으로 왼쪽 상단 모서리에 삼각형  모양이 나타납니다." width="185">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-join-lt-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;19.15: <code>x</code>의 키가 <code>y</code>의 키보다 작은 행에서 <code>x</code>가 <code>y</code>에 조인되는 부등 조인. 이것은 왼쪽 상단 모서리에 삼각형 모양을 만듭니다.
</figcaption></figure>
</div>
</div>
</div>
<p>부등 조인은 매우 일반적이어서 의미 있는 특정 사용 사례를 생각해내기 어렵습니다. 작고 유용한 기술 중 하나는 모든 순열을 생성하는 대신 모든 조합을 생성하도록 교차 조인을 제한하는 데 사용하는 것입니다:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb30"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html">tibble</a></span><span class="op">(</span>id <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">4</span>, name <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"John"</span>, <span class="st">"Simon"</span>, <span class="st">"Tracy"</span>, <span class="st">"Max"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">df</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">inner_join</a></span><span class="op">(</span><span class="va">df</span>, <span class="fu"><a href="https://dplyr.tidyverse.org/reference/join_by.html">join_by</a></span><span class="op">(</span><span class="va">id</span> <span class="op">&lt;</span> <span class="va">id</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 6 × 4</span></span>
<span><span class="co">#&gt;    id.x name.x  id.y name.y</span></span>
<span><span class="co">#&gt;   &lt;int&gt; &lt;chr&gt;  &lt;int&gt; &lt;chr&gt; </span></span>
<span><span class="co">#&gt; 1     1 John       2 Simon </span></span>
<span><span class="co">#&gt; 2     1 John       3 Tracy </span></span>
<span><span class="co">#&gt; 3     1 John       4 Max   </span></span>
<span><span class="co">#&gt; 4     2 Simon      3 Tracy </span></span>
<span><span class="co">#&gt; 5     2 Simon      4 Max   </span></span>
<span><span class="co">#&gt; 6     3 Tracy      4 Max</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section><section id="롤링-조인rolling-joins" class="level3" data-number="19.5.3"><h3 data-number="19.5.3" class="anchored" data-anchor-id="롤링-조인rolling-joins">
<span class="header-section-number">19.5.3</span> 롤링 조인(Rolling joins)</h3>
<p>롤링 조인은 부등식을 만족하는 <em>모든</em> 행을 얻는 대신 가장 가까운 행만 얻는 특수한 유형의 부등 조인입니다(<a href="#fig-join-closest" class="quarto-xref">Figure&nbsp;<span>19.16</span></a>). <code>closest()</code>를 추가하여 모든 부등 조인을 롤링 조인으로 바꿀 수 있습니다. 예를 들어 <code>join_by(closest(x &lt;= y))</code>는 x보다 크거나 같은 가장 작은 <code>y</code>와 일치하고 <code>join_by(closest(x &gt; y))</code>는 <code>x</code>보다 작은 가장 큰 <code>y</code>와 일치합니다.</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-join-closest" class="quarto-float quarto-figure quarto-figure-center anchored" alt="롤링 조인은 부등 조인의 하위 집합이므로 일부 일치 항목은 &quot;가장  가깝지&quot; 않기 때문에 사용되지 않음을 나타내기 위해 회색으로 표시됩니다.">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-join-closest-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="diagrams/join/closest.png" class="img-fluid figure-img" alt="롤링 조인은 부등 조인의 하위 집합이므로 일부 일치 항목은 &quot;가장  가깝지&quot; 않기 때문에 사용되지 않음을 나타내기 위해 회색으로 표시됩니다." width="262">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-join-closest-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;19.16: 롤링 조인은 크거나 같음 부등 조인과 유사하지만 첫 번째 값만 일치시킵니다.
</figcaption></figure>
</div>
</div>
</div>
<p>롤링 조인은 완벽하게 정렬되지 않는 두 개의 날짜 테이블이 있고 테이블 1의 날짜보다 이전(또는 이후)에 오는 테이블 2의 (예를 들어) 가장 가까운 날짜를 찾으려는 경우에 특히 유용합니다.</p>
<p>예를 들어 사무실의 파티 계획 위원회 책임자라고 상상해 보세요. 회사가 꽤 인색해서 개별 파티를 하는 대신 분기에 한 번만 파티를 엽니다. 파티가 언제 열릴지 결정하는 규칙은 조금 복잡합니다. 파티는 항상 월요일에 열리고, 많은 사람들이 휴가 중이므로 1월 첫째 주는 건너뛰고, 2022년 3분기의 첫 번째 월요일은 7월 4일이므로 일주일 미뤄야 합니다. 그 결과 다음과 같은 파티 날짜가 나옵니다:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb31"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">parties</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html">tibble</a></span><span class="op">(</span></span>
<span>  q <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">4</span>,</span>
<span>  party <span class="op">=</span> <span class="fu"><a href="https://lubridate.tidyverse.org/reference/ymd.html">ymd</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"2022-01-10"</span>, <span class="st">"2022-04-04"</span>, <span class="st">"2022-07-11"</span>, <span class="st">"2022-10-03"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>이제 직원 생일 테이블이 있다고 상상해 보세요:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb32"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span></span>
<span><span class="va">employees</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html">tibble</a></span><span class="op">(</span></span>
<span>  name <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html">sample</a></span><span class="op">(</span><span class="fu">babynames</span><span class="fu">::</span><span class="va"><a href="https://rdrr.io/pkg/babynames/man/babynames.html">babynames</a></span><span class="op">$</span><span class="va">name</span>, <span class="fl">100</span><span class="op">)</span>,</span>
<span>  birthday <span class="op">=</span> <span class="fu"><a href="https://lubridate.tidyverse.org/reference/ymd.html">ymd</a></span><span class="op">(</span><span class="st">"2022-01-01"</span><span class="op">)</span> <span class="op">+</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sample.html">sample</a></span><span class="op">(</span><span class="fl">365</span>, <span class="fl">100</span>, replace <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">-</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="va">employees</span></span>
<span><span class="co">#&gt; # A tibble: 100 × 2</span></span>
<span><span class="co">#&gt;   name     birthday  </span></span>
<span><span class="co">#&gt;   &lt;chr&gt;    &lt;date&gt;    </span></span>
<span><span class="co">#&gt; 1 Kemba    2022-01-22</span></span>
<span><span class="co">#&gt; 2 Orean    2022-06-26</span></span>
<span><span class="co">#&gt; 3 Kirstyn  2022-02-11</span></span>
<span><span class="co">#&gt; 4 Amparo   2022-11-11</span></span>
<span><span class="co">#&gt; 5 Belen    2022-03-25</span></span>
<span><span class="co">#&gt; 6 Rayshaun 2022-01-11</span></span>
<span><span class="co">#&gt; # ℹ 94 more rows</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>그리고 각 직원에 대해 생일 이전(또는 당일)에 오는 마지막 파티 날짜를 찾고 싶습니다. 롤링 조인으로 표현할 수 있습니다:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb33"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">employees</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join</a></span><span class="op">(</span><span class="va">parties</span>, <span class="fu"><a href="https://dplyr.tidyverse.org/reference/join_by.html">join_by</a></span><span class="op">(</span><span class="fu">closest</span><span class="op">(</span><span class="va">birthday</span> <span class="op">&gt;=</span> <span class="va">party</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 100 × 4</span></span>
<span><span class="co">#&gt;   name     birthday       q party     </span></span>
<span><span class="co">#&gt;   &lt;chr&gt;    &lt;date&gt;     &lt;int&gt; &lt;date&gt;    </span></span>
<span><span class="co">#&gt; 1 Kemba    2022-01-22     1 2022-01-10</span></span>
<span><span class="co">#&gt; 2 Orean    2022-06-26     2 2022-04-04</span></span>
<span><span class="co">#&gt; 3 Kirstyn  2022-02-11     1 2022-01-10</span></span>
<span><span class="co">#&gt; 4 Amparo   2022-11-11     4 2022-10-03</span></span>
<span><span class="co">#&gt; 5 Belen    2022-03-25     1 2022-01-10</span></span>
<span><span class="co">#&gt; 6 Rayshaun 2022-01-11     1 2022-01-10</span></span>
<span><span class="co">#&gt; # ℹ 94 more rows</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>하지만 이 접근 방식에는 한 가지 문제가 있습니다. 생일이 1월 10일 이전인 사람들은 파티를 얻지 못합니다:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb34"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">employees</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter-joins.html">anti_join</a></span><span class="op">(</span><span class="va">parties</span>, <span class="fu"><a href="https://dplyr.tidyverse.org/reference/join_by.html">join_by</a></span><span class="op">(</span><span class="fu">closest</span><span class="op">(</span><span class="va">birthday</span> <span class="op">&gt;=</span> <span class="va">party</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 2 × 2</span></span>
<span><span class="co">#&gt;   name   birthday  </span></span>
<span><span class="co">#&gt;   &lt;chr&gt;  &lt;date&gt;    </span></span>
<span><span class="co">#&gt; 1 Maks   2022-01-07</span></span>
<span><span class="co">#&gt; 2 Nalani 2022-01-04</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>이 문제를 해결하려면 중첩 조인이라는 다른 방식으로 문제에 접근해야 합니다.</p>
</section><section id="중첩-조인overlap-joins" class="level3" data-number="19.5.4"><h3 data-number="19.5.4" class="anchored" data-anchor-id="중첩-조인overlap-joins">
<span class="header-section-number">19.5.4</span> 중첩 조인(Overlap joins)</h3>
<p>중첩 조인은 부등 조인을 사용하여 간격 작업을 더 쉽게 만드는 세 가지 도우미를 제공합니다:</p>
<ul>
<li>
<code>between(x, y_lower, y_upper)</code>는 <code>x &gt;= y_lower, x &lt;= y_upper</code>의 줄임말입니다.</li>
<li>
<code>within(x_lower, x_upper, y_lower, y_upper)</code>는 <code>x_lower &gt;= y_lower, x_upper &lt;= y_upper</code>의 줄임말입니다.</li>
<li>
<code>overlaps(x_lower, x_upper, y_lower, y_upper)</code>는 <code>x_lower &lt;= y_upper, x_upper &gt;= y_lower</code>의 줄임말입니다.</li>
</ul>
<p>그것들을 어떻게 사용할 수 있는지 알아보기 위해 생일 예제를 계속해 보겠습니다. 위에서 사용한 전략에는 한 가지 문제가 있습니다. 1월 1-9일 생일 이전에 파티가 없습니다. 따라서 각 파티가 걸쳐 있는 날짜 범위를 명시하고 초반 생일에 대해 특별한 경우를 만드는 것이 더 나을 수 있습니다:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb35"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">parties</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html">tibble</a></span><span class="op">(</span></span>
<span>  q <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">4</span>,</span>
<span>  party <span class="op">=</span> <span class="fu"><a href="https://lubridate.tidyverse.org/reference/ymd.html">ymd</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"2022-01-10"</span>, <span class="st">"2022-04-04"</span>, <span class="st">"2022-07-11"</span>, <span class="st">"2022-10-03"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  start <span class="op">=</span> <span class="fu"><a href="https://lubridate.tidyverse.org/reference/ymd.html">ymd</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"2022-01-01"</span>, <span class="st">"2022-04-04"</span>, <span class="st">"2022-07-11"</span>, <span class="st">"2022-10-03"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  end <span class="op">=</span> <span class="fu"><a href="https://lubridate.tidyverse.org/reference/ymd.html">ymd</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"2022-04-03"</span>, <span class="st">"2022-07-11"</span>, <span class="st">"2022-10-02"</span>, <span class="st">"2022-12-31"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="va">parties</span></span>
<span><span class="co">#&gt; # A tibble: 4 × 4</span></span>
<span><span class="co">#&gt;       q party      start      end       </span></span>
<span><span class="co">#&gt;   &lt;int&gt; &lt;date&gt;     &lt;date&gt;     &lt;date&gt;    </span></span>
<span><span class="co">#&gt; 1     1 2022-01-10 2022-01-01 2022-04-03</span></span>
<span><span class="co">#&gt; 2     2 2022-04-04 2022-04-04 2022-07-11</span></span>
<span><span class="co">#&gt; 3     3 2022-07-11 2022-07-11 2022-10-02</span></span>
<span><span class="co">#&gt; 4     4 2022-10-03 2022-10-03 2022-12-31</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>해들리(Hadley)는 데이터 입력에 끔찍하게 서툴러서 파티 기간이 겹치지 않는지 확인하고 싶었습니다. 이를 수행하는 한 가지 방법은 자체 조인을 사용하여 시작-종료 간격이 다른 것과 겹치는지 확인하는 것입니다:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb36"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">parties</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">inner_join</a></span><span class="op">(</span><span class="va">parties</span>, <span class="fu"><a href="https://dplyr.tidyverse.org/reference/join_by.html">join_by</a></span><span class="op">(</span><span class="fu">overlaps</span><span class="op">(</span><span class="va">start</span>, <span class="va">end</span>, <span class="va">start</span>, <span class="va">end</span><span class="op">)</span>, <span class="va">q</span> <span class="op">&lt;</span> <span class="va">q</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">start.x</span>, <span class="va">end.x</span>, <span class="va">start.y</span>, <span class="va">end.y</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 1 × 4</span></span>
<span><span class="co">#&gt;   start.x    end.x      start.y    end.y     </span></span>
<span><span class="co">#&gt;   &lt;date&gt;     &lt;date&gt;     &lt;date&gt;     &lt;date&gt;    </span></span>
<span><span class="co">#&gt; 1 2022-04-04 2022-07-11 2022-07-11 2022-10-02</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>이런, 겹치는 부분이 있으니 문제를 해결하고 계속해 보겠습니다:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb37"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">parties</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html">tibble</a></span><span class="op">(</span></span>
<span>  q <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">4</span>,</span>
<span>  party <span class="op">=</span> <span class="fu"><a href="https://lubridate.tidyverse.org/reference/ymd.html">ymd</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"2022-01-10"</span>, <span class="st">"2022-04-04"</span>, <span class="st">"2022-07-11"</span>, <span class="st">"2022-10-03"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  start <span class="op">=</span> <span class="fu"><a href="https://lubridate.tidyverse.org/reference/ymd.html">ymd</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"2022-01-01"</span>, <span class="st">"2022-04-04"</span>, <span class="st">"2022-07-11"</span>, <span class="st">"2022-10-03"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  end <span class="op">=</span> <span class="fu"><a href="https://lubridate.tidyverse.org/reference/ymd.html">ymd</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"2022-04-03"</span>, <span class="st">"2022-07-10"</span>, <span class="st">"2022-10-02"</span>, <span class="st">"2022-12-31"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>이제 각 직원을 파티에 연결할 수 있습니다. 파티를 배정받지 못한 직원이 있는지 빨리 알아보고 싶기 때문에 <code>unmatched = "error"</code>를 사용하기에 좋은 곳입니다.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb38"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">employees</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">inner_join</a></span><span class="op">(</span><span class="va">parties</span>, <span class="fu"><a href="https://dplyr.tidyverse.org/reference/join_by.html">join_by</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/between.html">between</a></span><span class="op">(</span><span class="va">birthday</span>, <span class="va">start</span>, <span class="va">end</span><span class="op">)</span><span class="op">)</span>, unmatched <span class="op">=</span> <span class="st">"error"</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 100 × 6</span></span>
<span><span class="co">#&gt;   name     birthday       q party      start      end       </span></span>
<span><span class="co">#&gt;   &lt;chr&gt;    &lt;date&gt;     &lt;int&gt; &lt;date&gt;     &lt;date&gt;     &lt;date&gt;    </span></span>
<span><span class="co">#&gt; 1 Kemba    2022-01-22     1 2022-01-10 2022-01-01 2022-04-03</span></span>
<span><span class="co">#&gt; 2 Orean    2022-06-26     2 2022-04-04 2022-04-04 2022-07-10</span></span>
<span><span class="co">#&gt; 3 Kirstyn  2022-02-11     1 2022-01-10 2022-01-01 2022-04-03</span></span>
<span><span class="co">#&gt; 4 Amparo   2022-11-11     4 2022-10-03 2022-10-03 2022-12-31</span></span>
<span><span class="co">#&gt; 5 Belen    2022-03-25     1 2022-01-10 2022-01-01 2022-04-03</span></span>
<span><span class="co">#&gt; 6 Rayshaun 2022-01-11     1 2022-01-10 2022-01-01 2022-04-03</span></span>
<span><span class="co">#&gt; # ℹ 94 more rows</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section><section id="연습문제-2" class="level3" data-number="19.5.5"><h3 data-number="19.5.5" class="anchored" data-anchor-id="연습문제-2">
<span class="header-section-number">19.5.5</span> 연습문제</h3>
<ol type="1">
<li>
<p>이 동등 조인에서 키에 무슨 일이 일어나고 있는지 설명할 수 있습니까? 왜 다릅니까?</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb39"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">x</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">full_join</a></span><span class="op">(</span><span class="va">y</span>, <span class="fu"><a href="https://dplyr.tidyverse.org/reference/join_by.html">join_by</a></span><span class="op">(</span><span class="va">key</span> <span class="op">==</span> <span class="va">key</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 4 × 3</span></span>
<span><span class="co">#&gt;     key val_x val_y</span></span>
<span><span class="co">#&gt;   &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;</span></span>
<span><span class="co">#&gt; 1     1 x1    y1   </span></span>
<span><span class="co">#&gt; 2     2 x2    y2   </span></span>
<span><span class="co">#&gt; 3     3 x3    &lt;NA&gt; </span></span>
<span><span class="co">#&gt; 4     4 &lt;NA&gt;  y3</span></span>
<span></span>
<span><span class="va">x</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">full_join</a></span><span class="op">(</span><span class="va">y</span>, <span class="fu"><a href="https://dplyr.tidyverse.org/reference/join_by.html">join_by</a></span><span class="op">(</span><span class="va">key</span> <span class="op">==</span> <span class="va">key</span><span class="op">)</span>, keep <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 4 × 4</span></span>
<span><span class="co">#&gt;   key.x val_x key.y val_y</span></span>
<span><span class="co">#&gt;   &lt;dbl&gt; &lt;chr&gt; &lt;dbl&gt; &lt;chr&gt;</span></span>
<span><span class="co">#&gt; 1     1 x1        1 y1   </span></span>
<span><span class="co">#&gt; 2     2 x2        2 y2   </span></span>
<span><span class="co">#&gt; 3     3 x3       NA &lt;NA&gt; </span></span>
<span><span class="co">#&gt; 4    NA &lt;NA&gt;      4 y3</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</li>
<li><p>파티 기간이 다른 파티 기간과 겹치는지 찾을 때 <code><a href="https://dplyr.tidyverse.org/reference/join_by.html">join_by()</a></code>에서 <code>q &lt; q</code>를 사용했습니다. 이유는 무엇입니까? 이 부등식을 제거하면 어떻게 됩니까?</p></li>
</ol></section></section><section id="요약" class="level2" data-number="19.6"><h2 data-number="19.6" class="anchored" data-anchor-id="요약">
<span class="header-section-number">19.6</span> 요약</h2>
<p>이 장에서는 변형 및 필터링 조인을 사용하여 한 쌍의 데이터 프레임에서 데이터를 결합하는 방법을 배웠습니다. 그 과정에서 키를 식별하는 방법과 기본 키와 외래 키의 차이점을 배웠습니다. 또한 조인이 작동하는 방식과 출력에 몇 개의 행이 있는지 파악하는 방법도 이해했습니다. 마지막으로 비동등 조인의 힘을 살짝 엿보고 몇 가지 흥미로운 사용 사례를 보았습니다.</p>
<p>이 장으로 개별 열과 티블에서 사용할 수 있는 도구에 중점을 둔 책의 “변형(Transform)” 파트가 마무리됩니다. 논리형 벡터, 숫자, 전체 테이블 작업을 위한 dplyr 및 기본 함수, 문자열 작업을 위한 stringr 함수, 날짜-시간 작업을 위한 lubridate 함수, 팩터 작업을 위한 forcats 함수에 대해 배웠습니다.</p>
<p>책의 다음 파트에서는 다양한 유형의 데이터를 깔끔한 형태로 R로 가져오는 방법에 대해 더 자세히 배울 것입니다.</p>


</section><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><hr>
<ol>
<li id="fn1"><p>RStudio에서는 <code><a href="https://rdrr.io/r/utils/View.html">View()</a></code>를 사용하여 이 문제를 피할 수도 있음을 기억하세요.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2"><p>100% 사실은 아니지만 그렇지 않을 때마다 경고를 받게 됩니다.<a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol></section></main><!-- /main --><script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
      const outerScaffold = trigger.parentElement.cloneNode(true);
      const codeEl = outerScaffold.querySelector('code');
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp("https:\/\/r4ds\.hadley\.nz\/");
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script><nav class="page-navigation"><div class="nav-page nav-page-previous">
      <a href="./missing-values.html" class="pagination-link" aria-label="결측값(Missing values)">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">18</span>&nbsp; <span class="chapter-title">결측값(Missing values)</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./import.html" class="pagination-link" aria-label="가져오기 (Import)">
        <span class="nav-page-text">가져오기 (Import)</span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer"><div class="nav-footer">
    <div class="nav-footer-left">
<p>R for Data Science (2e) was written by Hadley Wickham, Mine Çetinkaya-Rundel, and Garrett Grolemund.</p>
</div>   
    <div class="nav-footer-center">
      &nbsp;
    <div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/hadley/r4ds/edit/main/joins.qmd" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/hadley/r4ds/issues/new" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></div>
    <div class="nav-footer-right">
<p>This book was built with <a href="https://quarto.org/">Quarto</a>.</p>
</div>
  </div>
</footer>


</body></html>